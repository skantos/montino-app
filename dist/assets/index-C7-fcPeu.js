import{r as t,j as e,a as ne}from"./react-MB1aJdB0.js";import{c as Ge}from"./react-dom-babtui9j.js";import{g as Ie,s as Ke,a as Me,b as Je,c as Xe}from"./firebase-DAKLECVI.js";import{u as Ze,v as _e,w as Qe,x as Ye,y as ea,z as J,A as fe,B as Oe,D as Z,G as W,H as Ce,I as ye,J as Fe,K as aa,M as ta}from"./@firebase-B8UHoOfg.js";import{L as V,B as ra}from"./react-router-dom-BP5qz8hL.js";import{a as me,b as sa,d as oa,e as q,f as ve}from"./react-router-BDFDsiw1.js";import{T as le,B as X,D as de,L as $e,A as Ae,a as Le,F as Ve,I as ke,S as Ue,M as ae,b as Re,P as ze,c as ue,d as he,e as Y,f as D,g as xe,h as be,i as Ne,j as Se}from"./@mui-D6ajMDpQ.js";import{F as H,f as qe,a as We,b as Ee,c as De,d as He}from"./@fortawesome-CTlQ_N8p.js";import{f as je}from"./date-fns-5tFtsWfW.js";import{P as na,B as Te}from"./react-chartjs-2-BMTf87bo.js";import"./chart.js-C_W9Dm9B.js";import"./@babel-DdaQcUjw.js";import"./scheduler-CzFDRTuY.js";import"./tslib-BGVaTf34.js";import"./safevalues-NrgD-8pg.js";import"./idb-Bn1DMRyg.js";import"./@remix-run-BFLWy9pZ.js";import"./react-is-DcfIKM1A.js";import"./clsx-B-dksMZM.js";import"./@emotion-D2LlJvDI.js";import"./hoist-non-react-statics-DQogQWOa.js";import"./stylis-FDnFs_-n.js";import"./prop-types-D-iIXjl8.js";import"./react-transition-group-DD9RWrmj.js";import"./dom-helpers-D0mFdbeO.js";import"./@popperjs-BQBsAJpH.js";import"./@kurkle-BZxJdD1U.js";(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))N(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const m of i.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&N(m)}).observe(document,{childList:!0,subtree:!0});function P(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function N(n){if(n.ep)return;n.ep=!0;const i=P(n);fetch(n.href,i)}})();const ca={apiKey:"AIzaSyAP7Af1h_-zBmBfL_A5K2uuJsJDFuOel0c",authDomain:"local-js-d7712.firebaseapp.com",databaseURL:"https://local-js-d7712-default-rtdb.firebaseio.com",projectId:"local-js-d7712",storageBucket:"local-js-d7712.appspot.com",messagingSenderId:"200538761653",appId:"1:200538761653:web:571a969ac8a572328451fc",measurementId:"G-XXD5WT5TV1"},ce=Ze(ca),ee=Ie(ce),M=_e(ce);Qe(ce);Ye(ce);ea(ce);const pe=t.createContext();function ia({children:j}){const[u,P]=t.useState(null),[N,n]=t.useState(null);t.useEffect(()=>{const h=ee.onAuthStateChanged(async p=>{if(p){P(p);const v=J(M,"users",p.uid),g=await fe(v);g.exists()?n(g.data().rolUsuario):n(null)}else P(null),n(null)});return()=>h()},[]);const i=async(h,p)=>{try{const v=await Ke(ee,h,p);P(v.user);const g=J(M,"users",v.user.uid),k=await fe(g);k.exists()?n(k.data().rolUsuario):n(null)}catch(v){throw console.error("Error signing in:",v),v}},m=async()=>{try{await Me(ee),P(null),n(null)}catch(h){throw console.error("Error signing out:",h),h}};return e.jsx(pe.Provider,{value:{user:u,role:N,signIn:i,signOut:m},children:j})}function we(){return t.useContext(pe)}function la(){const[j,u]=t.useState(""),[P,N]=t.useState(""),[n,i]=t.useState(""),m=me(),{signIn:h,role:p}=we(),v=async g=>{g.preventDefault(),i("");try{await h(j,P)}catch(k){i("Usuario o contraseña incorrectos"),console.error("Error al iniciar sesión:",k)}};return t.useEffect(()=>{p&&(p==="admin"?m("/ventas"):p==="vendedor"?m("/vendedor/ventas"):i("Rol de usuario no reconocido"))},[p,m]),e.jsx("div",{children:e.jsx("div",{className:"login-box",children:e.jsxs("form",{className:"form",onSubmit:v,children:[e.jsxs("p",{className:"form-title",children:["Los Tios ",e.jsx("br",{}),"Iniciar Sesión"]}),e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"email",placeholder:"Email",value:j,onChange:g=>u(g.target.value),required:!0})}),e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"password",placeholder:"Contraseña",value:P,onChange:g=>N(g.target.value),required:!0})}),n&&e.jsx("p",{className:"signup-link",children:n}),e.jsx("button",{type:"submit",className:"submit",children:"Ingresar"}),e.jsx("p",{className:"signup-link",children:e.jsx(V,{to:"/resetPassword",className:"resetPassword",children:"Olvidé mi Contraseña"})})]})})})}const da=()=>{const[j,u]=t.useState(""),[P,N]=t.useState(!1),[n,i]=t.useState(null),m=me(),h=()=>{Je(ee,j).then(()=>{N(!0),setTimeout(()=>{m("/")},6e3)}).catch(p=>{i("No se pudo enviar el correo electrónico de restablecimiento de contraseña.")})};return e.jsxs("div",{className:"recuperar-contrasena",children:[e.jsx("h1",{children:"Recuperar Contraseña"}),P?e.jsx("p",{children:"Se ha enviado un correo electrónico con instrucciones para restablecer tu contraseña."}):e.jsxs(e.Fragment,{children:[e.jsx(le,{type:"email",label:"Correo Electrónico",value:j,onChange:p=>u(p.target.value),sx:{width:"16%"}}),e.jsx(X,{onClick:h,variant:"outlined",sx:{fontSize:"19px",marginBottom:"19px",top:"10px"},children:"Enviar"}),n&&e.jsx("p",{style:{color:"red"},children:n})]})]})},_=()=>{const j=me(),u=sa(),[P,N]=ne.useState(!1),n=async()=>{const p=Ie();try{await Me(p),localStorage.removeItem("token"),j("/")}catch(v){console.error("Error al cerrar sesión:",v)}},i=()=>{N(!P)},m=()=>{N(!1)};ne.useEffect(()=>{const p=()=>{window.innerWidth>=800&&m()};return window.addEventListener("resize",p),()=>{window.removeEventListener("resize",p)}},[]);const h=p=>u.pathname===p?"active":"";return e.jsxs("nav",{className:"navbar",children:[e.jsxs("ul",{className:`sidebar ${P?"visible":""}`,children:[e.jsx("li",{onClick:m,children:e.jsx(V,{className:"menu",to:"#",children:e.jsx(H,{icon:qe})})}),e.jsx("li",{children:e.jsx(V,{className:`link ${h("/ventas")}`,to:"/ventas",children:"Venta"})}),e.jsx("li",{children:e.jsx(V,{className:`link ${h("/agregarProducto")}`,to:"/agregarProducto",children:"Agregar Producto"})}),e.jsx("li",{children:e.jsx(V,{className:`link ${h("/agregarUsuario")}`,to:"/agregarUsuario",children:"Agregar Usuario"})}),e.jsx("li",{children:e.jsx(V,{className:`link ${h("/inventario")}`,to:"/inventario",children:"Inventario"})}),e.jsx("li",{children:e.jsx(V,{className:`link ${h("/devolucion")}`,to:"/devolucion",children:"Devolución"})}),e.jsx("li",{children:e.jsx(V,{className:`link ${h("/dashboard")}`,to:"/dashboard",children:"Dashboard"})}),e.jsx("li",{children:e.jsx(V,{className:`link ${h("/historial")}`,to:"/historial",children:"Historial"})}),e.jsx("li",{children:e.jsx(V,{className:"link",onClick:n,children:"Cerrar Sesión"})})]}),e.jsxs("ul",{children:[e.jsx("li",{className:"Mobile",children:e.jsx(V,{className:`link ${h("/dashboard")}`,to:"/dashboard",children:"Dashboard"})}),e.jsx("li",{className:"Mobile",children:e.jsx(V,{className:`link ${h("/agregarProducto")}`,to:"/agregarProducto",children:"Agregar Producto"})}),e.jsx("li",{className:"Mobile",children:e.jsx(V,{className:`link ${h("/agregarUsuario")}`,to:"/agregarUsuario",children:"Agregar Usuario"})}),e.jsx("li",{className:"Mobile",children:e.jsx(V,{className:`link ${h("/devolucion")}`,to:"/devolucion",children:"Devolución"})}),e.jsx("li",{className:"Mobile",children:e.jsx(V,{className:`link ${h("/ventas")}`,to:"/ventas",children:"Venta"})}),e.jsx("li",{className:"Mobile",children:e.jsx(V,{className:`link ${h("/inventario")}`,to:"/inventario",children:"Inventario"})}),e.jsx("li",{className:"Mobile",children:e.jsx(V,{className:`link ${h("/historial")}`,to:"/historial",children:"Historial"})}),e.jsx("li",{className:"Mobile",children:e.jsx(V,{className:"link",onClick:n,children:"Cerrar Sesión"})}),e.jsx("li",{onClick:i,children:e.jsx(V,{className:"menu",to:"#",children:e.jsx(H,{icon:We})})})]})]})},ua=()=>{const[j,u]=t.useState(""),[P,N]=t.useState(""),[n,i]=t.useState(""),[m,h]=t.useState("vendedor"),[p,v]=t.useState(""),[g,k]=t.useState(""),C=async I=>{I.preventDefault(),console.log("Nombre de Usuario:",j),console.log("Email:",P),console.log("Contraseña:",n),console.log("Rol:",m);try{const y=(await Xe(ee,P,n)).user;console.log("Usuario creado:",y),await Oe(J(M,"users",y.uid),{nombreUsuario:j,emailUsuario:P,rolUsuario:m}),k("Usuario registrado exitosamente"),u(""),N(""),i(""),h("vendedor")}catch($){console.error("Error al registrar el usuario:",$),$.code==="auth/email-already-in-use"?v("El correo electrónico ya está en uso. Por favor, use otro."):$.code==="permission-denied"?v("Permiso denegado. Verifica las reglas de seguridad."):v("Error al registrar el usuario")}};return e.jsxs("div",{children:[e.jsx("div",{className:"nav",children:e.jsx(_,{})}),e.jsxs("div",{className:"login-box",children:[e.jsx("p",{className:"form-title",children:"Registrar Usuario"}),e.jsxs("form",{className:"form",onSubmit:C,children:[e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"text",placeholder:"Nombre de Usuario",value:j,onChange:I=>u(I.target.value),required:!0})}),e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"email",placeholder:"Email",value:P,onChange:I=>N(I.target.value),required:!0})}),e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"password",placeholder:"Contraseña",value:n,onChange:I=>i(I.target.value),required:!0})}),e.jsx("div",{className:"input-container",children:e.jsxs("select",{value:m,onChange:I=>h(I.target.value),required:!0,children:[e.jsx("option",{value:"vendedor",children:"Vendedor"}),e.jsx("option",{value:"admin",children:"Administrador"})]})}),p&&e.jsx("p",{className:"signup-link",children:p}),g&&e.jsx("p",{className:"signup-link",children:g}),e.jsx("button",{className:"submit",type:"submit",children:"Registrar Usuario"})]})]})]})},ha=()=>{const[j,u]=t.useState(""),[P,N]=t.useState(""),[n,i]=t.useState(""),[m,h]=t.useState(""),[p,v]=t.useState(""),[g,k]=t.useState(""),[C,I]=t.useState(""),[$,y]=t.useState(""),[T,O]=t.useState(""),F=async()=>{try{const E=J(M,"productos",j);return(await fe(E)).exists()}catch(E){return console.error("Error checking product existence:",E),y("Error al verificar la existencia del producto"),!1}},R=async E=>{if(E.preventDefault(),await F()){y("El producto ya está registrado");return}try{const l=J(M,"productos",j);await Oe(l,{idProducto:j,nombreProducto:P,precioProducto:n,precioOriginal:m,categoriaProducto:p,marcaProducto:g,cantidadProducto:C}),O("Producto registrado exitosamente"),u(""),N(""),i(""),h(""),v(""),k(""),I(""),y("")}catch(l){y("Hubo un error al registrar el producto"),console.error("Error al registrar el producto:",l)}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"nav",children:e.jsx(_,{})}),e.jsx("div",{children:e.jsxs("div",{className:"productos-box",children:[e.jsx("p",{className:"form-title",children:"Ingresar Producto"}),e.jsxs("form",{className:"form-producto",onSubmit:R,children:[e.jsxs("div",{className:"detalle",children:[e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Código Producto"}),e.jsx("input",{type:"text",placeholder:"Id Producto",value:j,onChange:E=>u(E.target.value),required:!0})]}),e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Nombre producto"}),e.jsx("input",{type:"text",placeholder:"Nombre Producto",value:P,onChange:E=>N(E.target.value),required:!0})]}),e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Precio Producto"}),e.jsx("input",{type:"text",placeholder:"Precio Producto",value:n,onChange:E=>i(E.target.value),required:!0})]}),e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Precio Original"}),e.jsx("input",{type:"text",placeholder:"Precio Original",value:m,onChange:E=>h(E.target.value),required:!0})]}),e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Categoria Producto"}),e.jsx("input",{type:"text",placeholder:"Categoria Producto",value:p,onChange:E=>v(E.target.value),required:!0})]}),e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Marca Producto"}),e.jsx("input",{type:"text",placeholder:"Marca Producto",value:g,onChange:E=>k(E.target.value),required:!0})]}),e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Cantidad Producto"}),e.jsx("input",{type:"text",placeholder:"Cantidad Producto",value:C,onChange:E=>I(E.target.value),required:!0})]})]}),$&&e.jsx("p",{className:"form-title",children:$}),T&&e.jsx("p",{className:"form-title",children:T}),e.jsx("button",{className:"submit",type:"submit",children:"Agregar Producto"})]})]})})]})},xa=()=>{const{currentUser:j}=t.useContext(pe),[u,P]=t.useState([]),[N,n]=t.useState(""),[i,m]=t.useState([]),[h,p]=t.useState(!0),[v,g]=t.useState("efectivo"),[k,C]=t.useState(0),[I,$]=t.useState(0),[y,T]=t.useState(""),[O,F]=t.useState(1);t.useEffect(()=>{(async()=>{try{const c=(await Z(W(M,"productos"))).docs.map(U=>({id:U.id,...U.data()}));P(c)}catch(s){n("Error al obtener los productos"),console.error("Error al obtener los productos:",s)}finally{p(!1)}})()},[j]),t.useEffect(()=>{if(y.length>0){const a=u.find(s=>String(s.id)===y);a?(E(a,O),T(""),F(1)):(n("Producto no encontrado."),setTimeout(()=>{n(""),T(""),F(1)},3e3))}},[y,u,O]);const R=a=>{T(a.target.value)},E=(a,s)=>{m(c=>{const U=c.find(B=>B.id===a.id);return U?U.cantidad+s<=a.cantidadProducto?c.map(B=>B.id===a.id?{...B,cantidad:B.cantidad+s}:B):(alert("Stock insuficiente"),c):a.cantidadProducto>=s?[...c,{...a,cantidad:s,precioOriginal:a.precioOriginal}]:(alert("Stock insuficiente"),c)})},z=a=>{m(s=>{var B;const c=s.find(w=>w.id===a),U=(B=u.find(w=>w.id===a))==null?void 0:B.cantidadProducto;return c&&U>c.cantidad?s.map(w=>w.id===a?{...w,cantidad:w.cantidad+1}:w):(alert("Stock insuficiente"),s)})},l=a=>{m(s=>s.map(c=>c.id===a?{...c,cantidad:Math.max(1,c.cantidad-1)}:c))},o=a=>{m(s=>s.filter(c=>c.id!==a))},f=a=>{g(a.target.value),a.target.value==="efectivo"&&(C(0),$(0))},x=a=>{const s=parseFloat(a.target.value);C(s);const c=i.reduce((U,B)=>U+B.precioProducto*B.cantidad,0);$(s-c)},A=async a=>{a.preventDefault();const s=new Date,c=i.reduce((w,L)=>w+L.precioProducto*L.cantidad,0),U=i.map(w=>({idProducto:w.id,nombreProducto:w.nombreProducto,marcaProducto:w.marcaProducto,categoriaProducto:w.categoriaProducto,precioProducto:w.precioProducto,precioOriginal:w.precioOriginal,cantidad:w.cantidad,cantidadProducto:w.cantidadProducto})),B=ee.currentUser;try{await Ce(W(M,"sales"),{fechaVenta:s,totalVenta:c,tipoPago:v,idUsuario:B.uid,productos:U});const w=ye(M);i.forEach(L=>{const K=J(M,"productos",L.id);w.update(K,{cantidadProducto:L.cantidadProducto-L.cantidad})}),await w.commit(),m([]),alert("Venta registrada con éxito")}catch(w){n("Error al registrar la venta"),console.error("Error al registrar la venta:",w)}},S=a=>`${a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}`,d=i.reduce((a,s)=>a+s.cantidad,0),b=i.reduce((a,s)=>a+s.precioProducto*s.cantidad,0),r=i.reduce((a,s)=>a+(s.precioProducto-s.precioOriginal)*s.cantidad,0);return h?e.jsxs("div",{children:[e.jsx(_,{}),e.jsx("h1",{children:"Cargando productos..."})]}):e.jsxs("div",{children:[e.jsx("div",{className:"nav",children:e.jsx(_,{})}),e.jsx("main",{className:"main1",children:e.jsxs("div",{className:"layout",children:[e.jsx("div",{className:"columna-izquierda",children:e.jsxs("div",{className:"carrito-label",children:[e.jsx("p",{className:"form-title",children:"Carrito de compras"}),e.jsxs("div",{className:"encabezado",children:[e.jsx("input",{className:"carrito-input",type:"text",placeholder:"Buscar producto por ID...",value:y,onChange:R,onBlur:()=>{if(y.length>0){const a=u.find(s=>String(s.id)===y);a?(E(a),T("")):n("Producto no encontrado.")}}}),e.jsx("input",{className:"carrito-input",type:"number",placeholder:"Cantidad...",value:O,min:"1",onChange:a=>{const s=parseInt(a.target.value);F(s<1?1:s)}})]}),e.jsx("label",{className:"textp",htmlFor:"tipoPago",children:"Tipo de pago:"}),e.jsxs("select",{id:"tipoPago",value:v,onChange:f,className:"carrito-input",children:[e.jsx("option",{value:"efectivo",children:"Efectivo"}),e.jsx("option",{value:"tarjeta",children:"Tarjeta"})]}),N&&e.jsx("p",{className:"error",children:N}),e.jsxs("div",{className:"pago",children:[e.jsxs("p",{className:"textp",children:["Total productos: ",d]}),e.jsx("br",{}),e.jsxs("p",{className:"textp",children:["Total ganancia: $",S(r)]})," ",e.jsx("br",{}),e.jsxs("p",{className:"textp",children:["Total monto: $",S(b)]}),v==="efectivo"&&e.jsxs("div",{children:[e.jsx("label",{className:"textp",htmlFor:"cantidadEntregada",children:"Cantidad entregada:"}),e.jsx("input",{id:"cantidadEntregada",type:"number",value:k,onChange:x,className:"carrito-input"}),e.jsxs("p",{className:"textp",children:["Vuelto: $",S(I)]})]})]}),e.jsx("button",{className:"boton-venta",onClick:A,children:e.jsx("span",{children:"Finalizar Venta"})})]})}),e.jsx("div",{className:"columna-derecha",children:e.jsx("section",{className:"tabla-ventas",children:e.jsxs("table",{className:"carrito-tabla",children:[e.jsx("thead",{className:"carrito-th",children:e.jsxs("tr",{className:"carrito-tr",children:[e.jsx("th",{className:"carrito-th",children:"Producto"}),e.jsx("th",{className:"carrito-th",children:"Precio"}),e.jsx("th",{className:"carrito-th",children:"Precio Original"})," ",e.jsx("th",{className:"carrito-th",children:"Cantidad"}),e.jsx("th",{className:"carrito-th",children:"Total"}),e.jsx("th",{className:"carrito-th",children:"Acciones"})]})}),e.jsx("tbody",{className:"carrito-items",children:i.map(a=>e.jsxs("tr",{className:"carrito-tr",children:[e.jsx("td",{className:"carrito-td",children:e.jsx("p",{className:"txt-carrito",children:a.nombreProducto})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["$",S(a.precioProducto)]})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["$",S(a.precioOriginal)]})})," ",e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:[e.jsx("button",{className:"boton-resta",onClick:()=>l(a.id),children:e.jsx(H,{icon:Ee})}),a.cantidad,e.jsx("button",{className:"boton-suma",onClick:()=>z(a.id),children:e.jsx(H,{icon:De})})]})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["$",S(a.precioProducto*a.cantidad)]})}),e.jsx("td",{className:"carrito-td",children:e.jsx("button",{className:"boton-eliminar",onClick:()=>o(a.id),children:e.jsx(H,{icon:He})})})]},a.id))})]})})})]})})]})},ma=()=>{const[j,u]=t.useState([]),[P,N]=t.useState(""),[n,i]=t.useState([]),[m,h]=t.useState(!0),[p,v]=t.useState(!1),[g,k]=t.useState(null),[C,I]=t.useState({idProducto:"",nombreProducto:"",precioProducto:"",precioOriginal:"",categoriaProducto:"",marcaProducto:"",cantidadProducto:""});t.useEffect(()=>{(async()=>{try{const f=(await Z(W(M,"productos"))).docs.map(x=>({idProducto:x.id,...x.data()}));u(f),i(f)}catch{N("Error al cargar los productos. Intente más tarde.")}finally{h(!1)}})()},[]);const $=l=>{const o=l.target.value.toLowerCase();if(o==="")i(j);else{const f=j.filter(x=>{const A=String(x.idProducto).toLowerCase(),S=String(x.nombreProducto).toLowerCase(),d=String(x.precioProducto).toLowerCase(),b=String(x.categoriaProducto).toLowerCase(),r=String(x.marcaProducto).toLowerCase(),a=String(x.cantidadProducto).toLowerCase();return A.includes(o)||S.includes(o)||d.includes(o)||b.includes(o)||r.includes(o)||a.includes(o)});i(f)}},y=l=>l==null?"0":`${l.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}`,T=l=>{k(l),I({idProducto:l.idProducto,nombreProducto:l.nombreProducto,precioProducto:l.precioProducto,precioOriginal:l.precioOriginal,categoriaProducto:l.categoriaProducto,marcaProducto:l.marcaProducto,cantidadProducto:l.cantidadProducto}),v(!0)},O=l=>{const{name:o,value:f}=l.target;I({...C,[o]:f})},F=()=>{v(!1),k(null)},R=async l=>{l.preventDefault();try{const o=J(M,"productos",C.idProducto);await Fe(o,{nombreProducto:C.nombreProducto,precioProducto:Number(C.precioProducto),precioOriginal:Number(C.precioOriginal),categoriaProducto:C.categoriaProducto,marcaProducto:C.marcaProducto,cantidadProducto:Number(C.cantidadProducto)}),u(f=>f.map(x=>x.idProducto===g.idProducto?{...x,...C}:x)),i(f=>f.map(x=>x.idProducto===g.idProducto?{...x,...C}:x)),F()}catch(o){console.error("Error al actualizar el producto:",o)}};n.reduce((l,o)=>l+o.cantidadProducto,0);const E=n.reduce((l,o)=>l+o.precioProducto*o.cantidadProducto,0),z=n.reduce((l,o)=>l+o.precioOriginal*o.cantidadProducto,0);return m?e.jsx("p",{children:"Cargando productos..."}):P?e.jsx("p",{children:P}):e.jsxs("div",{children:[e.jsx("div",{className:"nav",children:e.jsx(_,{})}),e.jsxs("div",{className:"body-tabla",children:[e.jsxs("main",{className:"table",children:[e.jsxs("section",{className:"table-header",children:[e.jsxs("p",{className:"form-title",children:["Total del Inventario: $",y(E)]}),e.jsxs("p",{className:"form-title",children:["Total Original: $",y(z)]}),e.jsxs("div",{className:"container-input",children:[e.jsx("input",{type:"text",placeholder:"Buscar producto",name:"text",className:"input",onChange:$}),e.jsx("svg",{fill:"#000000",width:"20px",height:"20px",viewBox:"0 0 1920 1920",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M790.588 1468.235c-373.722 0-677.647-303.924-677.647-677.647 0-373.722 303.925-677.647 677.647-677.647 373.723 0 677.647 303.925 677.647 677.647 0 373.723-303.924 677.647-677.647 677.647Zm596.781-160.715c120.396-138.692 193.807-319.285 193.807-516.932C1581.176 354.748 1226.428 0 790.588 0S0 354.748 0 790.588s354.748 790.588 790.588 790.588c197.647 0 378.24-73.411 516.932-193.807l516.028 516.142 79.963-79.963-516.142-516.028Z",fillRule:"evenodd"})})]})]}),e.jsx("section",{className:"table-body",children:e.jsxs("table",{className:"tabla-inventario",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Codigo"}),e.jsx("th",{children:"Nombre"}),e.jsx("th",{children:"Precio"}),e.jsx("th",{children:"Precio Original"})," ",e.jsx("th",{children:"Ganancias"})," ",e.jsx("th",{children:"Categoria"}),e.jsx("th",{children:"Marca"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:n.length>0?n.map(l=>e.jsxs("tr",{children:[e.jsx("td",{children:l.idProducto}),e.jsx("td",{children:l.nombreProducto}),e.jsx("td",{children:y(l.precioProducto)}),e.jsx("td",{children:y(l.precioOriginal)})," ",e.jsx("td",{children:y(l.precioProducto-l.precioOriginal)})," ",e.jsx("td",{children:l.categoriaProducto}),e.jsx("td",{children:l.marcaProducto}),e.jsx("td",{children:e.jsx("p",{className:l.cantidadProducto<=5?"cantidad-baja":l.cantidadProducto<=15?"cantidad-media":"cantidad-alta",children:l.cantidadProducto})}),e.jsx("td",{children:e.jsx("button",{className:"btn-editar",onClick:()=>T(l),children:"Editar"})})]},l.idProducto)):e.jsx("tr",{children:e.jsx("td",{colSpan:"9",children:"No hay productos disponibles"})})})]})})]}),e.jsx(de,{open:p,onClose:F,children:g&&e.jsxs("div",{className:"formulario-editar",children:[e.jsx("p",{className:"form-title",children:"Editar Producto "}),e.jsxs("form",{onSubmit:R,children:[e.jsxs("label",{children:["Nombre:",e.jsx("input",{type:"text",name:"nombreProducto",value:C.nombreProducto,onChange:O})]}),e.jsxs("label",{children:["Precio:",e.jsx("input",{type:"number",name:"precioProducto",value:C.precioProducto,onChange:O})]}),e.jsxs("label",{children:["Precio Original:",e.jsx("input",{type:"number",name:"precioOriginal",value:C.precioOriginal,onChange:O})]}),e.jsxs("label",{children:["Categoria:",e.jsx("input",{type:"text",name:"categoriaProducto",value:C.categoriaProducto,onChange:O})]}),e.jsxs("label",{children:["Marca:",e.jsx("input",{type:"text",name:"marcaProducto",value:C.marcaProducto,onChange:O})]}),e.jsxs("label",{children:["Cantidad:",e.jsx("input",{type:"number",name:"cantidadProducto",value:C.cantidadProducto,onChange:O})]}),e.jsx("button",{type:"submit",children:"Actualizar Producto"}),e.jsx("button",{type:"button",onClick:F,children:"Cancelar"})]})]})})]})]})},ja=()=>{const[j,u]=t.useState([]),[P,N]=t.useState(""),[n,i]=t.useState([]),[m,h]=t.useState(!0);t.useState("efectivo");const[p,v]=t.useState(""),[g,k]=t.useState(1),[C,I]=t.useState(!1),[$,y]=t.useState(!1);t.useEffect(()=>{let o=!0;return(async()=>{try{const x=W(M,"productos"),S=(await Z(x)).docs.map(d=>({id:d.id,...d.data()}));o&&u(S)}catch(x){N("Error al obtener los productos"),console.error("Error al obtener los productos:",x)}finally{o&&h(!1)}})(),()=>{o=!1}},[]),t.useEffect(()=>{if(p.length>0){const o=j.find(f=>String(f.idProducto)===p);o?(C?F(o,g):O(o,g),v(""),k(1)):(N("Producto no encontrado."),setTimeout(()=>{N(""),v(""),k(1)},3e3))}},[p,j,g,C]);const T=o=>{v(o.target.value)},O=(o,f)=>{i(x=>x.find(S=>S.idProducto===o.idProducto)?x.map(S=>S.idProducto===o.idProducto?{...S,cantidad:S.cantidad+f}:S):[...x,{...o,cantidad:f}])},F=(o,f)=>{i(x=>x.find(S=>S.idProducto===o.idProducto)?x.map(S=>S.idProducto===o.idProducto?{...S,cantidad:S.cantidad+f}:S):[...x,{...o,cantidad:f}])},R=o=>{i(f=>f.map(x=>x.idProducto===o?{...x,cantidad:x.cantidad+1}:x))},E=o=>{i(f=>f.map(x=>x.idProducto===o?{...x,cantidad:Math.max(1,x.cantidad-1)}:x))},z=async o=>{o.preventDefault(),y(!0);const f=new Date,x=ee.currentUser;try{const A=n.reduce((r,a)=>r+a.precioProducto*a.cantidad,0),S=n.map(r=>({idProducto:r.idProducto,nombreProducto:r.nombreProducto,marcaProducto:r.marcaProducto,categoriaProducto:r.categoriaProducto,precioProducto:r.precioProducto,cantidad:r.cantidad})),d=x?x.uid:"";await Ce(W(M,"sales"),{fechaVenta:f,totalVenta:-A,idUsuario:d,productos:S,tipoPago:"devolución"});const b=ye(M);n.forEach(r=>{const a=J(M,"productos",r.idProducto),s=r.cantidadProducto+r.cantidad;b.update(a,{cantidadProducto:s})}),await b.commit(),i([]),v(""),k(1),y(!1),alert("Operación realizada con éxito")}catch(A){N("Error al registrar la operación"),console.error("Error al registrar la operación:",A),y(!1)}},l=o=>`${o.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}`;return m?e.jsxs("div",{children:[e.jsx(_,{}),e.jsx("h1",{children:"Cargando productos..."})]}):e.jsxs("div",{children:[e.jsx(_,{}),e.jsx("main",{className:"main1",children:e.jsxs("div",{className:"carrito-label",children:[e.jsx("p",{className:"form-title",children:"Devolución"}),e.jsx("hr",{}),e.jsxs("div",{className:"encabezado",children:[e.jsx("input",{className:"carrito-input",type:"text",placeholder:"Buscar producto por ID...",value:p,onChange:T,onBlur:()=>{if(p.length>0){const o=j.find(f=>String(f.idProducto)===p);o?(C?F(o,g):O(o,g),v("")):N("Producto no encontrado.")}}}),e.jsx("input",{className:"carrito-input",type:"number",placeholder:"Cantidad...",value:g,min:"1",onChange:o=>{const f=parseInt(o.target.value,10);k(f<1?1:f)}})]}),e.jsxs("table",{className:"carrito-tabla",children:[e.jsx("thead",{className:"carrito-th",children:e.jsxs("tr",{className:"carrito-tr",children:[e.jsx("th",{className:"carrito-th",children:"Producto"}),e.jsx("th",{className:"carrito-th",children:"Precio"}),e.jsx("th",{className:"carrito-th",children:"Cantidad"}),e.jsx("th",{className:"carrito-th",children:"Total"})]})}),e.jsx("tbody",{className:"carrito-items",children:n.map(o=>e.jsxs("tr",{className:"carrito-tr",children:[e.jsx("td",{className:"carrito-td",children:e.jsx("p",{className:"txt-carrito",children:o.nombreProducto})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["-$",l(o.precioProducto)]})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:[e.jsx("button",{className:"boton-resta",onClick:()=>E(o.idProducto),children:e.jsx(H,{icon:Ee})}),e.jsx("span",{className:"spanCarrito",children:o.cantidad}),e.jsx("button",{className:"boton-suma",onClick:()=>R(o.idProducto),children:e.jsx(H,{icon:De})})]})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["-$",l(o.precioProducto*o.cantidad)]})})]},o.idProducto))})]}),e.jsx("div",{className:"venta-label",children:e.jsx("div",{className:"totalcarro",children:e.jsxs("p",{className:"textp",children:["Total a Devolver: -$",l(n.reduce((o,f)=>o+f.cantidad*f.precioProducto,0))]})})}),e.jsx("div",{className:"bottom-container",children:e.jsx("button",{className:"boton-venta",onClick:z,disabled:n.length===0,children:e.jsx("span",{children:"Devolución"})})})]})})]})},Be=j=>{const u=new Date(j.seconds*1e3);return je(u,"dd/MM/yyyy")},pa=()=>{const[j,u]=t.useState([]),[P,N]=t.useState(""),[n,i]=t.useState(!0),[m,h]=t.useState(!1),[p,v]=t.useState(!1),[g,k]=t.useState(null),[C,I]=t.useState(null),[$,y]=t.useState("todos"),[T,O]=t.useState(new Date);t.useEffect(()=>{(async()=>{try{const a=W(M,"sales"),s=W(M,"users"),[c,U]=await Promise.all([Z(a),Z(s)]),B={};U.forEach(L=>{B[L.id]=L.data().nombreUsuario}),console.log("Users data:",B);const w=c.docs.map(L=>{const K=L.data();return console.log("Venta data:",K),{idVenta:L.id,...K,nombreUsuario:B[K.idUsuario]||"N/A"}});console.log("Ventas data:",w),u(w),i(!1)}catch(a){console.error("Error fetching data:",a),N("Ocurrió un error al cargar el historial de ventas"),i(!1)}})()},[]);const F=r=>{k(r),h(!0)},R=()=>{h(!1),k(null)},E=r=>{I(r),v(!0)},z=()=>{v(!1),I(null)},l=r=>{const{name:a,value:s}=r.target;k(c=>({...c,[a]:s}))},o=r=>{O(r)},f=async()=>{try{const r=J(M,"sales",g.idVenta);await Fe(r,{idUsuario:g.idUsuario,tipoPago:g.tipoPago,totalVenta:parseFloat(g.totalVenta)}),u(a=>a.map(s=>s.idVenta===g.idVenta?g:s)),R()}catch(r){console.error("Error updating sale:",r)}},S=((r,a)=>a==="todos"?r:r.filter(s=>s.tipoPago===a))(((r,a)=>{if(!a)return r;const s=je(new Date(a),"dd/MM/yyyy");return r.filter(c=>Be(c.fechaVenta)===s)})(j,T),$),d=r=>{switch(r){case"efectivo":return"Efectivo";case"tarjeta":return"Tarjeta";case"devolucion":return"Devolución";default:return r}},b=r=>isNaN(r)?"0":`${r.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}`;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"nav",children:e.jsx(_,{})}),e.jsx("div",{className:"body-tabla",children:e.jsxs("main",{className:"table",children:[e.jsxs("section",{className:"table-header",children:[e.jsxs("p",{className:"form-title",children:["Total del día: $",b(S.reduce((r,a)=>r+(parseFloat(a.totalVenta)||0),0))]}),e.jsx($e,{dateAdapter:Ae,children:e.jsx(Le,{className:"fecha",label:"Selecciona una fecha",value:T,onChange:r=>o(r),renderInput:r=>e.jsx(le,{...r,style:{marginBottom:"16px"}})})}),e.jsxs(Ve,{className:"seleccionar-pago",children:[e.jsx(ke,{id:"tipoPago-label",children:"Tipo de Pago"}),e.jsxs(Ue,{labelId:"tipoPago-label",id:"tipoPago",value:$,onChange:r=>y(r.target.value),children:[e.jsx(ae,{value:"todos",children:"Todos"}),e.jsx(ae,{value:"efectivo",children:"Efectivo"}),e.jsx(ae,{value:"tarjeta",children:"Tarjeta"}),e.jsx(ae,{value:"devolucion",children:"Devolución"})]})]}),e.jsx(X,{className:"btn-editar",onClick:()=>console.log("Exportar a Excel"),children:"Exportar a Excel"})]}),n?e.jsx("p",{children:"Cargando..."}):P?e.jsx("p",{className:"error-message",children:P}):S.length===0?e.jsx("p",{children:"No hay ventas registradas"}):e.jsx(Re,{component:ze,children:e.jsxs(ue,{children:[e.jsx(he,{children:e.jsxs(Y,{children:[e.jsx(D,{children:"ID Venta"}),e.jsx(D,{children:"Fecha"}),e.jsx(D,{children:"Nombre Usuario"}),e.jsx(D,{children:"Tipo Pago"}),e.jsx(D,{children:"Total Venta"}),e.jsx(D,{children:"Acciones"})]})}),e.jsx(xe,{children:S.map(r=>e.jsxs(Y,{children:[e.jsx(D,{children:r.idVenta}),e.jsx(D,{children:Be(r.fechaVenta)}),e.jsx(D,{children:r.nombreUsuario}),e.jsx(D,{children:d(r.tipoPago)}),e.jsxs(D,{children:["$",b(parseFloat(r.totalVenta)||0)]}),e.jsxs(D,{children:[e.jsx(X,{variant:"outlined",onClick:()=>E(r),children:"Detalle"}),e.jsx(X,{variant:"outlined",onClick:()=>F(r),children:"Editar"})]})]},r.idVenta))})]})})]})}),m&&e.jsxs(de,{open:m,onClose:R,children:[e.jsx(be,{children:"Editar Venta"}),e.jsx(Ne,{children:g&&e.jsxs("div",{children:[e.jsxs(Ve,{fullWidth:!0,margin:"normal",children:[e.jsx(ke,{id:"tipoPago-label",children:"Tipo de Pago"}),e.jsxs(Ue,{labelId:"tipoPago-label",id:"tipoPago",name:"tipoPago",value:g.tipoPago,onChange:l,children:[e.jsx(ae,{value:"efectivo",children:"Efectivo"}),e.jsx(ae,{value:"tarjeta",children:"Tarjeta"}),e.jsx(ae,{value:"devolucion",children:"Devolución"})]})]}),e.jsx(le,{label:"Total Venta",name:"totalVenta",value:g.totalVenta,onChange:l,fullWidth:!0,margin:"normal"})]})}),e.jsxs(Se,{children:[e.jsx(X,{onClick:R,children:"Cancelar"}),e.jsx(X,{onClick:f,color:"primary",children:"Guardar"})]})]}),p&&e.jsxs(de,{open:p,onClose:z,children:[e.jsx(be,{children:"Detalle de Venta"}),e.jsx(Ne,{children:C&&e.jsxs(ue,{children:[e.jsx(he,{children:e.jsxs(Y,{children:[e.jsx(D,{children:"ID Producto"}),e.jsx(D,{children:"Nombre Producto"}),e.jsx(D,{children:"Cantidad"}),e.jsx(D,{children:"Precio"})]})}),e.jsx(xe,{children:C.productos.map(r=>e.jsxs(Y,{children:[e.jsx(D,{children:r.idProducto}),e.jsx(D,{children:r.nombreProducto}),e.jsx(D,{children:r.cantidad}),e.jsxs(D,{children:["$",b(r.precio)]})]},r.idProducto))})]})}),e.jsx(Se,{children:e.jsx(X,{onClick:z,children:"Cerrar"})})]})]})},Pe=j=>{try{if(j&&j.seconds){const u=new Date(j.seconds*1e3);return je(u,"dd/MM/yyyy")}return""}catch(u){return console.error("Error formatting date:",u),""}},ga=()=>{const[j,u]=t.useState([]),[P,N]=t.useState({}),[n,i]=t.useState({}),[m,h]=t.useState({}),[p,v]=t.useState(0),[g,k]=t.useState(!0),[C,I]=t.useState(null),[$,y]=t.useState(!1),[T,O]=t.useState(null),[F,R]=t.useState(new Date),[E,z]=t.useState("todos");t.useEffect(()=>{(async()=>{try{const s=W(M,"sales"),c=W(M,"users"),U=W(M,"products"),B=aa(s,ta(50)),[w,L,K]=await Promise.all([Z(B),Z(c),Z(U)]),re={};L.forEach(G=>{re[G.id]=G.data().nombreUsuario});const se={};K.forEach(G=>{se[G.id]=G.data().nombreProducto});const ge=w.docs.map(G=>{var oe;const te=G.data();return{idVenta:G.id,...te,nombreUsuario:re[te.idUsuario]||"N/A",fecha:(oe=te.fecha)!=null&&oe.toDate?te.fecha.toDate():new Date}}),ie=l(o(ge,F),E);f(ie,se),u(ie),k(!1)}catch(s){console.error("Error fetching data:",s),I("Ocurrió un error al cargar el historial de ventas"),k(!1)}})()},[F,E]);const l=(a,s)=>s==="todos"?a:a.filter(c=>c.tipoPago===s),o=(a,s)=>{if(!s)return a;const c=je(new Date(s),"dd/MM/yyyy");return a.filter(U=>Pe(U.fecha)===c)},f=(a,s)=>{const c={},U={},B={};let w=0;a.forEach(L=>{const{tipoPago:K,totalVenta:re,nombreUsuario:se,productos:ge}=L;c[K]=(c[K]||0)+1,U[se]=(U[se]||0)+re,ge.forEach(ie=>{const{idProducto:G,cantidad:te}=ie,oe=s[G]||G;B[oe]=(B[oe]||0)+te}),w+=re}),N(c),i(U),h(B),v(w)},x=a=>{O(a),y(!0)},A=()=>{y(!1),O(null)},S=a=>isNaN(a)?"0":`${a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}`,d={labels:Object.keys(P),datasets:[{label:"Ventas por Tipo de Pago",data:Object.values(P),backgroundColor:["rgba(75, 192, 192, 0.6)","rgba(153, 102, 255, 0.6)","rgba(255, 159, 64, 0.6)"]}]},b={labels:Object.keys(n),datasets:[{label:"Ventas por Usuario",data:Object.values(n),backgroundColor:["rgba(255, 99, 132, 0.6)","rgba(54, 162, 235, 0.6)","rgba(255, 206, 86, 0.6)","rgba(75, 192, 192, 0.6)","rgba(153, 102, 255, 0.6)","rgba(255, 159, 64, 0.6)"]}]},r={labels:Object.keys(m),datasets:[{label:"Ventas por Producto",data:Object.values(m),backgroundColor:["rgba(54, 162, 235, 0.6)","rgba(255, 99, 132, 0.6)","rgba(75, 192, 192, 0.6)","rgba(255, 206, 86, 0.6)","rgba(153, 102, 255, 0.6)","rgba(255, 159, 64, 0.6)"]}]};return g?e.jsx("p",{children:"Cargando..."}):C?e.jsxs("p",{children:["Error: ",C]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"nav",children:e.jsx(_,{})}),e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"date-filter",children:[e.jsx("h3",{children:"Filtrar por Fecha"}),e.jsx($e,{dateAdapter:Ae,children:e.jsx(Le,{value:F,onChange:a=>R(a),renderInput:a=>e.jsx(le,{...a,style:{marginBottom:"16px"}})})})]}),e.jsx("div",{className:"metrics",children:e.jsxs("h2",{children:["Total Ventas: $",S(p.toFixed(0))]})}),e.jsxs("div",{className:"charts-container",children:[e.jsx("div",{className:"pie-chart",children:e.jsx(na,{data:d})}),e.jsxs("div",{className:"bar-charts",children:[e.jsxs("div",{className:"chart",children:[e.jsx("h3",{children:"Ventas por Usuario"}),e.jsx(Te,{data:b})]}),e.jsxs("div",{className:"chart",children:[e.jsx("h3",{children:"Ventas por Producto"}),e.jsx(Te,{data:r})]})]})]}),e.jsx(Re,{component:ze,children:e.jsxs(ue,{children:[e.jsx(he,{children:e.jsxs(Y,{children:[e.jsx(D,{children:"ID Venta"}),e.jsx(D,{children:"Fecha"}),e.jsx(D,{children:"Usuario"}),e.jsx(D,{children:"Total Venta"}),e.jsx(D,{children:"Detalles"})]})}),e.jsx(xe,{children:j.map(a=>e.jsxs(Y,{children:[e.jsx(D,{children:a.idVenta}),e.jsx(D,{children:Pe(a.fecha)}),e.jsx(D,{children:a.nombreUsuario}),e.jsxs(D,{children:["$",S(a.totalVenta.toFixed(0))]}),e.jsx(D,{children:e.jsx(X,{onClick:()=>x(a),children:"Ver Detalles"})})]},a.idVenta))})]})}),T&&e.jsxs(de,{open:$,onClose:A,children:[e.jsx(be,{children:"Detalles de la Venta"}),e.jsx(Ne,{children:e.jsxs("div",{children:[e.jsxs("h3",{children:["ID Venta: ",T.idVenta]}),e.jsxs("p",{children:["Fecha: ",Pe(T.fecha)]}),e.jsxs("p",{children:["Usuario: ",T.nombreUsuario]}),e.jsxs("p",{children:["Total Venta: $",S(T.totalVenta.toFixed(0))]}),e.jsx("h4",{children:"Productos:"}),e.jsxs(ue,{children:[e.jsx(he,{children:e.jsxs(Y,{children:[e.jsx(D,{children:"Producto"}),e.jsx(D,{children:"Cantidad"})]})}),e.jsx(xe,{children:T.productos.map((a,s)=>e.jsxs(Y,{children:[e.jsx(D,{children:a.nombreProducto||"Desconocido"}),e.jsx(D,{children:a.cantidad})]},s))})]})]})}),e.jsx(Se,{children:e.jsx(X,{onClick:A,children:"Cerrar"})})]})]})]})},Pa=()=>{const j=me(),[u,P]=ne.useState(!1),{signOut:N}=we(),n=async()=>{try{await N(),j("/")}catch(h){console.error("Error al cerrar sesión:",h)}},i=()=>{P(!u)},m=()=>{P(!1)};return ne.useEffect(()=>{const h=()=>{window.innerWidth>=800&&m()};return window.addEventListener("resize",h),()=>{window.removeEventListener("resize",h)}},[]),e.jsxs("nav",{className:"navbar",children:[e.jsxs("ul",{className:`sidebar ${u?"visible":""}`,children:[e.jsx("li",{onClick:m,children:e.jsx(V,{className:"menu",to:"#",children:e.jsx(H,{icon:qe})})}),e.jsx("li",{children:e.jsx(V,{className:"link",to:"/vendedor/ventas",children:"Venta"})}),e.jsx("li",{children:e.jsx(V,{className:"link",to:"/vendedor/inventario",children:"Inventario"})}),e.jsx("li",{children:e.jsx(V,{className:"link",to:"/vendedor/devolucion",children:"Devolución"})}),e.jsx("li",{children:e.jsx(V,{className:"link",onClick:n,children:"Cerrar Sesion"})})]}),e.jsxs("ul",{children:[e.jsx("li",{className:"Mobile",children:e.jsx(V,{className:"link",to:"/vendedor/inventario",children:"Inventario"})}),e.jsx("li",{className:"Mobile",children:e.jsx(V,{className:"link",to:"/vendedor/ventas",children:"Venta"})}),e.jsx("li",{className:"Mobile",children:e.jsx(V,{className:"link",to:"/vendedor/devolucion",children:"Devolución"})}),e.jsx("li",{className:"Mobile",children:e.jsx(V,{className:"link",onClick:n,children:"Cerrar Sesion"})}),e.jsx("li",{onClick:i,children:e.jsx(V,{className:"menu",to:"#",children:e.jsx(H,{icon:We})})})]})]})},fa=()=>{const{currentUser:j}=t.useContext(pe),[u,P]=t.useState([]),[N,n]=t.useState(""),[i,m]=t.useState([]),[h,p]=t.useState(!0),[v,g]=t.useState("efectivo"),[k,C]=t.useState(0),[I,$]=t.useState(0),[y,T]=t.useState(""),[O,F]=t.useState(1);t.useEffect(()=>{(async()=>{try{const r=(await Z(W(M,"productos"))).docs.map(a=>({id:a.id,...a.data()}));P(r)}catch(b){n("Error al obtener los productos"),console.error("Error al obtener los productos:",b)}finally{p(!1)}})()},[j]),t.useEffect(()=>{if(y.length>0){const d=u.find(b=>String(b.id)===y);d?(E(d,O),T(""),F(1)):(n("Producto no encontrado."),setTimeout(()=>{n(""),T(""),F(1)},3e3))}},[y,u,O]);const R=d=>{T(d.target.value)},E=(d,b)=>{m(r=>{const a=r.find(s=>s.id===d.id);return a?a.cantidad+b<=d.cantidadProducto?r.map(s=>s.id===d.id?{...s,cantidad:s.cantidad+b}:s):(alert("Stock insuficiente"),r):d.cantidadProducto>=b?[...r,{...d,cantidad:b}]:(alert("Stock insuficiente"),r)})},z=d=>{m(b=>{var s;const r=b.find(c=>c.id===d),a=(s=u.find(c=>c.id===d))==null?void 0:s.cantidadProducto;return r&&a>r.cantidad?b.map(c=>c.id===d?{...c,cantidad:c.cantidad+1}:c):(alert("Stock insuficiente"),b)})},l=d=>{m(b=>b.map(r=>r.id===d?{...r,cantidad:Math.max(1,r.cantidad-1)}:r))},o=d=>{m(b=>b.filter(r=>r.id!==d))},f=d=>{g(d.target.value),d.target.value==="efectivo"&&(C(0),$(0))},x=d=>{const b=parseFloat(d.target.value);C(b);const r=i.reduce((a,s)=>a+s.precioProducto*s.cantidad,0);$(b-r)},A=async d=>{d.preventDefault();const b=new Date,r=i.reduce((c,U)=>c+U.precioProducto*U.cantidad,0),a=i.map(c=>({idProducto:c.id,nombreProducto:c.nombreProducto,marcaProducto:c.marcaProducto,categoriaProducto:c.categoriaProducto,precioProducto:c.precioProducto,cantidad:c.cantidad,cantidadProducto:c.cantidadProducto})),s=ee.currentUser;try{await Ce(W(M,"sales"),{fechaVenta:b,totalVenta:r,tipoPago:v,idUsuario:s.uid,productos:a});const c=ye(M);i.forEach(U=>{const B=J(M,"productos",U.id);c.update(B,{cantidadProducto:U.cantidadProducto-U.cantidad})}),await c.commit(),m([]),alert("Venta registrada con éxito")}catch(c){n("Error al registrar la venta"),console.error("Error al registrar la venta:",c)}},S=d=>`${d.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}`;return h?e.jsx("div",{children:e.jsx("h1",{children:"Cargando productos..."})}):e.jsxs("div",{children:[e.jsx("div",{className:"nav",children:e.jsx(Pa,{})}),e.jsx("main",{className:"main1",children:e.jsxs("div",{className:"carrito-label",children:[e.jsx("p",{className:"form-title",children:"Carrito de compras"}),e.jsx("hr",{}),e.jsxs("div",{className:"encabezado",children:[e.jsx("input",{className:"carrito-input",type:"text",placeholder:"Buscar producto por ID...",value:y,onChange:R,onBlur:()=>{if(y.length>0){const d=u.find(b=>String(b.id)===y);d?(E(d),T("")):n("Producto no encontrado.")}}}),e.jsx("input",{className:"carrito-input",type:"number",placeholder:"Cantidad...",value:O,min:"1",onChange:d=>{const b=parseInt(d.target.value);F(b<1?1:b)}})]}),N&&e.jsx("p",{className:"error",children:N}),e.jsx("section",{className:"tabla-ventas",children:e.jsxs("table",{className:"carrito-tabla",children:[e.jsx("thead",{className:"carrito-th",children:e.jsxs("tr",{className:"carrito-tr",children:[e.jsx("th",{className:"carrito-th",children:"Producto"}),e.jsx("th",{className:"carrito-th",children:"Precio"}),e.jsx("th",{className:"carrito-th",children:"Cantidad"}),e.jsx("th",{className:"carrito-th",children:"Total"}),e.jsx("th",{className:"carrito-th",children:"Acciones"})]})}),e.jsx("tbody",{className:"carrito-items",children:i.map(d=>e.jsxs("tr",{className:"carrito-tr",children:[e.jsx("td",{className:"carrito-td",children:e.jsx("p",{className:"txt-carrito",children:d.nombreProducto})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["$",S(d.precioProducto)]})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:[e.jsx("button",{className:"boton-resta",onClick:()=>l(d.idProducto),children:e.jsx(H,{icon:Ee})}),d.cantidad,e.jsx("button",{className:"boton-suma",onClick:()=>z(d.idProducto),children:e.jsx(H,{icon:De})})]})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["$",S(d.precioProducto*d.cantidad)]})}),e.jsx("td",{className:"carrito-td",children:e.jsx("button",{className:"boton-eliminar",onClick:()=>o(d.idProducto),children:e.jsx(H,{icon:He})})})]},d.idProducto))})]})}),e.jsxs("div",{className:"pago",children:[e.jsx("label",{htmlFor:"tipoPago",children:"Tipo de pago:"}),e.jsxs("select",{id:"tipoPago",value:v,onChange:f,className:"carrito-input",children:[e.jsx("option",{value:"efectivo",children:"Efectivo"}),e.jsx("option",{value:"tarjeta",children:"Tarjeta"})]}),v==="efectivo"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"cantidadEntregada",children:"Cantidad entregada:"}),e.jsx("input",{id:"cantidadEntregada",type:"number",value:k,onChange:x,className:"carrito-input"}),e.jsxs("p",{className:"textp",children:["Vuelto: $",S(I)]})]})]}),e.jsx("button",{className:"boton-venta",onClick:A,children:e.jsx("span",{children:"Finalizar Venta"})})]})})]})};function Q({children:j,allowedRoles:u}){const{user:P,role:N}=we();return P?u&&!u.includes(N)?e.jsx(ve,{to:"/unauthorized"}):j:e.jsx(ve,{to:"/login"})}function va(){return e.jsxs(oa,{children:[e.jsx(q,{path:"/",element:e.jsx(ve,{to:"/login"})}),e.jsx(q,{path:"/login",element:e.jsx(la,{})}),e.jsx(q,{path:"/resetPassword",element:e.jsx(da,{})}),e.jsx(q,{path:"/agregarUsuario",element:e.jsx(Q,{allowedRoles:["admin"],children:e.jsx(ua,{})})}),e.jsx(q,{path:"/agregarProducto",element:e.jsx(Q,{allowedRoles:["admin"],children:e.jsx(ha,{})})}),e.jsx(q,{path:"/dashboard",element:e.jsx(Q,{allowedRoles:["admin"],children:e.jsx(ga,{})})}),e.jsx(q,{path:"/ventas",element:e.jsx(Q,{allowedRoles:["admin","vendedor"],children:e.jsx(xa,{})})}),e.jsx(q,{path:"/inventario",element:e.jsx(Q,{allowedRoles:["admin"],children:e.jsx(ma,{})})}),e.jsx(q,{path:"/devolucion",element:e.jsx(Q,{allowedRoles:["admin","vendedor"],children:e.jsx(ja,{})})}),e.jsx(q,{path:"/historial",element:e.jsx(Q,{allowedRoles:["admin"],children:e.jsx(pa,{})})}),e.jsx(q,{path:"/vendedor/ventas",element:e.jsx(Q,{allowedRoles:["vendedor"],children:e.jsx(fa,{})})}),e.jsx(q,{path:"/unauthorized",element:e.jsx("div",{children:"Unauthorized - You do not have permission to view this page."})})]})}Ge.createRoot(document.getElementById("root")).render(e.jsx(ne.StrictMode,{children:e.jsx(ra,{children:e.jsx(ia,{children:e.jsx(va,{})})})}));
