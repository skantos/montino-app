import{r,j as e,a as ee}from"./react-MB1aJdB0.js";import{c as Me}from"./react-dom-babtui9j.js";import{g as Ee,s as Le,a as we,b as $e,c as Ae}from"./firebase-BOREzNWu.js";import{u as Fe,v as Re,w as ze,x as qe,y as Ge,z as J,A as ne,B as De,D as K,G as W,H as de,I as ue,J as ke}from"./@firebase-Bzy7ECXp.js";import{L as D,B as We}from"./react-router-dom-BP5qz8hL.js";import{a as se,b as He,d as Je,e as G,f as ce}from"./react-router-BDFDsiw1.js";import{T as re,B as Q,D as ie,L as Ve,A as Ue,a as Te,F as pe,I as ge,S as fe,M as Y,b as Ke,P as Xe,c as Pe,d as ve,e as te,f as A,g as be,h as Ne,i as Se,j as Ce}from"./@mui-D6ajMDpQ.js";import{F as H,f as Be,a as Ie,b as he,c as xe,d as Oe}from"./@fortawesome-CTlQ_N8p.js";import{f as le,t as Ze,m as _e}from"./date-fns-5tFtsWfW.js";import{P as Ye,B as ye}from"./react-chartjs-2-BMTf87bo.js";import"./chart.js-C_W9Dm9B.js";import"./@babel-DdaQcUjw.js";import"./scheduler-CzFDRTuY.js";import"./tslib-BGVaTf34.js";import"./safevalues-NrgD-8pg.js";import"./idb-Bn1DMRyg.js";import"./@remix-run-BFLWy9pZ.js";import"./react-is-DcfIKM1A.js";import"./clsx-B-dksMZM.js";import"./@emotion-D2LlJvDI.js";import"./hoist-non-react-statics-DQogQWOa.js";import"./stylis-FDnFs_-n.js";import"./prop-types-D-iIXjl8.js";import"./react-transition-group-DD9RWrmj.js";import"./dom-helpers-D0mFdbeO.js";import"./@popperjs-BQBsAJpH.js";import"./@kurkle-BZxJdD1U.js";(function(){const g=document.createElement("link").relList;if(g&&g.supports&&g.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))S(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const m of l.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&S(m)}).observe(document,{childList:!0,subtree:!0});function P(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function S(o){if(o.ep)return;o.ep=!0;const l=P(o);fetch(o.href,l)}})();const Qe={apiKey:"AIzaSyAP7Af1h_-zBmBfL_A5K2uuJsJDFuOel0c",authDomain:"local-js-d7712.firebaseapp.com",databaseURL:"https://local-js-d7712-default-rtdb.firebaseio.com",projectId:"local-js-d7712",storageBucket:"local-js-d7712.appspot.com",messagingSenderId:"200538761653",appId:"1:200538761653:web:571a969ac8a572328451fc",measurementId:"G-XXD5WT5TV1"},ae=Fe(Qe),_=Ee(ae),O=Re(ae);ze(ae);qe(ae);Ge(ae);const oe=r.createContext();function ea({children:N}){const[g,P]=r.useState(null),[S,o]=r.useState(null);r.useEffect(()=>{const h=_.onAuthStateChanged(async p=>{if(p){P(p);const b=J(O,"users",p.uid),f=await ne(b);f.exists()?o(f.data().rolUsuario):o(null)}else P(null),o(null)});return()=>h()},[]);const l=async(h,p)=>{try{const b=await Le(_,h,p);P(b.user);const f=J(O,"users",b.user.uid),k=await ne(f);k.exists()?o(k.data().rolUsuario):o(null)}catch(b){throw console.error("Error signing in:",b),b}},m=async()=>{try{await we(_),P(null),o(null)}catch(h){throw console.error("Error signing out:",h),h}};return e.jsx(oe.Provider,{value:{user:g,role:S,signIn:l,signOut:m},children:N})}function me(){return r.useContext(oe)}function aa(){const[N,g]=r.useState(""),[P,S]=r.useState(""),[o,l]=r.useState(""),m=se(),{signIn:h,role:p}=me(),b=async f=>{f.preventDefault(),l("");try{await h(N,P)}catch(k){l("Usuario o contraseña incorrectos"),console.error("Error al iniciar sesión:",k)}};return r.useEffect(()=>{p&&(p==="admin"?m("/ventas"):p==="vendedor"?m("/vendedor/ventas"):l("Rol de usuario no reconocido"))},[p,m]),e.jsx("div",{children:e.jsx("div",{className:"login-box",children:e.jsxs("form",{className:"form",onSubmit:b,children:[e.jsxs("p",{className:"form-title",children:["Los Tios ",e.jsx("br",{}),"Iniciar Sesión"]}),e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"email",placeholder:"Email",value:N,onChange:f=>g(f.target.value),required:!0})}),e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"password",placeholder:"Contraseña",value:P,onChange:f=>S(f.target.value),required:!0})}),o&&e.jsx("p",{className:"signup-link",children:o}),e.jsx("button",{type:"submit",className:"submit",children:"Ingresar"}),e.jsx("p",{className:"signup-link",children:e.jsx(D,{to:"/resetPassword",className:"resetPassword",children:"Olvidé mi Contraseña"})})]})})})}const ta=()=>{const[N,g]=r.useState(""),[P,S]=r.useState(!1),[o,l]=r.useState(null),m=se(),h=()=>{$e(_,N).then(()=>{S(!0),setTimeout(()=>{m("/")},6e3)}).catch(p=>{l("No se pudo enviar el correo electrónico de restablecimiento de contraseña.")})};return e.jsxs("div",{className:"recuperar-contrasena",children:[e.jsx("h1",{children:"Recuperar Contraseña"}),P?e.jsx("p",{children:"Se ha enviado un correo electrónico con instrucciones para restablecer tu contraseña."}):e.jsxs(e.Fragment,{children:[e.jsx(re,{type:"email",label:"Correo Electrónico",value:N,onChange:p=>g(p.target.value),sx:{width:"16%"}}),e.jsx(Q,{onClick:h,variant:"outlined",sx:{fontSize:"19px",marginBottom:"19px",top:"10px"},children:"Enviar"}),o&&e.jsx("p",{style:{color:"red"},children:o})]})]})},X=()=>{const N=se(),g=He(),[P,S]=ee.useState(!1),o=async()=>{const p=Ee();try{await we(p),localStorage.removeItem("token"),N("/")}catch(b){console.error("Error al cerrar sesión:",b)}},l=()=>{S(!P)},m=()=>{S(!1)};ee.useEffect(()=>{const p=()=>{window.innerWidth>=800&&m()};return window.addEventListener("resize",p),()=>{window.removeEventListener("resize",p)}},[]);const h=p=>g.pathname===p?"active":"";return e.jsxs("nav",{className:"navbar",children:[e.jsxs("ul",{className:`sidebar ${P?"visible":""}`,children:[e.jsx("li",{onClick:m,children:e.jsx(D,{className:"menu",to:"#",children:e.jsx(H,{icon:Be})})}),e.jsx("li",{children:e.jsx(D,{className:`link ${h("/ventas")}`,to:"/ventas",children:"Venta"})}),e.jsx("li",{children:e.jsx(D,{className:`link ${h("/agregarProducto")}`,to:"/agregarProducto",children:"Agregar Producto"})}),e.jsx("li",{children:e.jsx(D,{className:`link ${h("/agregarUsuario")}`,to:"/agregarUsuario",children:"Agregar Usuario"})}),e.jsx("li",{children:e.jsx(D,{className:`link ${h("/inventario")}`,to:"/inventario",children:"Inventario"})}),e.jsx("li",{children:e.jsx(D,{className:`link ${h("/devolucion")}`,to:"/devolucion",children:"Devolución"})}),e.jsx("li",{children:e.jsx(D,{className:`link ${h("/dashboard")}`,to:"/dashboard",children:"Dashboard"})}),e.jsx("li",{children:e.jsx(D,{className:`link ${h("/historial")}`,to:"/historial",children:"Historial"})}),e.jsx("li",{children:e.jsx(D,{className:"link",onClick:o,children:"Cerrar Sesión"})})]}),e.jsxs("ul",{children:[e.jsx("li",{className:"Mobile",children:e.jsx(D,{className:`link ${h("/dashboard")}`,to:"/dashboard",children:"Dashboard"})}),e.jsx("li",{className:"Mobile",children:e.jsx(D,{className:`link ${h("/agregarProducto")}`,to:"/agregarProducto",children:"Agregar Producto"})}),e.jsx("li",{className:"Mobile",children:e.jsx(D,{className:`link ${h("/agregarUsuario")}`,to:"/agregarUsuario",children:"Agregar Usuario"})}),e.jsx("li",{className:"Mobile",children:e.jsx(D,{className:`link ${h("/devolucion")}`,to:"/devolucion",children:"Devolución"})}),e.jsx("li",{className:"Mobile",children:e.jsx(D,{className:`link ${h("/ventas")}`,to:"/ventas",children:"Venta"})}),e.jsx("li",{className:"Mobile",children:e.jsx(D,{className:`link ${h("/inventario")}`,to:"/inventario",children:"Inventario"})}),e.jsx("li",{className:"Mobile",children:e.jsx(D,{className:`link ${h("/historial")}`,to:"/historial",children:"Historial"})}),e.jsx("li",{className:"Mobile",children:e.jsx(D,{className:"link",onClick:o,children:"Cerrar Sesión"})}),e.jsx("li",{onClick:l,children:e.jsx(D,{className:"menu",to:"#",children:e.jsx(H,{icon:Ie})})})]})]})},ra=()=>{const[N,g]=r.useState(""),[P,S]=r.useState(""),[o,l]=r.useState(""),[m,h]=r.useState("vendedor"),[p,b]=r.useState(""),[f,k]=r.useState(""),y=async I=>{I.preventDefault(),console.log("Nombre de Usuario:",N),console.log("Email:",P),console.log("Contraseña:",o),console.log("Rol:",m);try{const E=(await Ae(_,P,o)).user;console.log("Usuario creado:",E),await De(J(O,"users",E.uid),{nombreUsuario:N,emailUsuario:P,rolUsuario:m}),k("Usuario registrado exitosamente"),g(""),S(""),l(""),h("vendedor")}catch(M){console.error("Error al registrar el usuario:",M),M.code==="auth/email-already-in-use"?b("El correo electrónico ya está en uso. Por favor, use otro."):M.code==="permission-denied"?b("Permiso denegado. Verifica las reglas de seguridad."):b("Error al registrar el usuario")}};return e.jsxs("div",{children:[e.jsx("div",{className:"nav",children:e.jsx(X,{})}),e.jsxs("div",{className:"login-box",children:[e.jsx("p",{className:"form-title",children:"Registrar Usuario"}),e.jsxs("form",{className:"form",onSubmit:y,children:[e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"text",placeholder:"Nombre de Usuario",value:N,onChange:I=>g(I.target.value),required:!0})}),e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"email",placeholder:"Email",value:P,onChange:I=>S(I.target.value),required:!0})}),e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"password",placeholder:"Contraseña",value:o,onChange:I=>l(I.target.value),required:!0})}),e.jsx("div",{className:"input-container",children:e.jsxs("select",{value:m,onChange:I=>h(I.target.value),required:!0,children:[e.jsx("option",{value:"vendedor",children:"Vendedor"}),e.jsx("option",{value:"admin",children:"Administrador"})]})}),p&&e.jsx("p",{className:"signup-link",children:p}),f&&e.jsx("p",{className:"signup-link",children:f}),e.jsx("button",{className:"submit",type:"submit",children:"Registrar Usuario"})]})]})]})},sa=()=>{const[N,g]=r.useState(""),[P,S]=r.useState(""),[o,l]=r.useState(""),[m,h]=r.useState(""),[p,b]=r.useState(""),[f,k]=r.useState(""),[y,I]=r.useState(""),[M,E]=r.useState(""),[L,$]=r.useState(""),F=async()=>{try{const w=J(O,"productos",N);return(await ne(w)).exists()}catch(w){return console.error("Error checking product existence:",w),E("Error al verificar la existencia del producto"),!1}},R=async w=>{if(w.preventDefault(),await F()){E("El producto ya está registrado");return}try{const u=J(O,"productos",N);await De(u,{idProducto:N,nombreProducto:P,precioProducto:o,precioOriginal:m,categoriaProducto:p,marcaProducto:f,cantidadProducto:y}),$("Producto registrado exitosamente"),g(""),S(""),l(""),h(""),b(""),k(""),I(""),E("")}catch(u){E("Hubo un error al registrar el producto"),console.error("Error al registrar el producto:",u)}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"nav",children:e.jsx(X,{})}),e.jsx("div",{children:e.jsxs("div",{className:"productos-box",children:[e.jsx("p",{className:"form-title",children:"Ingresar Producto"}),e.jsxs("form",{className:"form-producto",onSubmit:R,children:[e.jsxs("div",{className:"detalle",children:[e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Código Producto"}),e.jsx("input",{type:"text",placeholder:"Id Producto",value:N,onChange:w=>g(w.target.value),required:!0})]}),e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Nombre producto"}),e.jsx("input",{type:"text",placeholder:"Nombre Producto",value:P,onChange:w=>S(w.target.value),required:!0})]}),e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Precio Producto"}),e.jsx("input",{type:"text",placeholder:"Precio Producto",value:o,onChange:w=>l(w.target.value),required:!0})]}),e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Precio Original"}),e.jsx("input",{type:"text",placeholder:"Precio Original",value:m,onChange:w=>h(w.target.value),required:!0})]}),e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Categoria Producto"}),e.jsx("input",{type:"text",placeholder:"Categoria Producto",value:p,onChange:w=>b(w.target.value),required:!0})]}),e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Marca Producto"}),e.jsx("input",{type:"text",placeholder:"Marca Producto",value:f,onChange:w=>k(w.target.value),required:!0})]}),e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Cantidad Producto"}),e.jsx("input",{type:"text",placeholder:"Cantidad Producto",value:y,onChange:w=>I(w.target.value),required:!0})]})]}),M&&e.jsx("p",{className:"form-title",children:M}),L&&e.jsx("p",{className:"form-title",children:L}),e.jsx("button",{className:"submit",type:"submit",children:"Agregar Producto"})]})]})})]})},oa=()=>{const{currentUser:N}=r.useContext(oe),[g,P]=r.useState([]),[S,o]=r.useState(""),[l,m]=r.useState([]),[h,p]=r.useState(!0),[b,f]=r.useState("efectivo"),[k,y]=r.useState(0),[I,M]=r.useState(0),[E,L]=r.useState(""),[$,F]=r.useState(1);r.useEffect(()=>{(async()=>{try{const d=(await K(W(O,"productos"))).docs.map(V=>({id:V.id,...V.data()}));P(d)}catch(n){o("Error al obtener los productos"),console.error("Error al obtener los productos:",n)}finally{p(!1)}})()},[N]),r.useEffect(()=>{if(E.length>0){const t=g.find(n=>String(n.id)===E);t?(w(t,$),L(""),F(1)):(o("Producto no encontrado."),setTimeout(()=>{o(""),L(""),F(1)},3e3))}},[E,g,$]);const R=t=>{L(t.target.value)},w=(t,n)=>{m(d=>{const V=d.find(U=>U.id===t.id);return V?V.cantidad+n<=t.cantidadProducto?d.map(U=>U.id===t.id?{...U,cantidad:U.cantidad+n}:U):(alert("Stock insuficiente"),d):t.cantidadProducto>=n?[...d,{...t,cantidad:n,precioOriginal:t.precioOriginal}]:(alert("Stock insuficiente"),d)})},z=t=>{m(n=>{var U;const d=n.find(C=>C.id===t),V=(U=g.find(C=>C.id===t))==null?void 0:U.cantidadProducto;return d&&V>d.cantidad?n.map(C=>C.id===t?{...C,cantidad:C.cantidad+1}:C):(alert("Stock insuficiente"),n)})},u=t=>{m(n=>n.map(d=>d.id===t?{...d,cantidad:Math.max(1,d.cantidad-1)}:d))},s=t=>{m(n=>n.filter(d=>d.id!==t))},v=t=>{f(t.target.value),t.target.value==="efectivo"&&(y(0),M(0))},c=t=>{const n=parseFloat(t.target.value);y(n);const d=l.reduce((V,U)=>V+U.precioProducto*U.cantidad,0);M(n-d)},T=async t=>{t.preventDefault();const n=new Date,d=l.reduce((C,B)=>C+B.precioProducto*B.cantidad,0),V=l.map(C=>({idProducto:C.id,nombreProducto:C.nombreProducto,marcaProducto:C.marcaProducto,categoriaProducto:C.categoriaProducto,precioProducto:C.precioProducto??0,precioOriginal:C.precioOriginal??0,cantidad:C.cantidad,cantidadProducto:C.cantidadProducto})),U=_.currentUser;try{await de(W(O,"sales"),{fechaVenta:n,totalVenta:d,totalGanancia:a,tipoPago:b,idUsuario:U.uid,productos:V});const C=ue(O);l.forEach(B=>{const q=J(O,"productos",B.id);C.update(q,{cantidadProducto:B.cantidadProducto-B.cantidad})}),await C.commit(),m([]),alert("Venta registrada con éxito")}catch(C){o("Error al registrar la venta"),console.error("Error al registrar la venta:",C)}},j=t=>t==null?"0":`${t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}`,i=l.reduce((t,n)=>t+n.cantidad,0),x=l.reduce((t,n)=>t+n.precioProducto*n.cantidad,0),a=l.reduce((t,n)=>{const d=n.precioProducto??0,V=n.precioOriginal??0,U=V===0?0:(d-V)*n.cantidad;return t+U},0);return h?e.jsxs("div",{children:[e.jsx(X,{}),e.jsx("h1",{children:"Cargando productos..."})]}):e.jsxs("div",{children:[e.jsx("div",{className:"nav",children:e.jsx(X,{})}),e.jsx("main",{className:"main1",children:e.jsxs("div",{className:"layout",children:[e.jsx("div",{className:"columna-izquierda",children:e.jsxs("div",{className:"carrito-label",children:[e.jsx("p",{className:"form-title",children:"Carrito de compras"}),e.jsxs("div",{className:"encabezado",children:[e.jsx("input",{className:"carrito-input",type:"text",placeholder:"Buscar producto por ID...",value:E,onChange:R,onBlur:()=>{if(E.length>0){const t=g.find(n=>String(n.id)===E);t?(w(t),L("")):o("Producto no encontrado.")}}}),e.jsx("input",{className:"carrito-input",type:"number",placeholder:"Cantidad...",value:$,min:"1",onChange:t=>{const n=parseInt(t.target.value);F(n<1?1:n)}})]}),e.jsx("label",{className:"textp",htmlFor:"tipoPago",children:"Tipo de pago:"}),e.jsxs("select",{id:"tipoPago",value:b,onChange:v,className:"carrito-input",children:[e.jsx("option",{value:"efectivo",children:"Efectivo"}),e.jsx("option",{value:"tarjeta",children:"Tarjeta"})]}),S&&e.jsx("p",{className:"error",children:S}),e.jsxs("div",{className:"pago",children:[e.jsxs("p",{className:"textp",children:["Total productos: ",i]}),e.jsx("br",{}),e.jsxs("p",{className:"textp",children:["Total ganancia: $",j(a)]})," ",e.jsx("br",{}),e.jsxs("p",{className:"textp",children:["Total monto: $",j(x)]}),b==="efectivo"&&e.jsxs("div",{children:[e.jsx("label",{className:"textp",htmlFor:"cantidadEntregada",children:"Cantidad entregada:"}),e.jsx("input",{id:"cantidadEntregada",type:"number",value:k,onChange:c,className:"carrito-input"}),e.jsxs("p",{className:"textp",children:["Vuelto: $",j(I)]})]})]}),e.jsx("button",{className:"boton-venta",onClick:T,children:e.jsx("span",{children:"Finalizar Venta"})})]})}),e.jsx("div",{className:"columna-derecha",children:e.jsx("section",{className:"tabla-ventas",children:e.jsxs("table",{className:"carrito-tabla",children:[e.jsx("thead",{className:"carrito-th",children:e.jsxs("tr",{className:"carrito-tr",children:[e.jsx("th",{className:"carrito-th",children:"Producto"}),e.jsx("th",{className:"carrito-th",children:"Precio"}),e.jsx("th",{className:"carrito-th",children:"Precio Original"})," ",e.jsx("th",{className:"carrito-th",children:"Cantidad"}),e.jsx("th",{className:"carrito-th",children:"Total"}),e.jsx("th",{className:"carrito-th",children:"Acciones"})]})}),e.jsx("tbody",{className:"carrito-items",children:l.map(t=>e.jsxs("tr",{className:"carrito-tr",children:[e.jsx("td",{className:"carrito-td",children:e.jsx("p",{className:"txt-carrito",children:t.nombreProducto})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["$",j(t.precioProducto)]})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["$",j(t.precioOriginal)]})})," ",e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:[e.jsx("button",{className:"boton-resta",onClick:()=>u(t.id),children:e.jsx(H,{icon:he})}),t.cantidad,e.jsx("button",{className:"boton-suma",onClick:()=>z(t.id),children:e.jsx(H,{icon:xe})})]})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["$",j(t.precioProducto*t.cantidad)]})}),e.jsx("td",{className:"carrito-td",children:e.jsx("button",{className:"boton-eliminar",onClick:()=>s(t.id),children:e.jsx(H,{icon:Oe})})})]},t.id))})]})})})]})})]})},na=()=>{const[N,g]=r.useState([]),[P,S]=r.useState(""),[o,l]=r.useState([]),[m,h]=r.useState(!0),[p,b]=r.useState(!1),[f,k]=r.useState(null),[y,I]=r.useState({idProducto:"",nombreProducto:"",precioProducto:"",precioOriginal:"",categoriaProducto:"",marcaProducto:"",cantidadProducto:""});r.useEffect(()=>{(async()=>{try{const v=(await K(W(O,"productos"))).docs.map(c=>({idProducto:c.id,...c.data()}));g(v),l(v)}catch{S("Error al cargar los productos. Intente más tarde.")}finally{h(!1)}})()},[]);const M=u=>{const s=u.target.value.toLowerCase();if(s==="")l(N);else{const v=N.filter(c=>{const T=String(c.idProducto).toLowerCase(),j=String(c.nombreProducto).toLowerCase(),i=String(c.precioProducto).toLowerCase(),x=String(c.categoriaProducto).toLowerCase(),a=String(c.marcaProducto).toLowerCase(),t=String(c.cantidadProducto).toLowerCase();return T.includes(s)||j.includes(s)||i.includes(s)||x.includes(s)||a.includes(s)||t.includes(s)});l(v)}},E=u=>u==null?"0":`${u.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}`,L=u=>{k(u),I({idProducto:u.idProducto,nombreProducto:u.nombreProducto,precioProducto:u.precioProducto,precioOriginal:u.precioOriginal,categoriaProducto:u.categoriaProducto,marcaProducto:u.marcaProducto,cantidadProducto:u.cantidadProducto}),b(!0)},$=u=>{const{name:s,value:v}=u.target;I({...y,[s]:v})},F=()=>{b(!1),k(null)},R=async u=>{u.preventDefault();try{const s=J(O,"productos",y.idProducto);await ke(s,{nombreProducto:y.nombreProducto,precioProducto:Number(y.precioProducto),precioOriginal:Number(y.precioOriginal),categoriaProducto:y.categoriaProducto,marcaProducto:y.marcaProducto,cantidadProducto:Number(y.cantidadProducto)}),g(v=>v.map(c=>c.idProducto===f.idProducto?{...c,...y}:c)),l(v=>v.map(c=>c.idProducto===f.idProducto?{...c,...y}:c)),F()}catch(s){console.error("Error al actualizar el producto:",s)}};o.reduce((u,s)=>u+s.cantidadProducto,0);const w=o.reduce((u,s)=>u+s.precioProducto*s.cantidadProducto,0),z=o.reduce((u,s)=>u+s.precioOriginal*s.cantidadProducto,0);return m?e.jsx("p",{children:"Cargando productos..."}):P?e.jsx("p",{children:P}):e.jsxs("div",{children:[e.jsx("div",{className:"nav",children:e.jsx(X,{})}),e.jsxs("div",{className:"body-tabla",children:[e.jsxs("main",{className:"table",children:[e.jsxs("section",{className:"table-header",children:[e.jsxs("p",{className:"form-title",children:["Total del Inventario: $",E(w)]}),e.jsxs("p",{className:"form-title",children:["Total Original: $",E(z)]}),e.jsxs("div",{className:"container-input",children:[e.jsx("input",{type:"text",placeholder:"Buscar producto",name:"text",className:"input",onChange:M}),e.jsx("svg",{fill:"#000000",width:"20px",height:"20px",viewBox:"0 0 1920 1920",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M790.588 1468.235c-373.722 0-677.647-303.924-677.647-677.647 0-373.722 303.925-677.647 677.647-677.647 373.723 0 677.647 303.925 677.647 677.647 0 373.723-303.924 677.647-677.647 677.647Zm596.781-160.715c120.396-138.692 193.807-319.285 193.807-516.932C1581.176 354.748 1226.428 0 790.588 0S0 354.748 0 790.588s354.748 790.588 790.588 790.588c197.647 0 378.24-73.411 516.932-193.807l516.028 516.142 79.963-79.963-516.142-516.028Z",fillRule:"evenodd"})})]})]}),e.jsx("section",{className:"table-body",children:e.jsxs("table",{className:"tabla-inventario",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Codigo"}),e.jsx("th",{children:"Nombre"}),e.jsx("th",{children:"Precio"}),e.jsx("th",{children:"Precio Original"})," ",e.jsx("th",{children:"Ganancias"})," ",e.jsx("th",{children:"Categoria"}),e.jsx("th",{children:"Marca"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:o.length>0?o.map(u=>e.jsxs("tr",{children:[e.jsx("td",{children:u.idProducto}),e.jsx("td",{children:u.nombreProducto}),e.jsx("td",{children:E(u.precioProducto)}),e.jsx("td",{children:E(u.precioOriginal)})," ",e.jsx("td",{children:E(u.precioProducto-u.precioOriginal)})," ",e.jsx("td",{children:u.categoriaProducto}),e.jsx("td",{children:u.marcaProducto}),e.jsx("td",{children:e.jsx("p",{className:u.cantidadProducto<=5?"cantidad-baja":u.cantidadProducto<=15?"cantidad-media":"cantidad-alta",children:u.cantidadProducto})}),e.jsx("td",{children:e.jsx("button",{className:"btn-editar",onClick:()=>L(u),children:"Editar"})})]},u.idProducto)):e.jsx("tr",{children:e.jsx("td",{colSpan:"9",children:"No hay productos disponibles"})})})]})})]}),e.jsx(ie,{open:p,onClose:F,children:f&&e.jsxs("div",{className:"formulario-editar",children:[e.jsx("p",{className:"form-title",children:"Editar Producto "}),e.jsxs("form",{onSubmit:R,children:[e.jsxs("label",{children:["Nombre:",e.jsx("input",{type:"text",name:"nombreProducto",value:y.nombreProducto,onChange:$})]}),e.jsxs("label",{children:["Precio:",e.jsx("input",{type:"number",name:"precioProducto",value:y.precioProducto,onChange:$})]}),e.jsxs("label",{children:["Precio Original:",e.jsx("input",{type:"number",name:"precioOriginal",value:y.precioOriginal,onChange:$})]}),e.jsxs("label",{children:["Categoria:",e.jsx("input",{type:"text",name:"categoriaProducto",value:y.categoriaProducto,onChange:$})]}),e.jsxs("label",{children:["Marca:",e.jsx("input",{type:"text",name:"marcaProducto",value:y.marcaProducto,onChange:$})]}),e.jsxs("label",{children:["Cantidad:",e.jsx("input",{type:"number",name:"cantidadProducto",value:y.cantidadProducto,onChange:$})]}),e.jsx("button",{type:"submit",children:"Actualizar Producto"}),e.jsx("button",{type:"button",onClick:F,children:"Cancelar"})]})]})})]})]})},ca=()=>{const[N,g]=r.useState([]),[P,S]=r.useState(""),[o,l]=r.useState([]),[m,h]=r.useState(!0);r.useState("efectivo");const[p,b]=r.useState(""),[f,k]=r.useState(1),[y,I]=r.useState(!1),[M,E]=r.useState(!1);r.useEffect(()=>{let s=!0;return(async()=>{try{const c=W(O,"productos"),j=(await K(c)).docs.map(i=>({id:i.id,...i.data()}));s&&g(j)}catch(c){S("Error al obtener los productos"),console.error("Error al obtener los productos:",c)}finally{s&&h(!1)}})(),()=>{s=!1}},[]),r.useEffect(()=>{if(p.length>0){const s=N.find(v=>String(v.idProducto)===p);s?(y?F(s,f):$(s,f),b(""),k(1)):(S("Producto no encontrado."),setTimeout(()=>{S(""),b(""),k(1)},3e3))}},[p,N,f,y]);const L=s=>{b(s.target.value)},$=(s,v)=>{l(c=>c.find(j=>j.idProducto===s.idProducto)?c.map(j=>j.idProducto===s.idProducto?{...j,cantidad:j.cantidad+v}:j):[...c,{...s,cantidad:v}])},F=(s,v)=>{l(c=>c.find(j=>j.idProducto===s.idProducto)?c.map(j=>j.idProducto===s.idProducto?{...j,cantidad:j.cantidad+v}:j):[...c,{...s,cantidad:v}])},R=s=>{l(v=>v.map(c=>c.idProducto===s?{...c,cantidad:c.cantidad+1}:c))},w=s=>{l(v=>v.map(c=>c.idProducto===s?{...c,cantidad:Math.max(1,c.cantidad-1)}:c))},z=async s=>{s.preventDefault(),E(!0);const v=new Date,c=_.currentUser;try{const T=o.reduce((a,t)=>a+t.precioProducto*t.cantidad,0),j=o.map(a=>({idProducto:a.idProducto,nombreProducto:a.nombreProducto,marcaProducto:a.marcaProducto,categoriaProducto:a.categoriaProducto,precioProducto:a.precioProducto,cantidad:a.cantidad})),i=c?c.uid:"";await de(W(O,"sales"),{fechaVenta:v,totalVenta:-T,idUsuario:i,productos:j,tipoPago:"devolución"});const x=ue(O);o.forEach(a=>{const t=J(O,"productos",a.idProducto),n=a.cantidadProducto+a.cantidad;x.update(t,{cantidadProducto:n})}),await x.commit(),l([]),b(""),k(1),E(!1),alert("Operación realizada con éxito")}catch(T){S("Error al registrar la operación"),console.error("Error al registrar la operación:",T),E(!1)}},u=s=>`${s.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}`;return m?e.jsxs("div",{children:[e.jsx(X,{}),e.jsx("h1",{children:"Cargando productos..."})]}):e.jsxs("div",{children:[e.jsx(X,{}),e.jsx("main",{className:"main1",children:e.jsxs("div",{className:"carrito-label-devolucion",children:[e.jsx("p",{className:"form-title",children:"Devolución"}),e.jsx("hr",{}),e.jsxs("div",{className:"encabezado",children:[e.jsx("input",{className:"carrito-input",type:"text",placeholder:"Buscar producto por ID...",value:p,onChange:L,onBlur:()=>{if(p.length>0){const s=N.find(v=>String(v.idProducto)===p);s?(y?F(s,f):$(s,f),b("")):S("Producto no encontrado.")}}}),e.jsx("input",{className:"carrito-input",type:"number",placeholder:"Cantidad...",value:f,min:"1",onChange:s=>{const v=parseInt(s.target.value,10);k(v<1?1:v)}})]}),e.jsxs("table",{className:"carrito-tabla",children:[e.jsx("thead",{className:"carrito-th",children:e.jsxs("tr",{className:"carrito-tr",children:[e.jsx("th",{className:"carrito-th",children:"Producto"}),e.jsx("th",{className:"carrito-th",children:"Precio"}),e.jsx("th",{className:"carrito-th",children:"Cantidad"}),e.jsx("th",{className:"carrito-th",children:"Total"})]})}),e.jsx("tbody",{className:"carrito-items",children:o.map(s=>e.jsxs("tr",{className:"carrito-tr",children:[e.jsx("td",{className:"carrito-td",children:e.jsx("p",{className:"txt-carrito",children:s.nombreProducto})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["-$",u(s.precioProducto)]})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:[e.jsx("button",{className:"boton-resta",onClick:()=>w(s.idProducto),children:e.jsx(H,{icon:he})}),e.jsx("span",{className:"spanCarrito",children:s.cantidad}),e.jsx("button",{className:"boton-suma",onClick:()=>R(s.idProducto),children:e.jsx(H,{icon:xe})})]})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["-$",u(s.precioProducto*s.cantidad)]})})]},s.idProducto))})]}),e.jsx("div",{className:"venta-label",children:e.jsx("div",{className:"totalcarro",children:e.jsxs("p",{className:"textp",children:["Total a Devolver: -$",u(o.reduce((s,v)=>s+v.cantidad*v.precioProducto,0))]})})}),e.jsx("div",{className:"bottom-container",children:e.jsx("button",{className:"boton-venta",onClick:z,disabled:o.length===0,children:e.jsx("span",{children:"Devolución"})})})]})})]})},ia=N=>le(N,"dd/MM/yyyy"),la=()=>{const[N,g]=r.useState([]),[P,S]=r.useState(""),[o,l]=r.useState(!0),[m,h]=r.useState(!1),[p,b]=r.useState(!1),[f,k]=r.useState(null),[y,I]=r.useState(null),[M,E]=r.useState("todos"),[L,$]=r.useState(new Date);r.useEffect(()=>{(async()=>{try{const t=W(O,"sales"),n=W(O,"users"),[d,V]=await Promise.all([K(t),K(n)]),U={};V.forEach(B=>{U[B.id]=B.data().nombreUsuario}),console.log("Users data:",U);const C=d.docs.map(B=>{const q=B.data();return{idVenta:B.id,...q,nombreUsuario:U[q.idUsuario]||"N/A",fechaVenta:q.fechaVenta.toDate()}});C.sort((B,q)=>q.fechaVenta-B.fechaVenta),g(C),l(!1)}catch(t){console.error("Error fetching data:",t),S("Ocurrió un error al cargar el historial de ventas"),l(!1)}})()},[]);const F=a=>{k(a),h(!0)},R=()=>{h(!1),k(null)},w=a=>{I(a),b(!0)},z=()=>{b(!1),I(null)},u=a=>{const{name:t,value:n}=a.target;k(d=>({...d,[t]:n}))},s=a=>{$(a)},v=async()=>{try{const a=J(O,"sales",f.idVenta);await ke(a,{idUsuario:f.idUsuario,tipoPago:f.tipoPago,totalVenta:parseFloat(f.totalVenta)}),g(t=>t.map(n=>n.idVenta===f.idVenta?f:n)),R()}catch(a){console.error("Error updating sale:",a)}},j=((a,t)=>t==="todos"?a:a.filter(n=>n.tipoPago===t))(((a,t)=>t?a.filter(n=>le(n.fechaVenta,"dd/MM/yyyy")===le(t,"dd/MM/yyyy")):a)(N,L),M),i=a=>{switch(a){case"efectivo":return"Efectivo";case"tarjeta":return"Tarjeta";case"devolucion":return"Devolución";default:return a}},x=a=>isNaN(a)?"0":`${a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}`;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"nav",children:e.jsx(X,{})}),e.jsx("div",{className:"body-tabla",children:e.jsxs("main",{className:"table",children:[e.jsxs("section",{className:"table-header",children:[e.jsxs("p",{className:"form-title",children:["Total del día: $",x(j.reduce((a,t)=>a+(parseFloat(t.totalVenta)||0),0))]}),e.jsxs("p",{className:"form-title",children:["Total del día: $",x(j.reduce((a,t)=>a+(parseFloat(t.totalGanancia)||0),0))]}),e.jsx(Ve,{dateAdapter:Ue,children:e.jsx(Te,{className:"fecha",label:"Selecciona una fecha",value:L,onChange:a=>s(a),renderInput:a=>e.jsx(re,{...a,style:{marginBottom:"16px"}})})}),e.jsxs(pe,{className:"seleccionar-pago",children:[e.jsx(ge,{id:"tipoPago-label",children:"Tipo de Pago"}),e.jsxs(fe,{labelId:"tipoPago-label",id:"tipoPago",value:M,onChange:a=>E(a.target.value),children:[e.jsx(Y,{value:"todos",children:"Todos"}),e.jsx(Y,{value:"efectivo",children:"Efectivo"}),e.jsx(Y,{value:"tarjeta",children:"Tarjeta"}),e.jsx(Y,{value:"devolucion",children:"Devolución"})]})]}),e.jsx(Q,{className:"btn-editar",onClick:()=>console.log("Exportar a Excel"),children:"Exportar a Excel"})]}),o?e.jsx("p",{children:"Cargando..."}):P?e.jsx("p",{className:"error-message",children:P}):j.length===0?e.jsx("p",{children:"No hay ventas registradas"}):e.jsx(Ke,{component:Xe,children:e.jsxs(Pe,{children:[e.jsx(ve,{children:e.jsxs(te,{children:[e.jsx(A,{children:"ID Venta"}),e.jsx(A,{children:"Fecha"}),e.jsx(A,{children:"Nombre Usuario"}),e.jsx(A,{children:"Tipo Pago"}),e.jsx(A,{children:"Total Venta"}),e.jsx(A,{children:"Total Ganancia"}),e.jsx(A,{children:"Acciones"})]})}),e.jsx(be,{children:j.map(a=>e.jsxs(te,{children:[e.jsx(A,{children:a.idVenta}),e.jsx(A,{children:ia(a.fechaVenta)}),e.jsx(A,{children:a.nombreUsuario}),e.jsx(A,{children:i(a.tipoPago)}),e.jsxs(A,{children:["$",x(parseFloat(a.totalVenta)||0)]}),e.jsxs(A,{children:["$",x(parseFloat(a.totalGanancia)||0)]}),e.jsxs(A,{children:[e.jsx(Q,{variant:"outlined",onClick:()=>w(a),children:"Detalle"}),e.jsx(Q,{variant:"outlined",onClick:()=>F(a),children:"Editar"})]})]},a.idVenta))})]})})]})}),m&&e.jsxs(ie,{open:m,onClose:R,children:[e.jsx(Ne,{children:"Editar Venta"}),e.jsx(Se,{children:f&&e.jsxs("div",{children:[e.jsxs(pe,{fullWidth:!0,margin:"normal",children:[e.jsx(ge,{id:"tipoPago-label",children:"Tipo de Pago"}),e.jsxs(fe,{labelId:"tipoPago-label",id:"tipoPago",name:"tipoPago",value:f.tipoPago,onChange:u,children:[e.jsx(Y,{value:"efectivo",children:"Efectivo"}),e.jsx(Y,{value:"tarjeta",children:"Tarjeta"}),e.jsx(Y,{value:"devolucion",children:"Devolución"})]})]}),e.jsx(re,{label:"Total Venta",name:"totalVenta",value:f.totalVenta,onChange:u,fullWidth:!0,margin:"normal"})]})}),e.jsxs(Ce,{children:[e.jsx(Q,{onClick:R,children:"Cancelar"}),e.jsx(Q,{onClick:v,color:"primary",children:"Guardar"})]})]}),p&&e.jsxs(ie,{open:p,onClose:z,children:[e.jsx(Ne,{children:"Detalle de Venta"}),e.jsx(Se,{children:y&&e.jsxs(Pe,{children:[e.jsx(ve,{children:e.jsxs(te,{children:[e.jsx(A,{children:"ID Producto"}),e.jsx(A,{children:"Nombre Producto"}),e.jsx(A,{children:"Cantidad"}),e.jsx(A,{children:"Precio"})]})}),e.jsx(be,{children:y.productos.map(a=>e.jsxs(te,{children:[e.jsx(A,{children:a.idProducto}),e.jsx(A,{children:a.nombreProducto}),e.jsx(A,{children:a.cantidad}),e.jsxs(A,{children:["$",x(a.precio)]})]},a.idProducto))})]})}),e.jsx(Ce,{children:e.jsx(Q,{onClick:z,children:"Cerrar"})})]})]})},da=()=>{const[N,g]=r.useState([]),[P,S]=r.useState({}),[o,l]=r.useState({}),[m,h]=r.useState({}),[p,b]=r.useState(0),[f,k]=r.useState(!0),[y,I]=r.useState(null),[M,E]=r.useState(new Date),[L,$]=r.useState("todos"),F=(c,T)=>T==="todos"?c:c.filter(j=>j.tipoPago===T),R=(c,T)=>{if(!T)return c;const j=Ze(new Date(T)),i=_e(new Date(T));return c.filter(x=>x.fecha>=j&&x.fecha<=i)},w=(c,T)=>{const j={},i={},x={};let a=0;c.forEach(t=>{const{tipoPago:n,totalVenta:d,nombreUsuario:V,productos:U}=t;j[n]=(j[n]||0)+1,i[V]=(i[V]||0)+d,U.forEach(C=>{const{idProducto:B,cantidad:q}=C,je=T[B]||B;x[je]=(x[je]||0)+q}),a+=d}),S(j),l(i),h(x),b(a)};r.useEffect(()=>{(async()=>{try{const T=W(O,"sales"),j=W(O,"users"),i=W(O,"products"),[x,a,t]=await Promise.all([K(T),K(j),K(i)]),n={};a.forEach(C=>{n[C.id]=C.data().nombreUsuario});const d={};t.forEach(C=>{d[C.id]=C.data().nombreProducto});const V=x.docs.map(C=>{const B=C.data();let q;return B.fecha&&B.fecha.toDate?q=B.fecha.toDate():B.fecha&&B.fecha.toDate===void 0?q=new Date(B.fecha):q=new Date,{idVenta:C.id,...B,nombreUsuario:n[B.idUsuario]||"N/A",fecha:q}}),U=F(R(V,M),L);w(U,d),g(U),k(!1)}catch(T){console.error("Error fetching data:",T),I("Ocurrió un error al cargar el historial de ventas"),k(!1)}})()},[M,L]);const z={labels:Object.keys(P),datasets:[{label:"Ventas por Tipo de Pago",data:Object.values(P),backgroundColor:["rgba(75, 192, 192, 0.6)","rgba(153, 102, 255, 0.6)","rgba(255, 159, 64, 0.6)"]}]},u={labels:Object.keys(o),datasets:[{label:"Ventas por Usuario",data:Object.values(o),backgroundColor:["rgba(255, 99, 132, 0.6)","rgba(54, 162, 235, 0.6)","rgba(255, 206, 86, 0.6)","rgba(75, 192, 192, 0.6)","rgba(153, 102, 255, 0.6)","rgba(255, 159, 64, 0.6)"]}]},s={labels:Object.keys(m),datasets:[{label:"Ventas por Producto",data:Object.values(m),backgroundColor:["rgba(54, 162, 235, 0.6)","rgba(255, 99, 132, 0.6)","rgba(75, 192, 192, 0.6)","rgba(255, 206, 86, 0.6)","rgba(153, 102, 255, 0.6)","rgba(255, 159, 64, 0.6)"]}]},v=c=>new Intl.NumberFormat("es-ES").format(c);return f?e.jsx("p",{children:"Loading..."}):y?e.jsxs("p",{children:["Error: ",y]}):e.jsxs("div",{children:[e.jsx("div",{className:"nav",children:e.jsx(X,{})}),e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"date-filter",children:[e.jsx("h3",{children:"Filtrar por Fecha"}),e.jsx(Ve,{dateAdapter:Ue,children:e.jsx(Te,{value:M,onChange:c=>E(c),renderInput:c=>e.jsx(re,{...c,style:{marginBottom:"16px"}})})})]}),e.jsx("div",{className:"metrics",children:e.jsxs("h2",{children:["Total Ventas: $",v(p.toFixed(0))]})}),e.jsxs("div",{className:"charts-container",children:[e.jsxs("div",{className:"pie-chart",children:[e.jsx("h3",{children:"Ventas por Tipo de Pago"}),e.jsx(Ye,{data:z})]}),e.jsxs("div",{className:"bar-charts",children:[e.jsxs("div",{className:"chart",children:[e.jsx("h3",{children:"Ventas por Usuario"}),e.jsx(ye,{data:u})]}),e.jsxs("div",{className:"chart",children:[e.jsx("h3",{children:"Ventas por Producto"}),e.jsx(ye,{data:s})]})]})]})]})]})},ua=()=>{const N=se(),[g,P]=ee.useState(!1),{signOut:S}=me(),o=async()=>{try{await S(),N("/")}catch(h){console.error("Error al cerrar sesión:",h)}},l=()=>{P(!g)},m=()=>{P(!1)};return ee.useEffect(()=>{const h=()=>{window.innerWidth>=800&&m()};return window.addEventListener("resize",h),()=>{window.removeEventListener("resize",h)}},[]),e.jsxs("nav",{className:"navbar",children:[e.jsxs("ul",{className:`sidebar ${g?"visible":""}`,children:[e.jsx("li",{onClick:m,children:e.jsx(D,{className:"menu",to:"#",children:e.jsx(H,{icon:Be})})}),e.jsx("li",{children:e.jsx(D,{className:"link",to:"/vendedor/ventas",children:"Venta"})}),e.jsx("li",{children:e.jsx(D,{className:"link",to:"/vendedor/inventario",children:"Inventario"})}),e.jsx("li",{children:e.jsx(D,{className:"link",to:"/vendedor/devolucion",children:"Devolución"})}),e.jsx("li",{children:e.jsx(D,{className:"link",onClick:o,children:"Cerrar Sesion"})})]}),e.jsxs("ul",{children:[e.jsx("li",{className:"Mobile",children:e.jsx(D,{className:"link",to:"/vendedor/inventario",children:"Inventario"})}),e.jsx("li",{className:"Mobile",children:e.jsx(D,{className:"link",to:"/vendedor/ventas",children:"Venta"})}),e.jsx("li",{className:"Mobile",children:e.jsx(D,{className:"link",to:"/vendedor/devolucion",children:"Devolución"})}),e.jsx("li",{className:"Mobile",children:e.jsx(D,{className:"link",onClick:o,children:"Cerrar Sesion"})}),e.jsx("li",{onClick:l,children:e.jsx(D,{className:"menu",to:"#",children:e.jsx(H,{icon:Ie})})})]})]})},ha=()=>{const{currentUser:N}=r.useContext(oe),[g,P]=r.useState([]),[S,o]=r.useState(""),[l,m]=r.useState([]),[h,p]=r.useState(!0),[b,f]=r.useState("efectivo"),[k,y]=r.useState(0),[I,M]=r.useState(0),[E,L]=r.useState(""),[$,F]=r.useState(1);r.useEffect(()=>{(async()=>{try{const a=(await K(W(O,"productos"))).docs.map(t=>({id:t.id,...t.data()}));P(a)}catch(x){o("Error al obtener los productos"),console.error("Error al obtener los productos:",x)}finally{p(!1)}})()},[N]),r.useEffect(()=>{if(E.length>0){const i=g.find(x=>String(x.id)===E);i?(w(i,$),L(""),F(1)):(o("Producto no encontrado."),setTimeout(()=>{o(""),L(""),F(1)},3e3))}},[E,g,$]);const R=i=>{L(i.target.value)},w=(i,x)=>{m(a=>{const t=a.find(n=>n.id===i.id);return t?t.cantidad+x<=i.cantidadProducto?a.map(n=>n.id===i.id?{...n,cantidad:n.cantidad+x}:n):(alert("Stock insuficiente"),a):i.cantidadProducto>=x?[...a,{...i,cantidad:x}]:(alert("Stock insuficiente"),a)})},z=i=>{m(x=>{var n;const a=x.find(d=>d.id===i),t=(n=g.find(d=>d.id===i))==null?void 0:n.cantidadProducto;return a&&t>a.cantidad?x.map(d=>d.id===i?{...d,cantidad:d.cantidad+1}:d):(alert("Stock insuficiente"),x)})},u=i=>{m(x=>x.map(a=>a.id===i?{...a,cantidad:Math.max(1,a.cantidad-1)}:a))},s=i=>{m(x=>x.filter(a=>a.id!==i))},v=i=>{f(i.target.value),i.target.value==="efectivo"&&(y(0),M(0))},c=i=>{const x=parseFloat(i.target.value);y(x);const a=l.reduce((t,n)=>t+n.precioProducto*n.cantidad,0);M(x-a)},T=async i=>{i.preventDefault();const x=new Date,a=l.reduce((d,V)=>d+V.precioProducto*V.cantidad,0),t=l.map(d=>({idProducto:d.id,nombreProducto:d.nombreProducto,marcaProducto:d.marcaProducto,categoriaProducto:d.categoriaProducto,precioProducto:d.precioProducto,cantidad:d.cantidad,cantidadProducto:d.cantidadProducto})),n=_.currentUser;try{await de(W(O,"sales"),{fechaVenta:x,totalVenta:a,tipoPago:b,idUsuario:n.uid,productos:t});const d=ue(O);l.forEach(V=>{const U=J(O,"productos",V.id);d.update(U,{cantidadProducto:V.cantidadProducto-V.cantidad})}),await d.commit(),m([]),alert("Venta registrada con éxito")}catch(d){o("Error al registrar la venta"),console.error("Error al registrar la venta:",d)}},j=i=>`${i.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}`;return h?e.jsx("div",{children:e.jsx("h1",{children:"Cargando productos..."})}):e.jsxs("div",{children:[e.jsx("div",{className:"nav",children:e.jsx(ua,{})}),e.jsx("main",{className:"main1",children:e.jsxs("div",{className:"carrito-label",children:[e.jsx("p",{className:"form-title",children:"Carrito de compras"}),e.jsx("hr",{}),e.jsxs("div",{className:"encabezado",children:[e.jsx("input",{className:"carrito-input",type:"text",placeholder:"Buscar producto por ID...",value:E,onChange:R,onBlur:()=>{if(E.length>0){const i=g.find(x=>String(x.id)===E);i?(w(i),L("")):o("Producto no encontrado.")}}}),e.jsx("input",{className:"carrito-input",type:"number",placeholder:"Cantidad...",value:$,min:"1",onChange:i=>{const x=parseInt(i.target.value);F(x<1?1:x)}})]}),S&&e.jsx("p",{className:"error",children:S}),e.jsx("section",{className:"tabla-ventas",children:e.jsxs("table",{className:"carrito-tabla",children:[e.jsx("thead",{className:"carrito-th",children:e.jsxs("tr",{className:"carrito-tr",children:[e.jsx("th",{className:"carrito-th",children:"Producto"}),e.jsx("th",{className:"carrito-th",children:"Precio"}),e.jsx("th",{className:"carrito-th",children:"Cantidad"}),e.jsx("th",{className:"carrito-th",children:"Total"}),e.jsx("th",{className:"carrito-th",children:"Acciones"})]})}),e.jsx("tbody",{className:"carrito-items",children:l.map(i=>e.jsxs("tr",{className:"carrito-tr",children:[e.jsx("td",{className:"carrito-td",children:e.jsx("p",{className:"txt-carrito",children:i.nombreProducto})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["$",j(i.precioProducto)]})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:[e.jsx("button",{className:"boton-resta",onClick:()=>u(i.idProducto),children:e.jsx(H,{icon:he})}),i.cantidad,e.jsx("button",{className:"boton-suma",onClick:()=>z(i.idProducto),children:e.jsx(H,{icon:xe})})]})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["$",j(i.precioProducto*i.cantidad)]})}),e.jsx("td",{className:"carrito-td",children:e.jsx("button",{className:"boton-eliminar",onClick:()=>s(i.idProducto),children:e.jsx(H,{icon:Oe})})})]},i.idProducto))})]})}),e.jsxs("div",{className:"pago",children:[e.jsx("label",{htmlFor:"tipoPago",children:"Tipo de pago:"}),e.jsxs("select",{id:"tipoPago",value:b,onChange:v,className:"carrito-input",children:[e.jsx("option",{value:"efectivo",children:"Efectivo"}),e.jsx("option",{value:"tarjeta",children:"Tarjeta"})]}),b==="efectivo"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"cantidadEntregada",children:"Cantidad entregada:"}),e.jsx("input",{id:"cantidadEntregada",type:"number",value:k,onChange:c,className:"carrito-input"}),e.jsxs("p",{className:"textp",children:["Vuelto: $",j(I)]})]})]}),e.jsx("button",{className:"boton-venta",onClick:T,children:e.jsx("span",{children:"Finalizar Venta"})})]})})]})};function Z({children:N,allowedRoles:g}){const{user:P,role:S}=me();return P?g&&!g.includes(S)?e.jsx(ce,{to:"/unauthorized"}):N:e.jsx(ce,{to:"/login"})}function xa(){return e.jsxs(Je,{children:[e.jsx(G,{path:"/",element:e.jsx(ce,{to:"/login"})}),e.jsx(G,{path:"/login",element:e.jsx(aa,{})}),e.jsx(G,{path:"/resetPassword",element:e.jsx(ta,{})}),e.jsx(G,{path:"/agregarUsuario",element:e.jsx(Z,{allowedRoles:["admin"],children:e.jsx(ra,{})})}),e.jsx(G,{path:"/agregarProducto",element:e.jsx(Z,{allowedRoles:["admin"],children:e.jsx(sa,{})})}),e.jsx(G,{path:"/dashboard",element:e.jsx(Z,{allowedRoles:["admin"],children:e.jsx(da,{})})}),e.jsx(G,{path:"/ventas",element:e.jsx(Z,{allowedRoles:["admin","vendedor"],children:e.jsx(oa,{})})}),e.jsx(G,{path:"/inventario",element:e.jsx(Z,{allowedRoles:["admin"],children:e.jsx(na,{})})}),e.jsx(G,{path:"/devolucion",element:e.jsx(Z,{allowedRoles:["admin","vendedor"],children:e.jsx(ca,{})})}),e.jsx(G,{path:"/historial",element:e.jsx(Z,{allowedRoles:["admin"],children:e.jsx(la,{})})}),e.jsx(G,{path:"/vendedor/ventas",element:e.jsx(Z,{allowedRoles:["vendedor"],children:e.jsx(ha,{})})}),e.jsx(G,{path:"/unauthorized",element:e.jsx("div",{children:"Unauthorized - You do not have permission to view this page."})})]})}Me.createRoot(document.getElementById("root")).render(e.jsx(ee.StrictMode,{children:e.jsx(We,{children:e.jsx(ea,{children:e.jsx(xa,{})})})}));
