import{r as a,j as e,a as oe}from"./react-MB1aJdB0.js";import{c as Ke}from"./react-dom-babtui9j.js";import{g as Fe,s as Je,a as Re,b as Xe,c as Be}from"./firebase-CbIxvbWN.js";import{u as Ye,v as Ze,w as _e,x as Qe,y as ea,z as J,A as ge,B as be,D as _,G as H,H as Ne,I as Se,J as Ae,K as $e,M as Ve,N as ke}from"./@firebase-DkZVFgnq.js";import{L as M,B as aa}from"./react-router-dom-BP5qz8hL.js";import{a as ne,b as ta,d as sa,e as W,f as Pe}from"./react-router-BDFDsiw1.js";import{F as K,f as Le,a as qe,b as Ce,c as ye,d as Ee,e as ra}from"./@fortawesome-Bn1EZEDH.js";import{D as ce,L as ze,A as Ge,a as We,T as fe,F as Ue,I as Te,S as Oe,M as ae,B as Y,b as oa,P as na,c as ue,d as he,e as te,f as B,g as me,h as xe,i as je,j as pe}from"./@mui-D6ajMDpQ.js";import{f as ve,t as ia,m as ca}from"./date-fns-5tFtsWfW.js";import{P as da,B as Ie}from"./react-chartjs-2-BMTf87bo.js";import"./chart.js-C_W9Dm9B.js";import"./@babel-DdaQcUjw.js";import"./scheduler-CzFDRTuY.js";import"./tslib-BGVaTf34.js";import"./safevalues-NrgD-8pg.js";import"./idb-Bn1DMRyg.js";import"./@remix-run-BFLWy9pZ.js";import"./prop-types-D-iIXjl8.js";import"./react-is-DcfIKM1A.js";import"./clsx-B-dksMZM.js";import"./@emotion-D2LlJvDI.js";import"./hoist-non-react-statics-DQogQWOa.js";import"./stylis-FDnFs_-n.js";import"./react-transition-group-DD9RWrmj.js";import"./dom-helpers-D0mFdbeO.js";import"./@popperjs-BQBsAJpH.js";import"./@kurkle-BZxJdD1U.js";(function(){const v=document.createElement("link").relList;if(v&&v.supports&&v.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))E(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const p of c.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&E(p)}).observe(document,{childList:!0,subtree:!0});function g(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function E(n){if(n.ep)return;n.ep=!0;const c=g(n);fetch(n.href,c)}})();const la={apiKey:"AIzaSyAP7Af1h_-zBmBfL_A5K2uuJsJDFuOel0c",authDomain:"local-js-d7712.firebaseapp.com",databaseURL:"https://local-js-d7712-default-rtdb.firebaseio.com",projectId:"local-js-d7712",storageBucket:"local-js-d7712.appspot.com",messagingSenderId:"200538761653",appId:"1:200538761653:web:571a969ac8a572328451fc",measurementId:"G-XXD5WT5TV1"},ie=Ye(la),Q=Fe(ie),A=Ze(ie);_e(ie);Qe(ie);ea(ie);const de=a.createContext();function ua({children:y}){const[v,g]=a.useState(null),[E,n]=a.useState(null);a.useEffect(()=>{const m=Q.onAuthStateChanged(async b=>{if(b){g(b);const C=J(A,"users",b.uid),S=await ge(C);S.exists()?n(S.data().rolUsuario):n(null)}else g(null),n(null)});return()=>m()},[]);const c=async(m,b)=>{try{const C=await Je(Q,m,b);g(C.user);const S=J(A,"users",C.user.uid),O=await ge(S);O.exists()?n(O.data().rolUsuario):n(null)}catch(C){throw console.error("Error signing in:",C),C}},p=async()=>{try{await Re(Q),g(null),n(null)}catch(m){throw console.error("Error signing out:",m),m}};return e.jsx(de.Provider,{value:{user:v,role:E,signIn:c,signOut:p},children:y})}function De(){return a.useContext(de)}function ha(){const[y,v]=a.useState(""),[g,E]=a.useState(""),[n,c]=a.useState(""),p=ne(),{signIn:m,role:b}=De(),C=async S=>{S.preventDefault(),c("");try{await m(y,g)}catch(O){c("Usuario o contraseña incorrectos"),console.error("Error al iniciar sesión:",O)}};return a.useEffect(()=>{b&&(b==="admin"?p("/ventas"):b==="vendedor"?p("/vendedor/ventas"):c("Rol de usuario no reconocido"))},[b,p]),e.jsx("div",{children:e.jsx("div",{className:"login-box",children:e.jsxs("form",{className:"form",onSubmit:C,children:[e.jsxs("p",{className:"form-title",children:["Los Tios ",e.jsx("br",{}),"Iniciar Sesión"]}),e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"email",placeholder:"Email",value:y,onChange:S=>v(S.target.value),required:!0})}),e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"password",placeholder:"Contraseña",value:g,onChange:S=>E(S.target.value),required:!0})}),n&&e.jsx("p",{className:"signup-link",children:n}),e.jsx("button",{type:"submit",className:"submit",children:"Ingresar"}),e.jsx("p",{className:"signup-link",children:e.jsx(M,{to:"/resetPassword",className:"resetPassword",children:"Olvidé mi Contraseña"})})]})})})}const ma=()=>{const[y,v]=a.useState(""),[g,E]=a.useState(!1),[n,c]=a.useState(null),p=ne(),m=()=>{Xe(Q,y).then(()=>{E(!0),setTimeout(()=>{p("/")},6e3)}).catch(b=>{c("No se pudo enviar el correo electrónico de restablecimiento de contraseña.")})};return e.jsxs("div",{className:"login-box",children:[e.jsxs("p",{className:"form-title",children:["Recuperar",e.jsx("br",{}),"Contraseña"]}),g?e.jsx("p",{children:"Se ha enviado un correo electrónico con instrucciones para restablecer tu contraseña."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"email",placeholder:"Correo Electrónico",value:y,onChange:b=>v(b.target.value),required:!0})}),e.jsx("button",{onClick:m,variant:"outlined",className:"submit",children:"Enviar"})]}),e.jsx("p",{className:"signup-link",children:e.jsx(M,{to:"/login",className:"resetPassword",children:"Iniciar Sesion"})})]})},xa=()=>{const[y,v]=a.useState(""),[g,E]=a.useState(""),[n,c]=a.useState(""),[p,m]=a.useState("vendedor"),[b,C]=a.useState(""),[S,O]=a.useState(""),D=ne(),F=async i=>{i.preventDefault();try{if(n.length<6){C("La contraseña debe tener al menos 6 caracteres.");return}const V=(await Be(Q,g,n)).user;await be(J(A,"users",V.uid),{nombreUsuario:y,emailUsuario:g,rolUsuario:p}),O("Usuario registrado exitosamente"),v(""),E(""),c(""),m("vendedor"),D("/dashboard")}catch(N){console.error("Error al registrar el usuario:",N),N.code==="auth/email-already-in-use"?C("El correo electrónico ya está en uso. Por favor, use otro."):N.code==="permission-denied"?C("Permiso denegado. Verifica las reglas de seguridad."):C("Error al registrar el usuario")}};return e.jsx("div",{children:e.jsxs("div",{className:"login-box",children:[e.jsx("p",{className:"form-title",children:"Registrar Usuario"}),e.jsxs("form",{className:"form",onSubmit:F,children:[e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"text",placeholder:"Nombre de Usuario",value:y,onChange:i=>v(i.target.value),required:!0})}),e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"email",placeholder:"Email",value:g,onChange:i=>E(i.target.value),required:!0})}),e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"password",placeholder:"Contraseña",value:n,onChange:i=>c(i.target.value),required:!0})}),e.jsx("div",{className:"input-container",children:e.jsxs("select",{value:p,onChange:i=>m(i.target.value),required:!0,children:[e.jsx("option",{value:"vendedor",children:"Vendedor"}),e.jsx("option",{value:"admin",children:"Administrador"})]})}),b&&e.jsx("p",{className:"error-message",children:b}),S&&e.jsx("p",{className:"success-message",children:S}),e.jsx("button",{className:"submit",type:"submit",children:"Registrar Usuario"})]})]})})},X=()=>{const y=ne(),v=ta(),[g,E]=oe.useState(!1),n=async()=>{const b=Fe();try{await Re(b),localStorage.removeItem("token"),y("/")}catch(C){console.error("Error al cerrar sesión:",C)}},c=()=>{E(!g)},p=()=>{E(!1)};oe.useEffect(()=>{const b=()=>{window.innerWidth>=800&&p()};return window.addEventListener("resize",b),()=>{window.removeEventListener("resize",b)}},[]);const m=b=>v.pathname===b?"active":"";return e.jsxs("nav",{className:"navbar",children:[e.jsxs("ul",{className:`sidebar ${g?"visible":""}`,children:[e.jsx("li",{onClick:p,children:e.jsx(M,{className:"menu",to:"#",children:e.jsx(K,{icon:Le})})}),e.jsx("li",{children:e.jsx(M,{className:`link ${m("/ventas")}`,to:"/ventas",children:"Venta"})}),e.jsx("li",{children:e.jsx(M,{className:`link ${m("/agregarProducto")}`,to:"/agregarProducto",children:"Agregar Producto"})}),e.jsx("li",{children:e.jsx(M,{className:`link ${m("/agregarUsuario")}`,to:"/agregarUsuario",children:"Agregar Usuario"})}),e.jsx("li",{children:e.jsx(M,{className:`link ${m("/inventario")}`,to:"/inventario",children:"Inventario"})}),e.jsx("li",{children:e.jsx(M,{className:`link ${m("/devolucion")}`,to:"/devolucion",children:"Devolución"})}),e.jsx("li",{children:e.jsx(M,{className:`link ${m("/dashboard")}`,to:"/dashboard",children:"Dashboard"})}),e.jsx("li",{children:e.jsx(M,{className:`link ${m("/tenserFlow")}`,to:"/tenserFlow",children:"TenserFlow AI"})}),e.jsx("li",{children:e.jsx(M,{className:`link ${m("/historial")}`,to:"/historial",children:"Historial"})}),e.jsx("li",{children:e.jsx(M,{className:"link",onClick:n,children:"Cerrar Sesión"})})]}),e.jsxs("ul",{children:[e.jsx("li",{className:"Mobile",children:e.jsx(M,{className:`link ${m("/dashboard")}`,to:"/dashboard",children:"Dashboard"})}),e.jsx("li",{className:"Mobile",children:e.jsx(M,{className:`link ${m("/tenserFlow")}`,to:"/tenserFlow",children:"TenserFlow AI"})}),e.jsx("li",{className:"Mobile",children:e.jsx(M,{className:`link ${m("/agregarProducto")}`,to:"/agregarProducto",children:"Agregar Producto"})}),e.jsx("li",{className:"Mobile",children:e.jsx(M,{className:`link ${m("/agregarUsuario")}`,to:"/agregarUsuario",children:"Agregar Usuario"})}),e.jsx("li",{className:"Mobile",children:e.jsx(M,{className:`link ${m("/devolucion")}`,to:"/devolucion",children:"Devolución"})}),e.jsx("li",{className:"Mobile",children:e.jsx(M,{className:`link ${m("/ventas")}`,to:"/ventas",children:"Venta"})}),e.jsx("li",{className:"Mobile",children:e.jsx(M,{className:`link ${m("/inventario")}`,to:"/inventario",children:"Inventario"})}),e.jsx("li",{className:"Mobile",children:e.jsx(M,{className:`link ${m("/historial")}`,to:"/historial",children:"Historial"})}),e.jsx("li",{className:"Mobile",children:e.jsx(M,{className:"link",onClick:n,children:"Cerrar Sesión"})}),e.jsx("li",{onClick:c,children:e.jsx(M,{className:"menu",to:"#",children:e.jsx(K,{icon:qe})})})]})]})},ja=()=>{const[y,v]=a.useState(""),[g,E]=a.useState(""),[n,c]=a.useState(""),[p,m]=a.useState("vendedor"),[b,C]=a.useState(""),[S,O]=a.useState(""),D=async F=>{F.preventDefault(),console.log("Nombre de Usuario:",y),console.log("Email:",g),console.log("Contraseña:",n),console.log("Rol:",p);try{const N=(await Be(Q,g,n)).user;console.log("Usuario creado:",N),await be(J(A,"users",N.uid),{nombreUsuario:y,emailUsuario:g,rolUsuario:p}),O("Usuario registrado exitosamente"),v(""),E(""),c(""),m("vendedor")}catch(i){console.error("Error al registrar el usuario:",i),i.code==="auth/email-already-in-use"?C("El correo electrónico ya está en uso. Por favor, use otro."):i.code==="permission-denied"?C("Permiso denegado. Verifica las reglas de seguridad."):C("Error al registrar el usuario")}};return e.jsxs("div",{children:[e.jsx("div",{className:"nav",children:e.jsx(X,{})}),e.jsxs("div",{className:"login-box",children:[e.jsx("p",{className:"form-title",children:"Registrar Usuario"}),e.jsxs("form",{className:"form",onSubmit:D,children:[e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"text",placeholder:"Nombre de Usuario",value:y,onChange:F=>v(F.target.value),required:!0})}),e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"email",placeholder:"Email",value:g,onChange:F=>E(F.target.value),required:!0})}),e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"password",placeholder:"Contraseña",value:n,onChange:F=>c(F.target.value),required:!0})}),e.jsx("div",{className:"input-container",children:e.jsxs("select",{value:p,onChange:F=>m(F.target.value),required:!0,children:[e.jsx("option",{value:"vendedor",children:"Vendedor"}),e.jsx("option",{value:"admin",children:"Administrador"})]})}),b&&e.jsx("p",{className:"signup-link",children:b}),S&&e.jsx("p",{className:"signup-link",children:S}),e.jsx("button",{className:"submit",type:"submit",children:"Registrar Usuario"})]})]})]})},pa=()=>{const[y,v]=a.useState(""),[g,E]=a.useState(""),[n,c]=a.useState(""),[p,m]=a.useState(""),[b,C]=a.useState(""),[S,O]=a.useState(""),[D,F]=a.useState(""),[i,N]=a.useState(""),[V,$]=a.useState(""),w=async()=>{try{const R=J(A,"productos",y);return(await ge(R)).exists()}catch(R){return console.error("Error checking product existence:",R),N("Error al verificar la existencia del producto"),!1}},L=async R=>{if(R.preventDefault(),isNaN(n)||isNaN(p)||isNaN(D)){N("Todos los campos de precio y cantidad deben ser números válidos.");return}const G=Number(n),t=Number(p),d=Number(D);if(G<=0||t<0||d<=0){N("Precio Producto y Cantidad Producto deben ser números positivos. Precio Original puede ser 0 o positivo.");return}if(await w()){N("El producto ya está registrado");return}try{const x=J(A,"productos",y);await be(x,{idProducto:y,nombreProducto:g,precioProducto:G,precioOriginal:t,categoriaProducto:b,marcaProducto:S,cantidadProducto:d}),$("Producto registrado exitosamente"),v(""),E(""),c(""),m(""),C(""),O(""),F(""),N("")}catch(x){N("Hubo un error al registrar el producto"),console.error("Error al registrar el producto:",x)}},z=R=>G=>{const t=G.target.value;/^\d*$/.test(t)&&R(t)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"nav",children:e.jsx(X,{})}),e.jsx("div",{children:e.jsxs("div",{className:"productos-box",children:[e.jsx("p",{className:"form-title",children:"Ingresar Producto"}),e.jsxs("form",{className:"form-producto",onSubmit:L,children:[e.jsxs("div",{className:"detalle",children:[e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Código Producto"}),e.jsx("input",{type:"text",placeholder:"Id Producto",value:y,onChange:R=>v(R.target.value),required:!0})]}),e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Nombre producto"}),e.jsx("input",{type:"text",placeholder:"Nombre Producto",value:g,onChange:R=>E(R.target.value),required:!0})]}),e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Precio Producto"}),e.jsx("input",{type:"number",placeholder:"Precio Producto",value:n,onChange:z(c),min:"0",step:"1",required:!0})]}),e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Precio Original"}),e.jsx("input",{type:"number",placeholder:"Precio Original",value:p,onChange:z(m),min:"0",step:"1"})]}),e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Categoria Producto"}),e.jsx("input",{type:"text",placeholder:"Categoria Producto",value:b,onChange:R=>C(R.target.value)})]}),e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Marca Producto"}),e.jsx("input",{type:"text",placeholder:"Marca Producto",value:S,onChange:R=>O(R.target.value)})]}),e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Cantidad Producto"}),e.jsx("input",{type:"number",placeholder:"Cantidad Producto",value:D,onChange:z(F),min:"1",step:"1",required:!0})]})]}),i&&e.jsx("p",{className:"form-title",children:i}),V&&e.jsx("p",{className:"form-title",children:V}),e.jsx("button",{className:"submit",type:"submit",children:"Agregar Producto"})]})]})})]})},ga=()=>{const{currentUser:y}=a.useContext(de),[v,g]=a.useState([]),[E,n]=a.useState(""),[c,p]=a.useState([]),[m,b]=a.useState(!0),[C,S]=a.useState("efectivo"),[O,D]=a.useState(0),[F,i]=a.useState(0),[N,V]=a.useState(""),[$,w]=a.useState(1),[L,z]=a.useState(!1);a.useEffect(()=>{(async()=>{try{const U=(await _(H(A,"productos"))).docs.map(T=>({id:T.id,...T.data()}));g(U)}catch(j){n("Error al obtener los productos"),console.error("Error al obtener los productos:",j)}finally{b(!1)}})()},[y]),a.useEffect(()=>{if(N.length>0){const r=v.find(j=>String(j.id)===N);r?(G(r,$),V(""),w(1)):(n("Producto no encontrado."),setTimeout(()=>{n(""),V(""),w(1)},3e3))}},[N,v,$]);const R=r=>{V(r.target.value)},G=(r,j)=>{p(U=>{const T=U.find(o=>o.id===r.id);return T?T.cantidad+j<=r.cantidadProducto?U.map(o=>o.id===r.id?{...o,cantidad:o.cantidad+j}:o):(alert("Stock insuficiente"),U):r.cantidadProducto>=j?[...U,{...r,cantidad:j,precioOriginal:r.precioOriginal,stockDisponible:r.cantidadProducto}]:(alert("Stock insuficiente"),U)})},t=r=>{p(j=>{var o;const U=j.find(f=>f.id===r),T=(o=v.find(f=>f.id===r))==null?void 0:o.cantidadProducto;return U&&T>U.cantidad?j.map(f=>f.id===r?{...f,cantidad:f.cantidad+1}:f):U&&T===0?(alert("El stock del producto es 0"),j):(alert("Stock insuficiente"),j)})},d=r=>{p(j=>j.map(U=>U.id===r?{...U,cantidad:Math.max(1,U.cantidad-1)}:U))},l=r=>{p(j=>j.filter(U=>U.id!==r))},x=r=>{S(r.target.value),r.target.value==="efectivo"&&(D(0),i(0))},u=r=>{const j=parseFloat(r.target.value);D(j);const U=c.reduce((T,o)=>T+o.precioProducto*o.cantidad,0);i(j-U)},s=async r=>{if(r.preventDefault(),c.length===0){alert("No se puede registrar una venta con un carrito vacío.");return}z(!0);const j=new Date,U=c.reduce((f,q)=>f+q.precioProducto*q.cantidad,0),T=c.map(f=>({idProducto:f.id,nombreProducto:f.nombreProducto,marcaProducto:f.marcaProducto,categoriaProducto:f.categoriaProducto,precioProducto:f.precioProducto??0,precioOriginal:f.precioOriginal??0,cantidad:f.cantidad,cantidadProducto:f.cantidadProducto})),o=Q.currentUser;try{await Ne(H(A,"sales"),{fechaVenta:j,totalVenta:U,totalGanancia:k,tipoPago:C,idUsuario:o.uid,productos:T});const f=Se(A);c.forEach(q=>{const se=J(A,"productos",q.id);f.update(se,{cantidadProducto:q.cantidadProducto-q.cantidad})}),await f.commit(),p([]),alert("Venta registrada con éxito")}catch(f){n("Error al registrar la venta"),console.error("Error al registrar la venta:",f)}finally{z(!1)}},h=r=>r==null?"0":`${r.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}`,P=c.reduce((r,j)=>r+j.cantidad,0),I=c.reduce((r,j)=>r+j.precioProducto*j.cantidad,0),k=c.reduce((r,j)=>{const U=j.precioProducto??0,T=j.precioOriginal??0,o=T===0?0:(U-T)*j.cantidad;return r+o},0);return m?e.jsxs("div",{children:[e.jsx(X,{}),e.jsx("h1",{children:"Cargando productos..."})]}):e.jsxs("div",{children:[e.jsx("div",{className:"nav",children:e.jsx(X,{})}),e.jsx("main",{className:"main1",children:e.jsxs("div",{className:"layout",children:[e.jsx("div",{className:"columna-izquierda",children:e.jsxs("div",{className:"carrito-label",children:[e.jsx("p",{className:"form-title",children:"Carrito de compras"}),e.jsxs("div",{className:"encabezado",children:[e.jsx("input",{className:"carrito-input",type:"text",placeholder:"Buscar producto por ID...",value:N,onChange:R,onBlur:()=>{if(N.length>0){const r=v.find(j=>String(j.id)===N);r?(G(r),V("")):n("Producto no encontrado.")}}}),e.jsx("input",{className:"carrito-input",type:"number",placeholder:"Cantidad...",value:$,min:"1",onChange:r=>{const j=parseInt(r.target.value);w(j<1?1:j)}})]}),e.jsx("label",{className:"textp",htmlFor:"tipoPago",children:"Tipo de pago:"}),e.jsxs("select",{id:"tipoPago",value:C,onChange:x,className:"carrito-input",children:[e.jsx("option",{value:"efectivo",children:"Efectivo"}),e.jsx("option",{value:"tarjeta",children:"Tarjeta"})]}),E&&e.jsx("p",{className:"error",children:E}),e.jsxs("div",{className:"pago",children:[e.jsxs("p",{className:"textp",children:["Total productos: ",P]}),e.jsx("br",{}),e.jsxs("p",{className:"textp",children:["Total ganancia: $",h(k)]})," ",e.jsx("br",{}),e.jsxs("p",{className:"textp",children:["Total monto: $",h(I)]}),C==="efectivo"&&e.jsxs("div",{children:[e.jsx("label",{className:"textp",htmlFor:"cantidadEntregada",children:"Cantidad entregada:"}),e.jsx("input",{id:"cantidadEntregada",type:"number",value:O,onChange:u,className:"carrito-input"}),e.jsxs("p",{className:"textp",children:["Vuelto: $",h(F)]})]})]}),e.jsx("button",{className:"boton-venta",onClick:s,disabled:L,children:e.jsx("span",{children:L?"Procesando...":"Finalizar Venta"})})]})}),e.jsx("div",{className:"columna-derecha",children:e.jsx("section",{className:"tabla-ventas",children:e.jsxs("table",{className:"carrito-tabla",children:[e.jsx("thead",{className:"carrito-th",children:e.jsxs("tr",{className:"carrito-tr",children:[e.jsx("th",{className:"carrito-th",children:"Producto"}),e.jsx("th",{className:"carrito-th",children:"Precio"}),e.jsx("th",{className:"carrito-th",children:"Precio Original"})," ",e.jsx("th",{className:"carrito-th",children:"Cantidad"}),e.jsx("th",{className:"carrito-th",children:"Stock"}),e.jsx("th",{className:"carrito-th",children:"Total"}),e.jsx("th",{className:"carrito-th",children:"Acciones"})]})}),e.jsx("tbody",{className:"carrito-items",children:c.map(r=>e.jsxs("tr",{className:"carrito-tr",children:[e.jsx("td",{className:"carrito-td",children:e.jsx("p",{className:"txt-carrito",children:r.nombreProducto})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["$",h(r.precioProducto)]})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["$",h(r.precioOriginal)]})})," ",e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:[e.jsx("button",{className:"boton-resta",onClick:()=>d(r.id),children:e.jsx(K,{icon:Ce})}),r.cantidad,e.jsx("button",{className:"boton-suma",onClick:()=>t(r.id),children:e.jsx(K,{icon:ye})})]})}),e.jsx("td",{children:e.jsx("p",{className:(r.stockDisponible||0)<=5?"cantidad-baja":(r.stockDisponible||0)<=15?"cantidad-media":"cantidad-alta",children:r.stockDisponible||0})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["$",h(r.precioProducto*r.cantidad)]})}),e.jsx("td",{className:"carrito-td",children:e.jsx("button",{className:"boton-eliminar",onClick:()=>l(r.id),children:e.jsx(K,{icon:Ee})})})]},r.id))})]})})})]})})]})},Pa=()=>{const[y,v]=a.useState([]),[g,E]=a.useState(""),[n,c]=a.useState([]),[p,m]=a.useState(!0),[b,C]=a.useState(!1),[S,O]=a.useState(null),[D,F]=a.useState({idProducto:"",nombreProducto:"",precioProducto:"",precioOriginal:"",categoriaProducto:"",marcaProducto:"",cantidadProducto:""});a.useEffect(()=>{(async()=>{try{const l=(await _(H(A,"productos"))).docs.map(x=>({idProducto:x.id,...x.data()}));v(l),c(l)}catch{E("Error al cargar los productos. Intente más tarde.")}finally{m(!1)}})()},[]);const i=t=>{const d=t.target.value.toLowerCase();if(d==="")c(y);else{const l=y.filter(x=>{const u=String(x.idProducto).toLowerCase(),s=String(x.nombreProducto).toLowerCase(),h=String(x.precioProducto).toLowerCase(),P=String(x.categoriaProducto).toLowerCase(),I=String(x.marcaProducto).toLowerCase(),k=String(x.cantidadProducto).toLowerCase();return u.includes(d)||s.includes(d)||h.includes(d)||P.includes(d)||I.includes(d)||k.includes(d)});c(l)}},N=t=>`${(isNaN(t)?0:Number(t)).toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}`,V=t=>{O(t),F({idProducto:t.idProducto,nombreProducto:t.nombreProducto,precioProducto:t.precioProducto||0,precioOriginal:t.precioOriginal||0,categoriaProducto:t.categoriaProducto,marcaProducto:t.marcaProducto,cantidadProducto:t.cantidadProducto||0}),C(!0)},$=async t=>{if(window.confirm("¿Estás seguro de que deseas eliminar este producto?"))try{const d=J(A,"productos",t.idProducto);await Ae(d),v(l=>l.filter(x=>x.idProducto!==t.idProducto)),c(l=>l.filter(x=>x.idProducto!==t.idProducto)),alert("Producto eliminado exitosamente")}catch(d){console.error("Error al eliminar el producto:",d),alert("Error al eliminar el producto. Intente de nuevo.")}},w=t=>{const{name:d,value:l}=t.target;F({...D,[d]:l})},L=()=>{C(!1),O(null)},z=async t=>{t.preventDefault();try{const d=J(A,"productos",D.idProducto);await $e(d,{nombreProducto:D.nombreProducto,precioProducto:Number(D.precioProducto)||0,precioOriginal:Number(D.precioOriginal)||0,categoriaProducto:D.categoriaProducto,marcaProducto:D.marcaProducto,cantidadProducto:Number(D.cantidadProducto)||0}),v(l=>l.map(x=>x.idProducto===S.idProducto?{...x,...D}:x)),c(l=>l.map(x=>x.idProducto===S.idProducto?{...x,...D}:x)),L()}catch(d){console.error("Error al actualizar el producto:",d)}};n.reduce((t,d)=>t+(d.cantidadProducto||0),0);const R=n.reduce((t,d)=>t+(d.precioProducto||0)*(d.cantidadProducto||0),0),G=n.reduce((t,d)=>{const l=isNaN(d.precioOriginal)?0:Number(d.precioOriginal),x=isNaN(d.cantidadProducto)?0:Number(d.cantidadProducto);return t+l*x},0);return p?e.jsx("p",{children:"Cargando productos..."}):g?e.jsx("p",{children:g}):e.jsxs("div",{children:[e.jsx("div",{className:"nav",children:e.jsx(X,{})}),e.jsxs("div",{className:"body-tabla",children:[e.jsxs("main",{className:"table",children:[e.jsxs("section",{className:"table-header",children:[e.jsxs("p",{className:"form-title",children:["Total del Inventario: $",N(R)]}),e.jsxs("p",{className:"form-title",children:["Total Original: $",N(G)]}),e.jsxs("div",{className:"container-input",children:[e.jsx("input",{type:"text",placeholder:"Buscar producto",name:"text",className:"input",onChange:i}),e.jsx("svg",{fill:"#000000",width:"20px",height:"20px",viewBox:"0 0 1920 1920",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M790.588 1468.235c-373.722 0-677.647-303.924-677.647-677.647 0-373.722 303.925-677.647 677.647-677.647 373.723 0 677.647 303.925 677.647 677.647 0 373.723-303.924 677.647-677.647 677.647Zm596.781-160.715c120.396-138.692 193.807-319.285 193.807-516.932C1581.176 354.748 1226.428 0 790.588 0S0 354.748 0 790.588s354.748 790.588 790.588 790.588c197.647 0 378.24-73.411 516.932-193.807l516.028 516.142 79.963-79.963-516.142-516.028Z",fillRule:"evenodd"})})]})]}),e.jsx("section",{className:"table-body",children:e.jsxs("table",{className:"tabla-inventario",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Codigo"}),e.jsx("th",{children:"Nombre"}),e.jsx("th",{children:"Precio"}),e.jsx("th",{children:"Precio Original"}),e.jsx("th",{children:"Ganancias"}),e.jsx("th",{children:"Categoria"}),e.jsx("th",{children:"Marca"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:n.length>0?n.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.idProducto}),e.jsx("td",{children:t.nombreProducto}),e.jsx("td",{children:N(t.precioProducto||0)}),e.jsx("td",{children:N(t.precioOriginal||0)}),e.jsx("td",{children:N((t.precioProducto||0)-(t.precioOriginal||0))}),e.jsx("td",{children:t.categoriaProducto}),e.jsx("td",{children:t.marcaProducto}),e.jsx("td",{children:e.jsx("p",{className:(t.cantidadProducto||0)<=5?"cantidad-baja":(t.cantidadProducto||0)<=15?"cantidad-media":"cantidad-alta",children:t.cantidadProducto||0})}),e.jsxs("td",{className:"td-editar",children:[e.jsx("button",{className:"btn-editar",onClick:()=>V(t),children:e.jsx(K,{icon:ra})}),e.jsx("button",{className:"delete",onClick:()=>$(t),children:e.jsx(K,{icon:Ee})})]})]},t.idProducto)):e.jsx("tr",{children:e.jsx("td",{colSpan:"9",children:"No hay productos disponibles"})})})]})})]}),e.jsx(ce,{open:b,onClose:L,children:S&&e.jsxs("div",{className:"formulario-editar",children:[e.jsx("p",{className:"form-title",children:"Editar Producto "}),e.jsxs("form",{onSubmit:z,children:[e.jsxs("label",{children:["Nombre:",e.jsx("input",{type:"text",name:"nombreProducto",value:D.nombreProducto,onChange:w})]}),e.jsxs("label",{children:["Precio:",e.jsx("input",{type:"number",name:"precioProducto",value:D.precioProducto,onChange:w})]}),e.jsxs("label",{children:["Precio Original:",e.jsx("input",{type:"number",name:"precioOriginal",value:D.precioOriginal,onChange:w})]}),e.jsxs("label",{children:["Categoria:",e.jsx("input",{type:"text",name:"categoriaProducto",value:D.categoriaProducto,onChange:w})]}),e.jsxs("label",{children:["Marca:",e.jsx("input",{type:"text",name:"marcaProducto",value:D.marcaProducto,onChange:w})]}),e.jsxs("label",{children:["Cantidad:",e.jsx("input",{type:"number",name:"cantidadProducto",value:D.cantidadProducto,onChange:w})]}),e.jsx("button",{type:"submit",children:"Actualizar Producto"}),e.jsx("button",{type:"button",onClick:L,children:"Cancelar"})]})]})})]})]})},fa=()=>{const[y,v]=a.useState([]),[g,E]=a.useState(""),[n,c]=a.useState([]),[p,m]=a.useState(!0);a.useState("efectivo");const[b,C]=a.useState(""),[S,O]=a.useState(1),[D,F]=a.useState(!1),[i,N]=a.useState(!1);a.useEffect(()=>{let t=!0;return(async()=>{try{const l=H(A,"productos"),u=(await _(l)).docs.map(s=>({id:s.id,...s.data()}));t&&v(u)}catch(l){E("Error al obtener los productos"),console.error("Error al obtener los productos:",l)}finally{t&&m(!1)}})(),()=>{t=!1}},[]),a.useEffect(()=>{if(b.length>0){const t=y.find(d=>String(d.idProducto)===b);t?(D?w(t,S):$(t,S),C(""),O(1)):(E("Producto no encontrado."),setTimeout(()=>{E(""),C(""),O(1)},3e3))}},[b,y,S,D]);const V=t=>{C(t.target.value)},$=(t,d)=>{c(l=>l.find(u=>u.idProducto===t.idProducto)?l.map(u=>u.idProducto===t.idProducto?{...u,cantidad:u.cantidad+d}:u):[...l,{...t,cantidad:d}])},w=(t,d)=>{c(l=>l.find(u=>u.idProducto===t.idProducto)?l.map(u=>u.idProducto===t.idProducto?{...u,cantidad:u.cantidad+d}:u):[...l,{...t,cantidad:d}])},L=t=>{c(d=>d.map(l=>l.idProducto===t?{...l,cantidad:l.cantidad+1}:l))},z=t=>{c(d=>d.map(l=>l.idProducto===t?{...l,cantidad:Math.max(1,l.cantidad-1)}:l))},R=async t=>{t.preventDefault(),N(!0);const d=new Date,l=Q.currentUser;try{const x=n.reduce((P,I)=>P+I.precioProducto*I.cantidad,0),u=n.map(P=>({idProducto:P.idProducto,nombreProducto:P.nombreProducto,marcaProducto:P.marcaProducto,categoriaProducto:P.categoriaProducto,precioProducto:P.precioProducto,cantidad:P.cantidad})),s=l?l.uid:"";await Ne(H(A,"sales"),{fechaVenta:d,totalVenta:-x,idUsuario:s,productos:u,tipoPago:"devolucion"});const h=Se(A);n.forEach(P=>{const I=J(A,"productos",P.idProducto),k=P.cantidadProducto+P.cantidad;h.update(I,{cantidadProducto:k})}),await h.commit(),c([]),C(""),O(1),N(!1),alert("Operación realizada con éxito")}catch(x){E("Error al registrar la operación"),console.error("Error al registrar la operación:",x),N(!1)}},G=t=>`${t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}`;return p?e.jsxs("div",{children:[e.jsx(X,{}),e.jsx("h1",{children:"Cargando productos..."})]}):e.jsxs("div",{children:[e.jsx(X,{}),e.jsx("main",{className:"main1",children:e.jsxs("div",{className:"carrito-label-devolucion",children:[e.jsx("p",{className:"form-title",children:"Devolución"}),e.jsx("hr",{}),e.jsxs("div",{className:"encabezado",children:[e.jsx("input",{className:"carrito-input",type:"text",placeholder:"Buscar producto por ID...",value:b,onChange:V,onBlur:()=>{if(b.length>0){const t=y.find(d=>String(d.idProducto)===b);t?(D?w(t,S):$(t,S),C("")):E("Producto no encontrado.")}}}),e.jsx("input",{className:"carrito-input",type:"number",placeholder:"Cantidad...",value:S,min:"1",onChange:t=>{const d=parseInt(t.target.value,10);O(d<1?1:d)}})]}),e.jsxs("table",{className:"carrito-tabla",children:[e.jsx("thead",{className:"carrito-th",children:e.jsxs("tr",{className:"carrito-tr",children:[e.jsx("th",{className:"carrito-th",children:"Producto"}),e.jsx("th",{className:"carrito-th",children:"Precio"}),e.jsx("th",{className:"carrito-th",children:"Cantidad"}),e.jsx("th",{className:"carrito-th",children:"Total"})]})}),e.jsx("tbody",{className:"carrito-items",children:n.map(t=>e.jsxs("tr",{className:"carrito-tr",children:[e.jsx("td",{className:"carrito-td",children:e.jsx("p",{className:"txt-carrito",children:t.nombreProducto})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["-$",G(t.precioProducto)]})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:[e.jsx("button",{className:"boton-resta",onClick:()=>z(t.idProducto),children:e.jsx(K,{icon:Ce})}),e.jsx("span",{className:"spanCarrito",children:t.cantidad}),e.jsx("button",{className:"boton-suma",onClick:()=>L(t.idProducto),children:e.jsx(K,{icon:ye})})]})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["-$",G(t.precioProducto*t.cantidad)]})})]},t.idProducto))})]}),e.jsx("div",{className:"venta-label",children:e.jsx("div",{className:"totalcarro",children:e.jsxs("p",{className:"textp",children:["Total a Devolver: -$",G(n.reduce((t,d)=>t+d.cantidad*d.precioProducto,0))]})})}),e.jsx("div",{className:"bottom-container",children:e.jsx("button",{className:"boton-venta",onClick:R,disabled:n.length===0,children:e.jsx("span",{children:"Devolución"})})})]})})]})},Me=y=>ve(y,"dd/MM/yyyy"),va=()=>{const[y,v]=a.useState([]),[g,E]=a.useState(""),[n,c]=a.useState(!0),[p,m]=a.useState(!1),[b,C]=a.useState(!1),[S,O]=a.useState(null),[D,F]=a.useState(null),[i,N]=a.useState("todos"),[V,$]=a.useState(new Date),[w,L]=a.useState(null),[z,R]=a.useState(!1);a.useEffect(()=>{(async()=>{try{const f=H(A,"sales"),q=H(A,"users"),[se,He]=await Promise.all([_(f),_(q)]),le={};He.forEach(ee=>{le[ee.id]=ee.data().nombreUsuario}),console.log("Users data:",le);const we=se.docs.map(ee=>{const re=ee.data();return{idVenta:ee.id,...re,nombreUsuario:le[re.idUsuario]||"N/A",fechaVenta:re.fechaVenta.toDate()}});we.sort((ee,re)=>re.fechaVenta-ee.fechaVenta),v(we),c(!1)}catch(f){console.error("Error fetching data:",f),E("Ocurrió un error al cargar el historial de ventas"),c(!1)}})()},[]);const G=o=>{O(o),m(!0)},t=()=>{m(!1),O(null)},d=o=>{F(o),C(!0)},l=()=>{C(!1),F(null)},x=o=>{L(o),R(!0)},u=()=>{R(!1),L(null)},s=o=>{const{name:f,value:q}=o.target;O(se=>({...se,[f]:q}))},h=o=>{$(o)},P=async()=>{try{const o=J(A,"sales",S.idVenta);await $e(o,{idUsuario:S.idUsuario,tipoPago:S.tipoPago,totalVenta:parseFloat(S.totalVenta)}),v(f=>f.map(q=>q.idVenta===S.idVenta?S:q)),t()}catch(o){console.error("Error updating sale:",o)}},I=async()=>{try{const o=J(A,"sales",w.idVenta);await Ae(o),v(f=>f.filter(q=>q.idVenta!==w.idVenta)),u()}catch(o){console.error("Error deleting sale:",o)}},j=((o,f)=>f==="todos"?o:o.filter(q=>q.tipoPago===f))(((o,f)=>f?o.filter(q=>ve(q.fechaVenta,"dd/MM/yyyy")===ve(f,"dd/MM/yyyy")):o)(y,V),i),U=o=>{switch(o){case"efectivo":return"Efectivo";case"tarjeta":return"Tarjeta";case"devolucion":return"Devolución";default:return o}},T=o=>isNaN(o)?"0":`${o.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}`;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"nav",children:e.jsx(X,{})}),e.jsx("div",{className:"body-tabla",children:e.jsxs("main",{className:"table",children:[e.jsxs("section",{className:"table-header",children:[e.jsxs("p",{className:"form-title",children:["Total del día: $",T(j.reduce((o,f)=>o+(parseFloat(f.totalVenta)||0),0))]}),e.jsxs("p",{className:"form-title",children:["Total de Ganancia: $",T(j.reduce((o,f)=>o+(parseFloat(f.totalGanancia)||0),0))]}),e.jsx(ze,{dateAdapter:Ge,children:e.jsx(We,{className:"fecha",label:"Selecciona una fecha",value:V,onChange:o=>h(o),renderInput:o=>e.jsx(fe,{...o,style:{marginBottom:"16px"}})})}),e.jsxs(Ue,{className:"seleccionar-pago",children:[e.jsx(Te,{id:"tipoPago-label",children:"Tipo de Pago"}),e.jsxs(Oe,{labelId:"tipoPago-label",id:"tipoPago",value:i,onChange:o=>N(o.target.value),children:[e.jsx(ae,{value:"todos",children:"Todos"}),e.jsx(ae,{value:"efectivo",children:"Efectivo"}),e.jsx(ae,{value:"tarjeta",children:"Tarjeta"}),e.jsx(ae,{value:"devolucion",children:"Devolución"})]})]}),e.jsx(Y,{className:"btn-editar",onClick:()=>console.log("Exportar a Excel"),children:"Exportar a Excel"})]}),n?e.jsx("p",{children:"Cargando..."}):g?e.jsx("p",{className:"error-message",children:g}):j.length===0?e.jsx("p",{children:"No hay ventas registradas"}):e.jsx(oa,{component:na,children:e.jsxs(ue,{children:[e.jsx(he,{children:e.jsxs(te,{children:[e.jsx(B,{children:"ID Venta"}),e.jsx(B,{children:"Fecha"}),e.jsx(B,{children:"Nombre Usuario"}),e.jsx(B,{children:"Tipo Pago"}),e.jsx(B,{children:"Total Venta"}),e.jsx(B,{children:"Total Ganancia"}),e.jsx(B,{children:"Acciones"})]})}),e.jsx(me,{children:j.map(o=>e.jsxs(te,{children:[e.jsx(B,{children:o.idVenta}),e.jsx(B,{children:Me(o.fechaVenta)}),e.jsx(B,{children:o.nombreUsuario}),e.jsx(B,{children:U(o.tipoPago)}),e.jsxs(B,{children:["$",T(parseFloat(o.totalVenta)||0)]}),e.jsxs(B,{children:["$",T(parseFloat(o.totalGanancia)||0)]}),e.jsxs(B,{children:[e.jsx(Y,{variant:"outlined",onClick:()=>d(o),children:"Detalle"}),e.jsx(Y,{variant:"outlined",onClick:()=>G(o),children:"Editar"}),e.jsx(Y,{variant:"outlined",onClick:()=>x(o),children:"Eliminar"})]})]},o.idVenta))})]})})]})}),p&&e.jsxs(ce,{open:p,onClose:t,children:[e.jsx(xe,{children:"Editar Venta"}),e.jsx(je,{children:S&&e.jsxs("div",{children:[e.jsxs(Ue,{fullWidth:!0,margin:"normal",children:[e.jsx(Te,{id:"tipoPago-label",children:"Tipo de Pago"}),e.jsxs(Oe,{labelId:"tipoPago-label",id:"tipoPago",name:"tipoPago",value:S.tipoPago,onChange:s,children:[e.jsx(ae,{value:"efectivo",children:"Efectivo"}),e.jsx(ae,{value:"tarjeta",children:"Tarjeta"}),e.jsx(ae,{value:"devolucion",children:"Devolución"})]})]}),e.jsx(fe,{label:"Total Venta",name:"totalVenta",value:S.totalVenta,onChange:s,fullWidth:!0,margin:"normal"})]})}),e.jsxs(pe,{children:[e.jsx(Y,{onClick:t,children:"Cancelar"}),e.jsx(Y,{onClick:P,color:"primary",children:"Guardar"})]})]}),b&&e.jsxs(ce,{open:b,onClose:l,children:[e.jsx(xe,{children:"Detalle de Venta"}),e.jsx(je,{children:D&&e.jsxs(ue,{children:[e.jsx(he,{children:e.jsxs(te,{children:[e.jsx(B,{children:"ID Producto"}),e.jsx(B,{children:"Nombre Producto"}),e.jsx(B,{children:"Cantidad"}),e.jsx(B,{children:"Precio"})]})}),e.jsx(me,{children:D.productos.map(o=>e.jsxs(te,{children:[e.jsx(B,{children:o.idProducto}),e.jsx(B,{children:o.nombreProducto}),e.jsx(B,{children:o.cantidad}),e.jsxs(B,{children:["$",T(o.precio)]})]},o.idProducto))})]})}),e.jsx(pe,{children:e.jsx(Y,{onClick:l,children:"Cerrar"})})]}),z&&e.jsxs(ce,{open:z,onClose:u,children:[e.jsx(xe,{children:"Eliminar Venta"}),e.jsx(je,{children:w&&e.jsxs(ue,{children:[e.jsx(he,{children:e.jsxs(te,{children:[e.jsx(B,{children:"ID Venta:"}),e.jsx(B,{children:"Fecha:"}),e.jsx(B,{children:"Tipo de Pago:"}),e.jsx(B,{children:"Total Venta:"})]})}),e.jsx(me,{children:e.jsxs(te,{children:[e.jsx(B,{children:w.idVenta}),e.jsx(B,{children:Me(w.fechaVenta)}),e.jsx(B,{children:U(w.tipoPago)}),e.jsxs(B,{children:["$",T(parseFloat(w.totalVenta)||0)]})]})})]})}),e.jsxs(pe,{children:[e.jsx(Y,{onClick:u,children:"Cancelar"}),e.jsx(Y,{onClick:I,color:"error",children:"Eliminar"})]})]})]})},ba=()=>{const[y,v]=a.useState([]),[g,E]=a.useState({}),[n,c]=a.useState({}),[p,m]=a.useState({}),[b,C]=a.useState(0),[S,O]=a.useState(!0),[D,F]=a.useState(null),[i,N]=a.useState(new Date),[V,$]=a.useState("todos"),w=(l,x)=>x==="todos"?l:l.filter(u=>u.tipoPago===x),L=(l,x)=>{if(!x)return l;const u=ia(new Date(x)),s=ca(new Date(x));return l.filter(h=>h.fecha>=u&&h.fecha<=s)},z=(l,x)=>{const u={},s={},h={};let P=0;l.forEach(I=>{const{tipoPago:k,totalVenta:r,nombreUsuario:j,productos:U}=I;u[k]=(u[k]||0)+1,s[j]=(s[j]||0)+r,U.forEach(T=>{const{idProducto:o,cantidad:f}=T,q=x[o]||o;h[q]=(h[q]||0)+f}),P+=r}),E(u),c(s),m(h),C(P)};a.useEffect(()=>{(async()=>{try{const x=H(A,"sales"),u=H(A,"users"),s=H(A,"products"),[h,P,I]=await Promise.all([_(x),_(u),_(s)]),k={};P.forEach(T=>{k[T.id]=T.data().nombreUsuario});const r={};I.forEach(T=>{r[T.id]=T.data().nombreProducto});const j=h.docs.map(T=>{const o=T.data();let f;return o.fecha&&o.fecha.toDate?f=o.fecha.toDate():o.fecha&&o.fecha.toDate===void 0?f=new Date(o.fecha):f=new Date,{idVenta:T.id,...o,nombreUsuario:k[o.idUsuario]||"N/A",fecha:f}}),U=w(L(j,i),V);z(U,r),v(U),O(!1)}catch(x){console.error("Error fetching data:",x),F("Ocurrió un error al cargar el historial de ventas"),O(!1)}})()},[i,V]);const R={labels:Object.keys(g),datasets:[{label:"Ventas por Tipo de Pago",data:Object.values(g),backgroundColor:["rgba(75, 192, 192, 0.6)","rgba(153, 102, 255, 0.6)","rgba(255, 159, 64, 0.6)"]}]},G={labels:Object.keys(n),datasets:[{label:"Ventas por Usuario",data:Object.values(n),backgroundColor:["rgba(255, 99, 132, 0.6)","rgba(54, 162, 235, 0.6)","rgba(255, 206, 86, 0.6)","rgba(75, 192, 192, 0.6)","rgba(153, 102, 255, 0.6)","rgba(255, 159, 64, 0.6)"]}]},t={labels:Object.keys(p),datasets:[{label:"Ventas por Producto",data:Object.values(p),backgroundColor:["rgba(54, 162, 235, 0.6)","rgba(255, 99, 132, 0.6)","rgba(75, 192, 192, 0.6)","rgba(255, 206, 86, 0.6)","rgba(153, 102, 255, 0.6)","rgba(255, 159, 64, 0.6)"]}]},d=l=>new Intl.NumberFormat("es-ES").format(l);return S?e.jsx("p",{children:"Loading..."}):D?e.jsxs("p",{children:["Error: ",D]}):e.jsxs("div",{children:[e.jsx("div",{className:"nav",children:e.jsx(X,{})}),e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"date-filter",children:[e.jsx("h3",{children:"Filtrar por Fecha"}),e.jsx(ze,{dateAdapter:Ge,children:e.jsx(We,{value:i,onChange:l=>N(l),renderInput:l=>e.jsx(fe,{...l,style:{marginBottom:"16px"}})})})]}),e.jsx("div",{className:"metrics",children:e.jsxs("h2",{children:["Total Ventas: $",d(b.toFixed(0))]})}),e.jsxs("div",{className:"charts-container",children:[e.jsxs("div",{className:"pie-chart",children:[e.jsx("h3",{children:"Ventas por Tipo de Pago"}),e.jsx(da,{data:R})]}),e.jsxs("div",{className:"bar-charts",children:[e.jsxs("div",{className:"chart",children:[e.jsx("h3",{children:"Ventas por Usuario"}),e.jsx(Ie,{data:G})]}),e.jsxs("div",{className:"chart",children:[e.jsx("h3",{children:"Ventas por Producto"}),e.jsx(Ie,{data:t})]})]})]})]})]})},Na=()=>{const[y,v]=a.useState([]),[g,E]=a.useState([]),[n,c]=a.useState([]),[p,m]=a.useState([]),[b,C]=a.useState([]),[S,O]=a.useState([]);a.useEffect(()=>{const i=async()=>{const V=Ve(H(A,"sales"));ke(V,$=>{const w=[];$.forEach(L=>{w.push(L.data())}),v(w)})},N=async()=>{const V=Ve(H(A,"productos"));ke(V,$=>{const w=[];$.forEach(L=>{w.push(L.data())}),E(w)})};i(),N()},[]),a.useEffect(()=>{y.length>0&&g.length>0&&D()},[y,g]);const D=()=>{const i={},N={},V={},$={},w={};y.forEach(u=>{u.productos.forEach(s=>{const h=new Date(u.fechaVenta.seconds*1e3);(!i[s.idProducto]||h>i[s.idProducto])&&(i[s.idProducto]=h),N[s.idProducto]?N[s.idProducto]+=s.cantidad:N[s.idProducto]=s.cantidad;const P=Math.floor((h-new Date(h.getFullYear(),0,1))/(1e3*60*60*24*7));V[s.idProducto]||(V[s.idProducto]={}),V[s.idProducto][P]?V[s.idProducto][P]+=s.cantidad:V[s.idProducto][P]=s.cantidad;const I=g.find(k=>k.idProducto===s.idProducto);if(I){const k=(I.precioProducto-I.precioOriginal)*s.cantidad;w[s.idProducto]?w[s.idProducto]+=k:w[s.idProducto]=k}})}),g.forEach(u=>{const s=Object.keys(V[u.idProducto]||{}).length;$[u.idProducto]=s});const L=g.map(u=>{const s=i[u.idProducto]||new Date(0),h=Math.floor((new Date-s)/(1e3*60*60*24)),P=Object.values(V[u.idProducto]||{}).reduce((I,k)=>I+k,0);return{...u,totalVendido:N[u.idProducto]||0,diasDesdeUltimaVenta:h,ventasSemanalPromedio:P,frecuenciaReposicion:$[u.idProducto]||0,ganancia:w[u.idProducto]||0}}),z=L.sort((u,s)=>s.ganancia-u.ganancia||s.totalVendido-u.totalVendido),R=z.slice(0,20);C(R);const d=z.filter(u=>u.ganancia>0&&u.ventasSemanalPromedio>0).sort((u,s)=>s.ganancia-u.ganancia||s.ventasSemanalPromedio-u.ventasSemanalPromedio).slice(0,20);O(d);const x=L.sort((u,s)=>u.totalVendido-s.totalVendido||s.diasDesdeUltimaVenta-u.diasDesdeUltimaVenta).slice(0,20);m(x)},F=i=>new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP"}).format(i);return e.jsxs("div",{children:[e.jsx("h2",{children:"Análisis de Productos"}),e.jsxs("section",{className:"table-body",children:[e.jsx("h3",{children:"Top 20 Productos Populares"}),e.jsxs("table",{className:"tabla-inventario",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Nombre"}),e.jsx("th",{children:"Marca"}),e.jsx("th",{children:"Cantidad Total Vendida"}),e.jsx("th",{children:"Promedio Semanal Vendido"}),e.jsx("th",{children:"Días Desde Última Venta"}),e.jsx("th",{children:"Frecuencia de Reposición (Semanas)"})]})}),e.jsx("tbody",{children:n.map(i=>e.jsxs("tr",{children:[e.jsx("td",{children:i.idProducto}),e.jsx("td",{children:i.nombreProducto}),e.jsx("td",{children:i.marcaProducto}),e.jsx("td",{children:i.totalVendido}),e.jsx("td",{children:i.ventasSemanalPromedio}),e.jsx("td",{children:i.diasDesdeUltimaVenta}),e.jsx("td",{children:i.frecuenciaReposicion})]},i.idProducto))})]})]}),e.jsxs("section",{className:"table-body",children:[e.jsx("h3",{children:"Top 20 Productos Menos Populares"}),e.jsxs("table",{className:"tabla-inventario",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Nombre"}),e.jsx("th",{children:"Marca"}),e.jsx("th",{children:"Cantidad Total Vendida"}),e.jsx("th",{children:"Promedio Semanal Vendido"}),e.jsx("th",{children:"Días Desde Última Venta"}),e.jsx("th",{children:"Frecuencia de Reposición (Semanas)"})]})}),e.jsx("tbody",{children:p.map(i=>e.jsxs("tr",{children:[e.jsx("td",{children:i.idProducto}),e.jsx("td",{children:i.nombreProducto}),e.jsx("td",{children:i.marcaProducto}),e.jsx("td",{children:i.totalVendido}),e.jsx("td",{children:i.ventasSemanalPromedio}),e.jsx("td",{children:i.diasDesdeUltimaVenta}),e.jsx("td",{children:i.frecuenciaReposicion})]},i.idProducto))})]})]}),e.jsxs("section",{className:"table-body",children:[e.jsx("h3",{children:"Productos con Mayor Ganancia"}),e.jsxs("table",{className:"tabla-inventario",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Nombre"}),e.jsx("th",{children:"Marca"}),e.jsx("th",{children:"Ganancia"})]})}),e.jsx("tbody",{children:b.map(i=>e.jsxs("tr",{children:[e.jsx("td",{children:i.idProducto}),e.jsx("td",{children:i.nombreProducto}),e.jsx("td",{children:i.marcaProducto}),e.jsx("td",{children:F(i.ganancia)})]},i.idProducto))})]})]}),e.jsxs("section",{className:"table-body",children:[e.jsx("h3",{children:"Recomendaciones de Productos"}),e.jsxs("table",{className:"tabla-inventario",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Nombre"}),e.jsx("th",{children:"Marca"}),e.jsx("th",{children:"Ganancia"}),e.jsx("th",{children:"Promedio Semanal Vendido"})]})}),e.jsx("tbody",{children:S.map(i=>e.jsxs("tr",{children:[e.jsx("td",{children:i.idProducto}),e.jsx("td",{children:i.nombreProducto}),e.jsx("td",{children:i.marcaProducto}),e.jsx("td",{children:F(i.ganancia)}),e.jsx("td",{children:i.ventasSemanalPromedio})]},i.idProducto))})]})]})]})};function Sa(){return e.jsxs(e.Fragment,{children:[e.jsx(X,{}),e.jsx(Na,{})]})}const Ca=()=>{const y=ne(),[v,g]=oe.useState(!1),{signOut:E}=De(),n=async()=>{try{await E(),y("/")}catch(m){console.error("Error al cerrar sesión:",m)}},c=()=>{g(!v)},p=()=>{g(!1)};return oe.useEffect(()=>{const m=()=>{window.innerWidth>=800&&p()};return window.addEventListener("resize",m),()=>{window.removeEventListener("resize",m)}},[]),e.jsxs("nav",{className:"navbar",children:[e.jsxs("ul",{className:`sidebar ${v?"visible":""}`,children:[e.jsx("li",{onClick:p,children:e.jsx(M,{className:"menu",to:"#",children:e.jsx(K,{icon:Le})})}),e.jsx("li",{children:e.jsx(M,{className:"link",to:"/vendedor/ventas",children:"Venta"})}),e.jsx("li",{children:e.jsx(M,{className:"link",to:"/vendedor/inventario",children:"Inventario"})}),e.jsx("li",{children:e.jsx(M,{className:"link",to:"/vendedor/devolucion",children:"Devolución"})}),e.jsx("li",{children:e.jsx(M,{className:"link",onClick:n,children:"Cerrar Sesion"})})]}),e.jsxs("ul",{children:[e.jsx("li",{className:"Mobile",children:e.jsx(M,{className:"link",to:"/vendedor/inventario",children:"Inventario"})}),e.jsx("li",{className:"Mobile",children:e.jsx(M,{className:"link",to:"/vendedor/ventas",children:"Venta"})}),e.jsx("li",{className:"Mobile",children:e.jsx(M,{className:"link",to:"/vendedor/devolucion",children:"Devolución"})}),e.jsx("li",{className:"Mobile",children:e.jsx(M,{className:"link",onClick:n,children:"Cerrar Sesion"})}),e.jsx("li",{onClick:c,children:e.jsx(M,{className:"menu",to:"#",children:e.jsx(K,{icon:qe})})})]})]})},ya=()=>{const{currentUser:y}=a.useContext(de),[v,g]=a.useState([]),[E,n]=a.useState(""),[c,p]=a.useState([]),[m,b]=a.useState(!0),[C,S]=a.useState("efectivo"),[O,D]=a.useState(0),[F,i]=a.useState(0),[N,V]=a.useState(""),[$,w]=a.useState(1);a.useEffect(()=>{(async()=>{try{const P=(await _(H(A,"productos"))).docs.map(I=>({id:I.id,...I.data()}));g(P)}catch(h){n("Error al obtener los productos"),console.error("Error al obtener los productos:",h)}finally{b(!1)}})()},[y]),a.useEffect(()=>{if(N.length>0){const s=v.find(h=>String(h.id)===N);s?(z(s,$),V(""),w(1)):(n("Producto no encontrado."),setTimeout(()=>{n(""),V(""),w(1)},3e3))}},[N,v,$]);const L=s=>{V(s.target.value)},z=(s,h)=>{p(P=>{const I=P.find(k=>k.id===s.id);return I?I.cantidad+h<=s.cantidadProducto?P.map(k=>k.id===s.id?{...k,cantidad:k.cantidad+h}:k):(alert("Stock insuficiente"),P):s.cantidadProducto>=h?[...P,{...s,cantidad:h}]:(alert("Stock insuficiente"),P)})},R=s=>{p(h=>{var k;const P=h.find(r=>r.id===s),I=(k=v.find(r=>r.id===s))==null?void 0:k.cantidadProducto;return P&&I>P.cantidad?h.map(r=>r.id===s?{...r,cantidad:r.cantidad+1}:r):(alert("Stock insuficiente"),h)})},G=s=>{p(h=>h.map(P=>P.id===s?{...P,cantidad:Math.max(1,P.cantidad-1)}:P))},t=s=>{p(h=>h.filter(P=>P.id!==s))},d=s=>{S(s.target.value),s.target.value==="efectivo"&&(D(0),i(0))},l=s=>{const h=parseFloat(s.target.value);D(h);const P=c.reduce((I,k)=>I+k.precioProducto*k.cantidad,0);i(h-P)},x=async s=>{s.preventDefault();const h=new Date,P=c.reduce((r,j)=>r+j.precioProducto*j.cantidad,0),I=c.map(r=>({idProducto:r.id,nombreProducto:r.nombreProducto,marcaProducto:r.marcaProducto,categoriaProducto:r.categoriaProducto,precioProducto:r.precioProducto,cantidad:r.cantidad,cantidadProducto:r.cantidadProducto})),k=Q.currentUser;try{await Ne(H(A,"sales"),{fechaVenta:h,totalVenta:P,tipoPago:C,idUsuario:k.uid,productos:I});const r=Se(A);c.forEach(j=>{const U=J(A,"productos",j.id);r.update(U,{cantidadProducto:j.cantidadProducto-j.cantidad})}),await r.commit(),p([]),alert("Venta registrada con éxito")}catch(r){n("Error al registrar la venta"),console.error("Error al registrar la venta:",r)}},u=s=>`${s.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}`;return m?e.jsx("div",{children:e.jsx("h1",{children:"Cargando productos..."})}):e.jsxs("div",{children:[e.jsx("div",{className:"nav",children:e.jsx(Ca,{})}),e.jsx("main",{className:"main1",children:e.jsxs("div",{className:"carrito-label",children:[e.jsx("p",{className:"form-title",children:"Carrito de compras"}),e.jsx("hr",{}),e.jsxs("div",{className:"encabezado",children:[e.jsx("input",{className:"carrito-input",type:"text",placeholder:"Buscar producto por ID...",value:N,onChange:L,onBlur:()=>{if(N.length>0){const s=v.find(h=>String(h.id)===N);s?(z(s),V("")):n("Producto no encontrado.")}}}),e.jsx("input",{className:"carrito-input",type:"number",placeholder:"Cantidad...",value:$,min:"1",onChange:s=>{const h=parseInt(s.target.value);w(h<1?1:h)}})]}),E&&e.jsx("p",{className:"error",children:E}),e.jsx("section",{className:"tabla-ventas",children:e.jsxs("table",{className:"carrito-tabla",children:[e.jsx("thead",{className:"carrito-th",children:e.jsxs("tr",{className:"carrito-tr",children:[e.jsx("th",{className:"carrito-th",children:"Producto"}),e.jsx("th",{className:"carrito-th",children:"Precio"}),e.jsx("th",{className:"carrito-th",children:"Cantidad"}),e.jsx("th",{className:"carrito-th",children:"Total"}),e.jsx("th",{className:"carrito-th",children:"Acciones"})]})}),e.jsx("tbody",{className:"carrito-items",children:c.map(s=>e.jsxs("tr",{className:"carrito-tr",children:[e.jsx("td",{className:"carrito-td",children:e.jsx("p",{className:"txt-carrito",children:s.nombreProducto})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["$",u(s.precioProducto)]})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:[e.jsx("button",{className:"boton-resta",onClick:()=>G(s.idProducto),children:e.jsx(K,{icon:Ce})}),s.cantidad,e.jsx("button",{className:"boton-suma",onClick:()=>R(s.idProducto),children:e.jsx(K,{icon:ye})})]})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["$",u(s.precioProducto*s.cantidad)]})}),e.jsx("td",{className:"carrito-td",children:e.jsx("button",{className:"boton-eliminar",onClick:()=>t(s.idProducto),children:e.jsx(K,{icon:Ee})})})]},s.idProducto))})]})}),e.jsxs("div",{className:"pago",children:[e.jsx("label",{htmlFor:"tipoPago",children:"Tipo de pago:"}),e.jsxs("select",{id:"tipoPago",value:C,onChange:d,className:"carrito-input",children:[e.jsx("option",{value:"efectivo",children:"Efectivo"}),e.jsx("option",{value:"tarjeta",children:"Tarjeta"})]}),C==="efectivo"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"cantidadEntregada",children:"Cantidad entregada:"}),e.jsx("input",{id:"cantidadEntregada",type:"number",value:O,onChange:l,className:"carrito-input"}),e.jsxs("p",{className:"textp",children:["Vuelto: $",u(F)]})]})]}),e.jsx("button",{className:"boton-venta",onClick:x,children:e.jsx("span",{children:"Finalizar Venta"})})]})})]})};function Z({children:y,allowedRoles:v}){const{user:g,role:E}=De();return g?v&&!v.includes(E)?e.jsx(Pe,{to:"/unauthorized"}):y:e.jsx(Pe,{to:"/login"})}function Ea(){return e.jsxs(sa,{children:[e.jsx(W,{path:"/",element:e.jsx(Pe,{to:"/login"})}),e.jsx(W,{path:"/login",element:e.jsx(ha,{})}),e.jsx(W,{path:"/registro",element:e.jsx(xa,{})})," ",e.jsx(W,{path:"/resetPassword",element:e.jsx(ma,{})}),e.jsx(W,{path:"/agregarUsuario",element:e.jsx(Z,{allowedRoles:["admin"],children:e.jsx(ja,{})})}),e.jsx(W,{path:"/agregarProducto",element:e.jsx(Z,{allowedRoles:["admin"],children:e.jsx(pa,{})})}),e.jsx(W,{path:"/dashboard",element:e.jsx(Z,{allowedRoles:["admin"],children:e.jsx(ba,{})})}),e.jsx(W,{path:"/tenserFlow",element:e.jsx(Z,{allowedRoles:["admin"],children:e.jsx(Sa,{})})}),e.jsx(W,{path:"/ventas",element:e.jsx(Z,{allowedRoles:["admin","vendedor"],children:e.jsx(ga,{})})}),e.jsx(W,{path:"/inventario",element:e.jsx(Z,{allowedRoles:["admin"],children:e.jsx(Pa,{})})}),e.jsx(W,{path:"/devolucion",element:e.jsx(Z,{allowedRoles:["admin","vendedor"],children:e.jsx(fa,{})})}),e.jsx(W,{path:"/historial",element:e.jsx(Z,{allowedRoles:["admin"],children:e.jsx(va,{})})}),e.jsx(W,{path:"/vendedor/ventas",element:e.jsx(Z,{allowedRoles:["vendedor"],children:e.jsx(ya,{})})}),e.jsx(W,{path:"/unauthorized",element:e.jsx("div",{children:"Unauthorized - You do not have permission to view this page."})})]})}Ke.createRoot(document.getElementById("root")).render(e.jsx(oe.StrictMode,{children:e.jsx(aa,{children:e.jsx(ua,{children:e.jsx(Ea,{})})})}));
