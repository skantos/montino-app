import{r as t,j as e,a as se}from"./react-MB1aJdB0.js";import{c as We}from"./react-dom-babtui9j.js";import{g as Ie,s as He,a as Be,b as Ke,c as Me}from"./firebase-CB8Mk9P8.js";import{u as Je,v as Xe,w as Ze,x as _e,y as Ye,z as K,A as ge,B as be,D as Z,G as J,H as Ne,I as Se,J as $e,K as Fe}from"./@firebase-D0UA0DlC.js";import{L as T,B as Qe}from"./react-router-dom-BP5qz8hL.js";import{a as oe,b as ea,d as aa,e as H,f as fe}from"./react-router-BDFDsiw1.js";import{F as W,f as Le,a as Ae,b as Ce,c as ye,d as Ee,e as ta}from"./@fortawesome-Bn1EZEDH.js";import{D as ie,L as Re,A as qe,a as ze,T as Pe,F as ke,I as Ve,S as Ue,M as ae,B as X,b as ra,P as sa,c as ue,d as he,e as te,f as U,g as me,h as xe,i as je,j as pe}from"./@mui-D6ajMDpQ.js";import{f as ve,t as oa,m as na}from"./date-fns-5tFtsWfW.js";import{P as ia,B as Te}from"./react-chartjs-2-BMTf87bo.js";import"./chart.js-C_W9Dm9B.js";import"./@babel-DdaQcUjw.js";import"./scheduler-CzFDRTuY.js";import"./tslib-BGVaTf34.js";import"./safevalues-NrgD-8pg.js";import"./idb-Bn1DMRyg.js";import"./@remix-run-BFLWy9pZ.js";import"./prop-types-D-iIXjl8.js";import"./react-is-DcfIKM1A.js";import"./clsx-B-dksMZM.js";import"./@emotion-D2LlJvDI.js";import"./hoist-non-react-statics-DQogQWOa.js";import"./stylis-FDnFs_-n.js";import"./react-transition-group-DD9RWrmj.js";import"./dom-helpers-D0mFdbeO.js";import"./@popperjs-BQBsAJpH.js";import"./@kurkle-BZxJdD1U.js";(function(){const j=document.createElement("link").relList;if(j&&j.supports&&j.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))C(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const x of n.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&C(x)}).observe(document,{childList:!0,subtree:!0});function P(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function C(o){if(o.ep)return;o.ep=!0;const n=P(o);fetch(o.href,n)}})();const ca={apiKey:"AIzaSyAP7Af1h_-zBmBfL_A5K2uuJsJDFuOel0c",authDomain:"local-js-d7712.firebaseapp.com",databaseURL:"https://local-js-d7712-default-rtdb.firebaseio.com",projectId:"local-js-d7712",storageBucket:"local-js-d7712.appspot.com",messagingSenderId:"200538761653",appId:"1:200538761653:web:571a969ac8a572328451fc",measurementId:"G-XXD5WT5TV1"},ne=Je(ca),_=Ie(ne),M=Xe(ne);Ze(ne);_e(ne);Ye(ne);const ce=t.createContext();function la({children:S}){const[j,P]=t.useState(null),[C,o]=t.useState(null);t.useEffect(()=>{const m=_.onAuthStateChanged(async p=>{if(p){P(p);const v=K(M,"users",p.uid),g=await ge(v);g.exists()?o(g.data().rolUsuario):o(null)}else P(null),o(null)});return()=>m()},[]);const n=async(m,p)=>{try{const v=await He(_,m,p);P(v.user);const g=K(M,"users",v.user.uid),V=await ge(g);V.exists()?o(V.data().rolUsuario):o(null)}catch(v){throw console.error("Error signing in:",v),v}},x=async()=>{try{await Be(_),P(null),o(null)}catch(m){throw console.error("Error signing out:",m),m}};return e.jsx(ce.Provider,{value:{user:j,role:C,signIn:n,signOut:x},children:S})}function De(){return t.useContext(ce)}function da(){const[S,j]=t.useState(""),[P,C]=t.useState(""),[o,n]=t.useState(""),x=oe(),{signIn:m,role:p}=De(),v=async g=>{g.preventDefault(),n("");try{await m(S,P)}catch(V){n("Usuario o contraseña incorrectos"),console.error("Error al iniciar sesión:",V)}};return t.useEffect(()=>{p&&(p==="admin"?x("/ventas"):p==="vendedor"?x("/vendedor/ventas"):n("Rol de usuario no reconocido"))},[p,x]),e.jsx("div",{children:e.jsx("div",{className:"login-box",children:e.jsxs("form",{className:"form",onSubmit:v,children:[e.jsxs("p",{className:"form-title",children:["Los Tios ",e.jsx("br",{}),"Iniciar Sesión"]}),e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"email",placeholder:"Email",value:S,onChange:g=>j(g.target.value),required:!0})}),e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"password",placeholder:"Contraseña",value:P,onChange:g=>C(g.target.value),required:!0})}),o&&e.jsx("p",{className:"signup-link",children:o}),e.jsx("button",{type:"submit",className:"submit",children:"Ingresar"}),e.jsx("p",{className:"signup-link",children:e.jsx(T,{to:"/resetPassword",className:"resetPassword",children:"Olvidé mi Contraseña"})})]})})})}const ua=()=>{const[S,j]=t.useState(""),[P,C]=t.useState(!1),[o,n]=t.useState(null),x=oe(),m=()=>{Ke(_,S).then(()=>{C(!0),setTimeout(()=>{x("/")},6e3)}).catch(p=>{n("No se pudo enviar el correo electrónico de restablecimiento de contraseña.")})};return e.jsxs("div",{className:"login-box",children:[e.jsxs("p",{className:"form-title",children:["Recuperar",e.jsx("br",{}),"Contraseña"]}),P?e.jsx("p",{children:"Se ha enviado un correo electrónico con instrucciones para restablecer tu contraseña."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"email",placeholder:"Correo Electrónico",value:S,onChange:p=>j(p.target.value),required:!0})}),e.jsx("button",{onClick:m,variant:"outlined",className:"submit",children:"Enviar"})]}),e.jsx("p",{className:"signup-link",children:e.jsx(T,{to:"/login",className:"resetPassword",children:"Iniciar Sesion"})})]})},ha=()=>{const[S,j]=t.useState(""),[P,C]=t.useState(""),[o,n]=t.useState(""),[x,m]=t.useState("vendedor"),[p,v]=t.useState(""),[g,V]=t.useState(""),D=oe(),$=async w=>{w.preventDefault();try{if(o.length<6){v("La contraseña debe tener al menos 6 caracteres.");return}const L=(await Me(_,P,o)).user;await be(K(M,"users",L.uid),{nombreUsuario:S,emailUsuario:P,rolUsuario:x}),V("Usuario registrado exitosamente"),j(""),C(""),n(""),m("vendedor"),D("/dashboard")}catch(y){console.error("Error al registrar el usuario:",y),y.code==="auth/email-already-in-use"?v("El correo electrónico ya está en uso. Por favor, use otro."):y.code==="permission-denied"?v("Permiso denegado. Verifica las reglas de seguridad."):v("Error al registrar el usuario")}};return e.jsx("div",{children:e.jsxs("div",{className:"login-box",children:[e.jsx("p",{className:"form-title",children:"Registrar Usuario"}),e.jsxs("form",{className:"form",onSubmit:$,children:[e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"text",placeholder:"Nombre de Usuario",value:S,onChange:w=>j(w.target.value),required:!0})}),e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"email",placeholder:"Email",value:P,onChange:w=>C(w.target.value),required:!0})}),e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"password",placeholder:"Contraseña",value:o,onChange:w=>n(w.target.value),required:!0})}),e.jsx("div",{className:"input-container",children:e.jsxs("select",{value:x,onChange:w=>m(w.target.value),required:!0,children:[e.jsx("option",{value:"vendedor",children:"Vendedor"}),e.jsx("option",{value:"admin",children:"Administrador"})]})}),p&&e.jsx("p",{className:"error-message",children:p}),g&&e.jsx("p",{className:"success-message",children:g}),e.jsx("button",{className:"submit",type:"submit",children:"Registrar Usuario"})]})]})})},Y=()=>{const S=oe(),j=ea(),[P,C]=se.useState(!1),o=async()=>{const p=Ie();try{await Be(p),localStorage.removeItem("token"),S("/")}catch(v){console.error("Error al cerrar sesión:",v)}},n=()=>{C(!P)},x=()=>{C(!1)};se.useEffect(()=>{const p=()=>{window.innerWidth>=800&&x()};return window.addEventListener("resize",p),()=>{window.removeEventListener("resize",p)}},[]);const m=p=>j.pathname===p?"active":"";return e.jsxs("nav",{className:"navbar",children:[e.jsxs("ul",{className:`sidebar ${P?"visible":""}`,children:[e.jsx("li",{onClick:x,children:e.jsx(T,{className:"menu",to:"#",children:e.jsx(W,{icon:Le})})}),e.jsx("li",{children:e.jsx(T,{className:`link ${m("/ventas")}`,to:"/ventas",children:"Venta"})}),e.jsx("li",{children:e.jsx(T,{className:`link ${m("/agregarProducto")}`,to:"/agregarProducto",children:"Agregar Producto"})}),e.jsx("li",{children:e.jsx(T,{className:`link ${m("/agregarUsuario")}`,to:"/agregarUsuario",children:"Agregar Usuario"})}),e.jsx("li",{children:e.jsx(T,{className:`link ${m("/inventario")}`,to:"/inventario",children:"Inventario"})}),e.jsx("li",{children:e.jsx(T,{className:`link ${m("/devolucion")}`,to:"/devolucion",children:"Devolución"})}),e.jsx("li",{children:e.jsx(T,{className:`link ${m("/dashboard")}`,to:"/dashboard",children:"Dashboard"})}),e.jsx("li",{children:e.jsx(T,{className:`link ${m("/historial")}`,to:"/historial",children:"Historial"})}),e.jsx("li",{children:e.jsx(T,{className:"link",onClick:o,children:"Cerrar Sesión"})})]}),e.jsxs("ul",{children:[e.jsx("li",{className:"Mobile",children:e.jsx(T,{className:`link ${m("/dashboard")}`,to:"/dashboard",children:"Dashboard"})}),e.jsx("li",{className:"Mobile",children:e.jsx(T,{className:`link ${m("/agregarProducto")}`,to:"/agregarProducto",children:"Agregar Producto"})}),e.jsx("li",{className:"Mobile",children:e.jsx(T,{className:`link ${m("/agregarUsuario")}`,to:"/agregarUsuario",children:"Agregar Usuario"})}),e.jsx("li",{className:"Mobile",children:e.jsx(T,{className:`link ${m("/devolucion")}`,to:"/devolucion",children:"Devolución"})}),e.jsx("li",{className:"Mobile",children:e.jsx(T,{className:`link ${m("/ventas")}`,to:"/ventas",children:"Venta"})}),e.jsx("li",{className:"Mobile",children:e.jsx(T,{className:`link ${m("/inventario")}`,to:"/inventario",children:"Inventario"})}),e.jsx("li",{className:"Mobile",children:e.jsx(T,{className:`link ${m("/historial")}`,to:"/historial",children:"Historial"})}),e.jsx("li",{className:"Mobile",children:e.jsx(T,{className:"link",onClick:o,children:"Cerrar Sesión"})}),e.jsx("li",{onClick:n,children:e.jsx(T,{className:"menu",to:"#",children:e.jsx(W,{icon:Ae})})})]})]})},ma=()=>{const[S,j]=t.useState(""),[P,C]=t.useState(""),[o,n]=t.useState(""),[x,m]=t.useState("vendedor"),[p,v]=t.useState(""),[g,V]=t.useState(""),D=async $=>{$.preventDefault(),console.log("Nombre de Usuario:",S),console.log("Email:",P),console.log("Contraseña:",o),console.log("Rol:",x);try{const y=(await Me(_,P,o)).user;console.log("Usuario creado:",y),await be(K(M,"users",y.uid),{nombreUsuario:S,emailUsuario:P,rolUsuario:x}),V("Usuario registrado exitosamente"),j(""),C(""),n(""),m("vendedor")}catch(w){console.error("Error al registrar el usuario:",w),w.code==="auth/email-already-in-use"?v("El correo electrónico ya está en uso. Por favor, use otro."):w.code==="permission-denied"?v("Permiso denegado. Verifica las reglas de seguridad."):v("Error al registrar el usuario")}};return e.jsxs("div",{children:[e.jsx("div",{className:"nav",children:e.jsx(Y,{})}),e.jsxs("div",{className:"login-box",children:[e.jsx("p",{className:"form-title",children:"Registrar Usuario"}),e.jsxs("form",{className:"form",onSubmit:D,children:[e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"text",placeholder:"Nombre de Usuario",value:S,onChange:$=>j($.target.value),required:!0})}),e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"email",placeholder:"Email",value:P,onChange:$=>C($.target.value),required:!0})}),e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"password",placeholder:"Contraseña",value:o,onChange:$=>n($.target.value),required:!0})}),e.jsx("div",{className:"input-container",children:e.jsxs("select",{value:x,onChange:$=>m($.target.value),required:!0,children:[e.jsx("option",{value:"vendedor",children:"Vendedor"}),e.jsx("option",{value:"admin",children:"Administrador"})]})}),p&&e.jsx("p",{className:"signup-link",children:p}),g&&e.jsx("p",{className:"signup-link",children:g}),e.jsx("button",{className:"submit",type:"submit",children:"Registrar Usuario"})]})]})]})},xa=()=>{const[S,j]=t.useState(""),[P,C]=t.useState(""),[o,n]=t.useState(""),[x,m]=t.useState(""),[p,v]=t.useState(""),[g,V]=t.useState(""),[D,$]=t.useState(""),[w,y]=t.useState(""),[L,q]=t.useState(""),O=async()=>{try{const I=K(M,"productos",S);return(await ge(I)).exists()}catch(I){return console.error("Error checking product existence:",I),y("Error al verificar la existencia del producto"),!1}},z=async I=>{if(I.preventDefault(),isNaN(o)||isNaN(x)||isNaN(D)){y("Todos los campos de precio y cantidad deben ser números válidos.");return}const A=Number(o),a=Number(x),i=Number(D);if(A<=0||a<0||i<=0){y("Precio Producto y Cantidad Producto deben ser números positivos. Precio Original puede ser 0 o positivo.");return}if(await O()){y("El producto ya está registrado");return}try{const h=K(M,"productos",S);await be(h,{idProducto:S,nombreProducto:P,precioProducto:A,precioOriginal:a,categoriaProducto:p,marcaProducto:g,cantidadProducto:i}),q("Producto registrado exitosamente"),j(""),C(""),n(""),m(""),v(""),V(""),$(""),y("")}catch(h){y("Hubo un error al registrar el producto"),console.error("Error al registrar el producto:",h)}},R=I=>A=>{const a=A.target.value;/^\d*$/.test(a)&&I(a)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"nav",children:e.jsx(Y,{})}),e.jsx("div",{children:e.jsxs("div",{className:"productos-box",children:[e.jsx("p",{className:"form-title",children:"Ingresar Producto"}),e.jsxs("form",{className:"form-producto",onSubmit:z,children:[e.jsxs("div",{className:"detalle",children:[e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Código Producto"}),e.jsx("input",{type:"text",placeholder:"Id Producto",value:S,onChange:I=>j(I.target.value),required:!0})]}),e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Nombre producto"}),e.jsx("input",{type:"text",placeholder:"Nombre Producto",value:P,onChange:I=>C(I.target.value),required:!0})]}),e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Precio Producto"}),e.jsx("input",{type:"number",placeholder:"Precio Producto",value:o,onChange:R(n),min:"0",step:"1",required:!0})]}),e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Precio Original"}),e.jsx("input",{type:"number",placeholder:"Precio Original",value:x,onChange:R(m),min:"0",step:"1"})]}),e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Categoria Producto"}),e.jsx("input",{type:"text",placeholder:"Categoria Producto",value:p,onChange:I=>v(I.target.value)})]}),e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Marca Producto"}),e.jsx("input",{type:"text",placeholder:"Marca Producto",value:g,onChange:I=>V(I.target.value)})]}),e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Cantidad Producto"}),e.jsx("input",{type:"number",placeholder:"Cantidad Producto",value:D,onChange:R($),min:"1",step:"1",required:!0})]})]}),w&&e.jsx("p",{className:"form-title",children:w}),L&&e.jsx("p",{className:"form-title",children:L}),e.jsx("button",{className:"submit",type:"submit",children:"Agregar Producto"})]})]})})]})},ja=()=>{const{currentUser:S}=t.useContext(ce),[j,P]=t.useState([]),[C,o]=t.useState(""),[n,x]=t.useState([]),[m,p]=t.useState(!0),[v,g]=t.useState("efectivo"),[V,D]=t.useState(0),[$,w]=t.useState(0),[y,L]=t.useState(""),[q,O]=t.useState(1);t.useEffect(()=>{(async()=>{try{const u=(await Z(J(M,"productos"))).docs.map(k=>({id:k.id,...k.data()}));P(u)}catch(d){o("Error al obtener los productos"),console.error("Error al obtener los productos:",d)}finally{p(!1)}})()},[S]),t.useEffect(()=>{if(y.length>0){const r=j.find(d=>String(d.id)===y);r?(R(r,q),L(""),O(1)):(o("Producto no encontrado."),setTimeout(()=>{o(""),L(""),O(1)},3e3))}},[y,j,q]);const z=r=>{L(r.target.value)},R=(r,d)=>{x(u=>{const k=u.find(F=>F.id===r.id);return k?k.cantidad+d<=r.cantidadProducto?u.map(F=>F.id===r.id?{...F,cantidad:F.cantidad+d}:F):(alert("Stock insuficiente"),u):r.cantidadProducto>=d?[...u,{...r,cantidad:d,precioOriginal:r.precioOriginal,stockDisponible:r.cantidadProducto}]:(alert("Stock insuficiente"),u)})},I=r=>{x(d=>{var F;const u=d.find(E=>E.id===r),k=(F=j.find(E=>E.id===r))==null?void 0:F.cantidadProducto;return u&&k>u.cantidad?d.map(E=>E.id===r?{...E,cantidad:E.cantidad+1}:E):u&&k===0?(alert("El stock del producto es 0"),d):(alert("Stock insuficiente"),d)})},A=r=>{x(d=>d.map(u=>u.id===r?{...u,cantidad:Math.max(1,u.cantidad-1)}:u))},a=r=>{x(d=>d.filter(u=>u.id!==r))},i=r=>{g(r.target.value),r.target.value==="efectivo"&&(D(0),w(0))},c=r=>{const d=parseFloat(r.target.value);D(d);const u=n.reduce((k,F)=>k+F.precioProducto*F.cantidad,0);w(d-u)},h=async r=>{if(r.preventDefault(),n.length===0){alert("No se puede registrar una venta con un carrito vacío.");return}const d=new Date,u=n.reduce((E,s)=>E+s.precioProducto*s.cantidad,0),k=n.map(E=>({idProducto:E.id,nombreProducto:E.nombreProducto,marcaProducto:E.marcaProducto,categoriaProducto:E.categoriaProducto,precioProducto:E.precioProducto??0,precioOriginal:E.precioOriginal??0,cantidad:E.cantidad,cantidadProducto:E.cantidadProducto})),F=_.currentUser;try{await Ne(J(M,"sales"),{fechaVenta:d,totalVenta:u,totalGanancia:f,tipoPago:v,idUsuario:F.uid,productos:k});const E=Se(M);n.forEach(s=>{const B=K(M,"productos",s.id);E.update(B,{cantidadProducto:s.cantidadProducto-s.cantidad})}),await E.commit(),x([]),alert("Venta registrada con éxito")}catch(E){o("Error al registrar la venta"),console.error("Error al registrar la venta:",E)}},N=r=>r==null?"0":`${r.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}`,l=n.reduce((r,d)=>r+d.cantidad,0),b=n.reduce((r,d)=>r+d.precioProducto*d.cantidad,0),f=n.reduce((r,d)=>{const u=d.precioProducto??0,k=d.precioOriginal??0,F=k===0?0:(u-k)*d.cantidad;return r+F},0);return m?e.jsxs("div",{children:[e.jsx(Y,{}),e.jsx("h1",{children:"Cargando productos..."})]}):e.jsxs("div",{children:[e.jsx("div",{className:"nav",children:e.jsx(Y,{})}),e.jsx("main",{className:"main1",children:e.jsxs("div",{className:"layout",children:[e.jsx("div",{className:"columna-izquierda",children:e.jsxs("div",{className:"carrito-label",children:[e.jsx("p",{className:"form-title",children:"Carrito de compras"}),e.jsxs("div",{className:"encabezado",children:[e.jsx("input",{className:"carrito-input",type:"text",placeholder:"Buscar producto por ID...",value:y,onChange:z,onBlur:()=>{if(y.length>0){const r=j.find(d=>String(d.id)===y);r?(R(r),L("")):o("Producto no encontrado.")}}}),e.jsx("input",{className:"carrito-input",type:"number",placeholder:"Cantidad...",value:q,min:"1",onChange:r=>{const d=parseInt(r.target.value);O(d<1?1:d)}})]}),e.jsx("label",{className:"textp",htmlFor:"tipoPago",children:"Tipo de pago:"}),e.jsxs("select",{id:"tipoPago",value:v,onChange:i,className:"carrito-input",children:[e.jsx("option",{value:"efectivo",children:"Efectivo"}),e.jsx("option",{value:"tarjeta",children:"Tarjeta"})]}),C&&e.jsx("p",{className:"error",children:C}),e.jsxs("div",{className:"pago",children:[e.jsxs("p",{className:"textp",children:["Total productos: ",l]}),e.jsx("br",{}),e.jsxs("p",{className:"textp",children:["Total ganancia: $",N(f)]})," ",e.jsx("br",{}),e.jsxs("p",{className:"textp",children:["Total monto: $",N(b)]}),v==="efectivo"&&e.jsxs("div",{children:[e.jsx("label",{className:"textp",htmlFor:"cantidadEntregada",children:"Cantidad entregada:"}),e.jsx("input",{id:"cantidadEntregada",type:"number",value:V,onChange:c,className:"carrito-input"}),e.jsxs("p",{className:"textp",children:["Vuelto: $",N($)]})]})]}),e.jsx("button",{className:"boton-venta",onClick:h,children:e.jsx("span",{children:"Finalizar Venta"})})]})}),e.jsx("div",{className:"columna-derecha",children:e.jsx("section",{className:"tabla-ventas",children:e.jsxs("table",{className:"carrito-tabla",children:[e.jsx("thead",{className:"carrito-th",children:e.jsxs("tr",{className:"carrito-tr",children:[e.jsx("th",{className:"carrito-th",children:"Producto"}),e.jsx("th",{className:"carrito-th",children:"Precio"}),e.jsx("th",{className:"carrito-th",children:"Precio Original"})," ",e.jsx("th",{className:"carrito-th",children:"Cantidad"}),e.jsx("th",{className:"carrito-th",children:"Stock"}),e.jsx("th",{className:"carrito-th",children:"Total"}),e.jsx("th",{className:"carrito-th",children:"Acciones"})]})}),e.jsx("tbody",{className:"carrito-items",children:n.map(r=>e.jsxs("tr",{className:"carrito-tr",children:[e.jsx("td",{className:"carrito-td",children:e.jsx("p",{className:"txt-carrito",children:r.nombreProducto})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["$",N(r.precioProducto)]})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["$",N(r.precioOriginal)]})})," ",e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:[e.jsx("button",{className:"boton-resta",onClick:()=>A(r.id),children:e.jsx(W,{icon:Ce})}),r.cantidad,e.jsx("button",{className:"boton-suma",onClick:()=>I(r.id),children:e.jsx(W,{icon:ye})})]})}),e.jsx("td",{children:e.jsx("p",{className:(r.stockDisponible||0)<=5?"cantidad-baja":(r.stockDisponible||0)<=15?"cantidad-media":"cantidad-alta",children:r.stockDisponible||0})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["$",N(r.precioProducto*r.cantidad)]})}),e.jsx("td",{className:"carrito-td",children:e.jsx("button",{className:"boton-eliminar",onClick:()=>a(r.id),children:e.jsx(W,{icon:Ee})})})]},r.id))})]})})})]})})]})},pa=()=>{const[S,j]=t.useState([]),[P,C]=t.useState(""),[o,n]=t.useState([]),[x,m]=t.useState(!0),[p,v]=t.useState(!1),[g,V]=t.useState(null),[D,$]=t.useState({idProducto:"",nombreProducto:"",precioProducto:"",precioOriginal:"",categoriaProducto:"",marcaProducto:"",cantidadProducto:""});t.useEffect(()=>{(async()=>{try{const c=(await Z(J(M,"productos"))).docs.map(h=>({idProducto:h.id,...h.data()}));j(c),n(c)}catch{C("Error al cargar los productos. Intente más tarde.")}finally{m(!1)}})()},[]);const w=a=>{const i=a.target.value.toLowerCase();if(i==="")n(S);else{const c=S.filter(h=>{const N=String(h.idProducto).toLowerCase(),l=String(h.nombreProducto).toLowerCase(),b=String(h.precioProducto).toLowerCase(),f=String(h.categoriaProducto).toLowerCase(),r=String(h.marcaProducto).toLowerCase(),d=String(h.cantidadProducto).toLowerCase();return N.includes(i)||l.includes(i)||b.includes(i)||f.includes(i)||r.includes(i)||d.includes(i)});n(c)}},y=a=>`${(isNaN(a)?0:Number(a)).toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}`,L=a=>{V(a),$({idProducto:a.idProducto,nombreProducto:a.nombreProducto,precioProducto:a.precioProducto||0,precioOriginal:a.precioOriginal||0,categoriaProducto:a.categoriaProducto,marcaProducto:a.marcaProducto,cantidadProducto:a.cantidadProducto||0}),v(!0)},q=async a=>{if(window.confirm("¿Estás seguro de que deseas eliminar este producto?"))try{const i=K(M,"productos",a.idProducto);await $e(i),j(c=>c.filter(h=>h.idProducto!==a.idProducto)),n(c=>c.filter(h=>h.idProducto!==a.idProducto)),alert("Producto eliminado exitosamente")}catch(i){console.error("Error al eliminar el producto:",i),alert("Error al eliminar el producto. Intente de nuevo.")}},O=a=>{const{name:i,value:c}=a.target;$({...D,[i]:c})},z=()=>{v(!1),V(null)},R=async a=>{a.preventDefault();try{const i=K(M,"productos",D.idProducto);await Fe(i,{nombreProducto:D.nombreProducto,precioProducto:Number(D.precioProducto)||0,precioOriginal:Number(D.precioOriginal)||0,categoriaProducto:D.categoriaProducto,marcaProducto:D.marcaProducto,cantidadProducto:Number(D.cantidadProducto)||0}),j(c=>c.map(h=>h.idProducto===g.idProducto?{...h,...D}:h)),n(c=>c.map(h=>h.idProducto===g.idProducto?{...h,...D}:h)),z()}catch(i){console.error("Error al actualizar el producto:",i)}};o.reduce((a,i)=>a+(i.cantidadProducto||0),0);const I=o.reduce((a,i)=>a+(i.precioProducto||0)*(i.cantidadProducto||0),0),A=o.reduce((a,i)=>{const c=isNaN(i.precioOriginal)?0:Number(i.precioOriginal),h=isNaN(i.cantidadProducto)?0:Number(i.cantidadProducto);return a+c*h},0);return x?e.jsx("p",{children:"Cargando productos..."}):P?e.jsx("p",{children:P}):e.jsxs("div",{children:[e.jsx("div",{className:"nav",children:e.jsx(Y,{})}),e.jsxs("div",{className:"body-tabla",children:[e.jsxs("main",{className:"table",children:[e.jsxs("section",{className:"table-header",children:[e.jsxs("p",{className:"form-title",children:["Total del Inventario: $",y(I)]}),e.jsxs("p",{className:"form-title",children:["Total Original: $",y(A)]}),e.jsxs("div",{className:"container-input",children:[e.jsx("input",{type:"text",placeholder:"Buscar producto",name:"text",className:"input",onChange:w}),e.jsx("svg",{fill:"#000000",width:"20px",height:"20px",viewBox:"0 0 1920 1920",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M790.588 1468.235c-373.722 0-677.647-303.924-677.647-677.647 0-373.722 303.925-677.647 677.647-677.647 373.723 0 677.647 303.925 677.647 677.647 0 373.723-303.924 677.647-677.647 677.647Zm596.781-160.715c120.396-138.692 193.807-319.285 193.807-516.932C1581.176 354.748 1226.428 0 790.588 0S0 354.748 0 790.588s354.748 790.588 790.588 790.588c197.647 0 378.24-73.411 516.932-193.807l516.028 516.142 79.963-79.963-516.142-516.028Z",fillRule:"evenodd"})})]})]}),e.jsx("section",{className:"table-body",children:e.jsxs("table",{className:"tabla-inventario",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Codigo"}),e.jsx("th",{children:"Nombre"}),e.jsx("th",{children:"Precio"}),e.jsx("th",{children:"Precio Original"}),e.jsx("th",{children:"Ganancias"}),e.jsx("th",{children:"Categoria"}),e.jsx("th",{children:"Marca"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:o.length>0?o.map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:a.idProducto}),e.jsx("td",{children:a.nombreProducto}),e.jsx("td",{children:y(a.precioProducto||0)}),e.jsx("td",{children:y(a.precioOriginal||0)}),e.jsx("td",{children:y((a.precioProducto||0)-(a.precioOriginal||0))}),e.jsx("td",{children:a.categoriaProducto}),e.jsx("td",{children:a.marcaProducto}),e.jsx("td",{children:e.jsx("p",{className:(a.cantidadProducto||0)<=5?"cantidad-baja":(a.cantidadProducto||0)<=15?"cantidad-media":"cantidad-alta",children:a.cantidadProducto||0})}),e.jsxs("td",{className:"td-editar",children:[e.jsx("button",{className:"btn-editar",onClick:()=>L(a),children:e.jsx(W,{icon:ta})}),e.jsx("button",{className:"delete",onClick:()=>q(a),children:e.jsx(W,{icon:Ee})})]})]},a.idProducto)):e.jsx("tr",{children:e.jsx("td",{colSpan:"9",children:"No hay productos disponibles"})})})]})})]}),e.jsx(ie,{open:p,onClose:z,children:g&&e.jsxs("div",{className:"formulario-editar",children:[e.jsx("p",{className:"form-title",children:"Editar Producto "}),e.jsxs("form",{onSubmit:R,children:[e.jsxs("label",{children:["Nombre:",e.jsx("input",{type:"text",name:"nombreProducto",value:D.nombreProducto,onChange:O})]}),e.jsxs("label",{children:["Precio:",e.jsx("input",{type:"number",name:"precioProducto",value:D.precioProducto,onChange:O})]}),e.jsxs("label",{children:["Precio Original:",e.jsx("input",{type:"number",name:"precioOriginal",value:D.precioOriginal,onChange:O})]}),e.jsxs("label",{children:["Categoria:",e.jsx("input",{type:"text",name:"categoriaProducto",value:D.categoriaProducto,onChange:O})]}),e.jsxs("label",{children:["Marca:",e.jsx("input",{type:"text",name:"marcaProducto",value:D.marcaProducto,onChange:O})]}),e.jsxs("label",{children:["Cantidad:",e.jsx("input",{type:"number",name:"cantidadProducto",value:D.cantidadProducto,onChange:O})]}),e.jsx("button",{type:"submit",children:"Actualizar Producto"}),e.jsx("button",{type:"button",onClick:z,children:"Cancelar"})]})]})})]})]})},ga=()=>{const[S,j]=t.useState([]),[P,C]=t.useState(""),[o,n]=t.useState([]),[x,m]=t.useState(!0);t.useState("efectivo");const[p,v]=t.useState(""),[g,V]=t.useState(1),[D,$]=t.useState(!1),[w,y]=t.useState(!1);t.useEffect(()=>{let a=!0;return(async()=>{try{const c=J(M,"productos"),N=(await Z(c)).docs.map(l=>({id:l.id,...l.data()}));a&&j(N)}catch(c){C("Error al obtener los productos"),console.error("Error al obtener los productos:",c)}finally{a&&m(!1)}})(),()=>{a=!1}},[]),t.useEffect(()=>{if(p.length>0){const a=S.find(i=>String(i.idProducto)===p);a?(D?O(a,g):q(a,g),v(""),V(1)):(C("Producto no encontrado."),setTimeout(()=>{C(""),v(""),V(1)},3e3))}},[p,S,g,D]);const L=a=>{v(a.target.value)},q=(a,i)=>{n(c=>c.find(N=>N.idProducto===a.idProducto)?c.map(N=>N.idProducto===a.idProducto?{...N,cantidad:N.cantidad+i}:N):[...c,{...a,cantidad:i}])},O=(a,i)=>{n(c=>c.find(N=>N.idProducto===a.idProducto)?c.map(N=>N.idProducto===a.idProducto?{...N,cantidad:N.cantidad+i}:N):[...c,{...a,cantidad:i}])},z=a=>{n(i=>i.map(c=>c.idProducto===a?{...c,cantidad:c.cantidad+1}:c))},R=a=>{n(i=>i.map(c=>c.idProducto===a?{...c,cantidad:Math.max(1,c.cantidad-1)}:c))},I=async a=>{a.preventDefault(),y(!0);const i=new Date,c=_.currentUser;try{const h=o.reduce((f,r)=>f+r.precioProducto*r.cantidad,0),N=o.map(f=>({idProducto:f.idProducto,nombreProducto:f.nombreProducto,marcaProducto:f.marcaProducto,categoriaProducto:f.categoriaProducto,precioProducto:f.precioProducto,cantidad:f.cantidad})),l=c?c.uid:"";await Ne(J(M,"sales"),{fechaVenta:i,totalVenta:-h,idUsuario:l,productos:N,tipoPago:"devolucion"});const b=Se(M);o.forEach(f=>{const r=K(M,"productos",f.idProducto),d=f.cantidadProducto+f.cantidad;b.update(r,{cantidadProducto:d})}),await b.commit(),n([]),v(""),V(1),y(!1),alert("Operación realizada con éxito")}catch(h){C("Error al registrar la operación"),console.error("Error al registrar la operación:",h),y(!1)}},A=a=>`${a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}`;return x?e.jsxs("div",{children:[e.jsx(Y,{}),e.jsx("h1",{children:"Cargando productos..."})]}):e.jsxs("div",{children:[e.jsx(Y,{}),e.jsx("main",{className:"main1",children:e.jsxs("div",{className:"carrito-label-devolucion",children:[e.jsx("p",{className:"form-title",children:"Devolución"}),e.jsx("hr",{}),e.jsxs("div",{className:"encabezado",children:[e.jsx("input",{className:"carrito-input",type:"text",placeholder:"Buscar producto por ID...",value:p,onChange:L,onBlur:()=>{if(p.length>0){const a=S.find(i=>String(i.idProducto)===p);a?(D?O(a,g):q(a,g),v("")):C("Producto no encontrado.")}}}),e.jsx("input",{className:"carrito-input",type:"number",placeholder:"Cantidad...",value:g,min:"1",onChange:a=>{const i=parseInt(a.target.value,10);V(i<1?1:i)}})]}),e.jsxs("table",{className:"carrito-tabla",children:[e.jsx("thead",{className:"carrito-th",children:e.jsxs("tr",{className:"carrito-tr",children:[e.jsx("th",{className:"carrito-th",children:"Producto"}),e.jsx("th",{className:"carrito-th",children:"Precio"}),e.jsx("th",{className:"carrito-th",children:"Cantidad"}),e.jsx("th",{className:"carrito-th",children:"Total"})]})}),e.jsx("tbody",{className:"carrito-items",children:o.map(a=>e.jsxs("tr",{className:"carrito-tr",children:[e.jsx("td",{className:"carrito-td",children:e.jsx("p",{className:"txt-carrito",children:a.nombreProducto})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["-$",A(a.precioProducto)]})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:[e.jsx("button",{className:"boton-resta",onClick:()=>R(a.idProducto),children:e.jsx(W,{icon:Ce})}),e.jsx("span",{className:"spanCarrito",children:a.cantidad}),e.jsx("button",{className:"boton-suma",onClick:()=>z(a.idProducto),children:e.jsx(W,{icon:ye})})]})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["-$",A(a.precioProducto*a.cantidad)]})})]},a.idProducto))})]}),e.jsx("div",{className:"venta-label",children:e.jsx("div",{className:"totalcarro",children:e.jsxs("p",{className:"textp",children:["Total a Devolver: -$",A(o.reduce((a,i)=>a+i.cantidad*i.precioProducto,0))]})})}),e.jsx("div",{className:"bottom-container",children:e.jsx("button",{className:"boton-venta",onClick:I,disabled:o.length===0,children:e.jsx("span",{children:"Devolución"})})})]})})]})},Oe=S=>ve(S,"dd/MM/yyyy"),fa=()=>{const[S,j]=t.useState([]),[P,C]=t.useState(""),[o,n]=t.useState(!0),[x,m]=t.useState(!1),[p,v]=t.useState(!1),[g,V]=t.useState(null),[D,$]=t.useState(null),[w,y]=t.useState("todos"),[L,q]=t.useState(new Date),[O,z]=t.useState(null),[R,I]=t.useState(!1);t.useEffect(()=>{(async()=>{try{const B=J(M,"sales"),G=J(M,"users"),[le,Ge]=await Promise.all([Z(B),Z(G)]),de={};Ge.forEach(ee=>{de[ee.id]=ee.data().nombreUsuario}),console.log("Users data:",de);const we=le.docs.map(ee=>{const re=ee.data();return{idVenta:ee.id,...re,nombreUsuario:de[re.idUsuario]||"N/A",fechaVenta:re.fechaVenta.toDate()}});we.sort((ee,re)=>re.fechaVenta-ee.fechaVenta),j(we),n(!1)}catch(B){console.error("Error fetching data:",B),C("Ocurrió un error al cargar el historial de ventas"),n(!1)}})()},[]);const A=s=>{V(s),m(!0)},a=()=>{m(!1),V(null)},i=s=>{$(s),v(!0)},c=()=>{v(!1),$(null)},h=s=>{z(s),I(!0)},N=()=>{I(!1),z(null)},l=s=>{const{name:B,value:G}=s.target;V(le=>({...le,[B]:G}))},b=s=>{q(s)},f=async()=>{try{const s=K(M,"sales",g.idVenta);await Fe(s,{idUsuario:g.idUsuario,tipoPago:g.tipoPago,totalVenta:parseFloat(g.totalVenta)}),j(B=>B.map(G=>G.idVenta===g.idVenta?g:G)),a()}catch(s){console.error("Error updating sale:",s)}},r=async()=>{try{const s=K(M,"sales",O.idVenta);await $e(s),j(B=>B.filter(G=>G.idVenta!==O.idVenta)),N()}catch(s){console.error("Error deleting sale:",s)}},k=((s,B)=>B==="todos"?s:s.filter(G=>G.tipoPago===B))(((s,B)=>B?s.filter(G=>ve(G.fechaVenta,"dd/MM/yyyy")===ve(B,"dd/MM/yyyy")):s)(S,L),w),F=s=>{switch(s){case"efectivo":return"Efectivo";case"tarjeta":return"Tarjeta";case"devolucion":return"Devolución";default:return s}},E=s=>isNaN(s)?"0":`${s.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}`;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"nav",children:e.jsx(Y,{})}),e.jsx("div",{className:"body-tabla",children:e.jsxs("main",{className:"table",children:[e.jsxs("section",{className:"table-header",children:[e.jsxs("p",{className:"form-title",children:["Total del día: $",E(k.reduce((s,B)=>s+(parseFloat(B.totalVenta)||0),0))]}),e.jsxs("p",{className:"form-title",children:["Total de Ganancia: $",E(k.reduce((s,B)=>s+(parseFloat(B.totalGanancia)||0),0))]}),e.jsx(Re,{dateAdapter:qe,children:e.jsx(ze,{className:"fecha",label:"Selecciona una fecha",value:L,onChange:s=>b(s),renderInput:s=>e.jsx(Pe,{...s,style:{marginBottom:"16px"}})})}),e.jsxs(ke,{className:"seleccionar-pago",children:[e.jsx(Ve,{id:"tipoPago-label",children:"Tipo de Pago"}),e.jsxs(Ue,{labelId:"tipoPago-label",id:"tipoPago",value:w,onChange:s=>y(s.target.value),children:[e.jsx(ae,{value:"todos",children:"Todos"}),e.jsx(ae,{value:"efectivo",children:"Efectivo"}),e.jsx(ae,{value:"tarjeta",children:"Tarjeta"}),e.jsx(ae,{value:"devolucion",children:"Devolución"})]})]}),e.jsx(X,{className:"btn-editar",onClick:()=>console.log("Exportar a Excel"),children:"Exportar a Excel"})]}),o?e.jsx("p",{children:"Cargando..."}):P?e.jsx("p",{className:"error-message",children:P}):k.length===0?e.jsx("p",{children:"No hay ventas registradas"}):e.jsx(ra,{component:sa,children:e.jsxs(ue,{children:[e.jsx(he,{children:e.jsxs(te,{children:[e.jsx(U,{children:"ID Venta"}),e.jsx(U,{children:"Fecha"}),e.jsx(U,{children:"Nombre Usuario"}),e.jsx(U,{children:"Tipo Pago"}),e.jsx(U,{children:"Total Venta"}),e.jsx(U,{children:"Total Ganancia"}),e.jsx(U,{children:"Acciones"})]})}),e.jsx(me,{children:k.map(s=>e.jsxs(te,{children:[e.jsx(U,{children:s.idVenta}),e.jsx(U,{children:Oe(s.fechaVenta)}),e.jsx(U,{children:s.nombreUsuario}),e.jsx(U,{children:F(s.tipoPago)}),e.jsxs(U,{children:["$",E(parseFloat(s.totalVenta)||0)]}),e.jsxs(U,{children:["$",E(parseFloat(s.totalGanancia)||0)]}),e.jsxs(U,{children:[e.jsx(X,{variant:"outlined",onClick:()=>i(s),children:"Detalle"}),e.jsx(X,{variant:"outlined",onClick:()=>A(s),children:"Editar"}),e.jsx(X,{variant:"outlined",onClick:()=>h(s),children:"Eliminar"})]})]},s.idVenta))})]})})]})}),x&&e.jsxs(ie,{open:x,onClose:a,children:[e.jsx(xe,{children:"Editar Venta"}),e.jsx(je,{children:g&&e.jsxs("div",{children:[e.jsxs(ke,{fullWidth:!0,margin:"normal",children:[e.jsx(Ve,{id:"tipoPago-label",children:"Tipo de Pago"}),e.jsxs(Ue,{labelId:"tipoPago-label",id:"tipoPago",name:"tipoPago",value:g.tipoPago,onChange:l,children:[e.jsx(ae,{value:"efectivo",children:"Efectivo"}),e.jsx(ae,{value:"tarjeta",children:"Tarjeta"}),e.jsx(ae,{value:"devolucion",children:"Devolución"})]})]}),e.jsx(Pe,{label:"Total Venta",name:"totalVenta",value:g.totalVenta,onChange:l,fullWidth:!0,margin:"normal"})]})}),e.jsxs(pe,{children:[e.jsx(X,{onClick:a,children:"Cancelar"}),e.jsx(X,{onClick:f,color:"primary",children:"Guardar"})]})]}),p&&e.jsxs(ie,{open:p,onClose:c,children:[e.jsx(xe,{children:"Detalle de Venta"}),e.jsx(je,{children:D&&e.jsxs(ue,{children:[e.jsx(he,{children:e.jsxs(te,{children:[e.jsx(U,{children:"ID Producto"}),e.jsx(U,{children:"Nombre Producto"}),e.jsx(U,{children:"Cantidad"}),e.jsx(U,{children:"Precio"})]})}),e.jsx(me,{children:D.productos.map(s=>e.jsxs(te,{children:[e.jsx(U,{children:s.idProducto}),e.jsx(U,{children:s.nombreProducto}),e.jsx(U,{children:s.cantidad}),e.jsxs(U,{children:["$",E(s.precio)]})]},s.idProducto))})]})}),e.jsx(pe,{children:e.jsx(X,{onClick:c,children:"Cerrar"})})]}),R&&e.jsxs(ie,{open:R,onClose:N,children:[e.jsx(xe,{children:"Eliminar Venta"}),e.jsx(je,{children:O&&e.jsxs(ue,{children:[e.jsx(he,{children:e.jsxs(te,{children:[e.jsx(U,{children:"ID Venta:"}),e.jsx(U,{children:"Fecha:"}),e.jsx(U,{children:"Tipo de Pago:"}),e.jsx(U,{children:"Total Venta:"})]})}),e.jsx(me,{children:e.jsxs(te,{children:[e.jsx(U,{children:O.idVenta}),e.jsx(U,{children:Oe(O.fechaVenta)}),e.jsx(U,{children:F(O.tipoPago)}),e.jsxs(U,{children:["$",E(parseFloat(O.totalVenta)||0)]})]})})]})}),e.jsxs(pe,{children:[e.jsx(X,{onClick:N,children:"Cancelar"}),e.jsx(X,{onClick:r,color:"error",children:"Eliminar"})]})]})]})},Pa=()=>{const[S,j]=t.useState([]),[P,C]=t.useState({}),[o,n]=t.useState({}),[x,m]=t.useState({}),[p,v]=t.useState(0),[g,V]=t.useState(!0),[D,$]=t.useState(null),[w,y]=t.useState(new Date),[L,q]=t.useState("todos"),O=(c,h)=>h==="todos"?c:c.filter(N=>N.tipoPago===h),z=(c,h)=>{if(!h)return c;const N=oa(new Date(h)),l=na(new Date(h));return c.filter(b=>b.fecha>=N&&b.fecha<=l)},R=(c,h)=>{const N={},l={},b={};let f=0;c.forEach(r=>{const{tipoPago:d,totalVenta:u,nombreUsuario:k,productos:F}=r;N[d]=(N[d]||0)+1,l[k]=(l[k]||0)+u,F.forEach(E=>{const{idProducto:s,cantidad:B}=E,G=h[s]||s;b[G]=(b[G]||0)+B}),f+=u}),C(N),n(l),m(b),v(f)};t.useEffect(()=>{(async()=>{try{const h=J(M,"sales"),N=J(M,"users"),l=J(M,"products"),[b,f,r]=await Promise.all([Z(h),Z(N),Z(l)]),d={};f.forEach(E=>{d[E.id]=E.data().nombreUsuario});const u={};r.forEach(E=>{u[E.id]=E.data().nombreProducto});const k=b.docs.map(E=>{const s=E.data();let B;return s.fecha&&s.fecha.toDate?B=s.fecha.toDate():s.fecha&&s.fecha.toDate===void 0?B=new Date(s.fecha):B=new Date,{idVenta:E.id,...s,nombreUsuario:d[s.idUsuario]||"N/A",fecha:B}}),F=O(z(k,w),L);R(F,u),j(F),V(!1)}catch(h){console.error("Error fetching data:",h),$("Ocurrió un error al cargar el historial de ventas"),V(!1)}})()},[w,L]);const I={labels:Object.keys(P),datasets:[{label:"Ventas por Tipo de Pago",data:Object.values(P),backgroundColor:["rgba(75, 192, 192, 0.6)","rgba(153, 102, 255, 0.6)","rgba(255, 159, 64, 0.6)"]}]},A={labels:Object.keys(o),datasets:[{label:"Ventas por Usuario",data:Object.values(o),backgroundColor:["rgba(255, 99, 132, 0.6)","rgba(54, 162, 235, 0.6)","rgba(255, 206, 86, 0.6)","rgba(75, 192, 192, 0.6)","rgba(153, 102, 255, 0.6)","rgba(255, 159, 64, 0.6)"]}]},a={labels:Object.keys(x),datasets:[{label:"Ventas por Producto",data:Object.values(x),backgroundColor:["rgba(54, 162, 235, 0.6)","rgba(255, 99, 132, 0.6)","rgba(75, 192, 192, 0.6)","rgba(255, 206, 86, 0.6)","rgba(153, 102, 255, 0.6)","rgba(255, 159, 64, 0.6)"]}]},i=c=>new Intl.NumberFormat("es-ES").format(c);return g?e.jsx("p",{children:"Loading..."}):D?e.jsxs("p",{children:["Error: ",D]}):e.jsxs("div",{children:[e.jsx("div",{className:"nav",children:e.jsx(Y,{})}),e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"date-filter",children:[e.jsx("h3",{children:"Filtrar por Fecha"}),e.jsx(Re,{dateAdapter:qe,children:e.jsx(ze,{value:w,onChange:c=>y(c),renderInput:c=>e.jsx(Pe,{...c,style:{marginBottom:"16px"}})})})]}),e.jsx("div",{className:"metrics",children:e.jsxs("h2",{children:["Total Ventas: $",i(p.toFixed(0))]})}),e.jsxs("div",{className:"charts-container",children:[e.jsxs("div",{className:"pie-chart",children:[e.jsx("h3",{children:"Ventas por Tipo de Pago"}),e.jsx(ia,{data:I})]}),e.jsxs("div",{className:"bar-charts",children:[e.jsxs("div",{className:"chart",children:[e.jsx("h3",{children:"Ventas por Usuario"}),e.jsx(Te,{data:A})]}),e.jsxs("div",{className:"chart",children:[e.jsx("h3",{children:"Ventas por Producto"}),e.jsx(Te,{data:a})]})]})]})]})]})},va=()=>{const S=oe(),[j,P]=se.useState(!1),{signOut:C}=De(),o=async()=>{try{await C(),S("/")}catch(m){console.error("Error al cerrar sesión:",m)}},n=()=>{P(!j)},x=()=>{P(!1)};return se.useEffect(()=>{const m=()=>{window.innerWidth>=800&&x()};return window.addEventListener("resize",m),()=>{window.removeEventListener("resize",m)}},[]),e.jsxs("nav",{className:"navbar",children:[e.jsxs("ul",{className:`sidebar ${j?"visible":""}`,children:[e.jsx("li",{onClick:x,children:e.jsx(T,{className:"menu",to:"#",children:e.jsx(W,{icon:Le})})}),e.jsx("li",{children:e.jsx(T,{className:"link",to:"/vendedor/ventas",children:"Venta"})}),e.jsx("li",{children:e.jsx(T,{className:"link",to:"/vendedor/inventario",children:"Inventario"})}),e.jsx("li",{children:e.jsx(T,{className:"link",to:"/vendedor/devolucion",children:"Devolución"})}),e.jsx("li",{children:e.jsx(T,{className:"link",onClick:o,children:"Cerrar Sesion"})})]}),e.jsxs("ul",{children:[e.jsx("li",{className:"Mobile",children:e.jsx(T,{className:"link",to:"/vendedor/inventario",children:"Inventario"})}),e.jsx("li",{className:"Mobile",children:e.jsx(T,{className:"link",to:"/vendedor/ventas",children:"Venta"})}),e.jsx("li",{className:"Mobile",children:e.jsx(T,{className:"link",to:"/vendedor/devolucion",children:"Devolución"})}),e.jsx("li",{className:"Mobile",children:e.jsx(T,{className:"link",onClick:o,children:"Cerrar Sesion"})}),e.jsx("li",{onClick:n,children:e.jsx(T,{className:"menu",to:"#",children:e.jsx(W,{icon:Ae})})})]})]})},ba=()=>{const{currentUser:S}=t.useContext(ce),[j,P]=t.useState([]),[C,o]=t.useState(""),[n,x]=t.useState([]),[m,p]=t.useState(!0),[v,g]=t.useState("efectivo"),[V,D]=t.useState(0),[$,w]=t.useState(0),[y,L]=t.useState(""),[q,O]=t.useState(1);t.useEffect(()=>{(async()=>{try{const f=(await Z(J(M,"productos"))).docs.map(r=>({id:r.id,...r.data()}));P(f)}catch(b){o("Error al obtener los productos"),console.error("Error al obtener los productos:",b)}finally{p(!1)}})()},[S]),t.useEffect(()=>{if(y.length>0){const l=j.find(b=>String(b.id)===y);l?(R(l,q),L(""),O(1)):(o("Producto no encontrado."),setTimeout(()=>{o(""),L(""),O(1)},3e3))}},[y,j,q]);const z=l=>{L(l.target.value)},R=(l,b)=>{x(f=>{const r=f.find(d=>d.id===l.id);return r?r.cantidad+b<=l.cantidadProducto?f.map(d=>d.id===l.id?{...d,cantidad:d.cantidad+b}:d):(alert("Stock insuficiente"),f):l.cantidadProducto>=b?[...f,{...l,cantidad:b}]:(alert("Stock insuficiente"),f)})},I=l=>{x(b=>{var d;const f=b.find(u=>u.id===l),r=(d=j.find(u=>u.id===l))==null?void 0:d.cantidadProducto;return f&&r>f.cantidad?b.map(u=>u.id===l?{...u,cantidad:u.cantidad+1}:u):(alert("Stock insuficiente"),b)})},A=l=>{x(b=>b.map(f=>f.id===l?{...f,cantidad:Math.max(1,f.cantidad-1)}:f))},a=l=>{x(b=>b.filter(f=>f.id!==l))},i=l=>{g(l.target.value),l.target.value==="efectivo"&&(D(0),w(0))},c=l=>{const b=parseFloat(l.target.value);D(b);const f=n.reduce((r,d)=>r+d.precioProducto*d.cantidad,0);w(b-f)},h=async l=>{l.preventDefault();const b=new Date,f=n.reduce((u,k)=>u+k.precioProducto*k.cantidad,0),r=n.map(u=>({idProducto:u.id,nombreProducto:u.nombreProducto,marcaProducto:u.marcaProducto,categoriaProducto:u.categoriaProducto,precioProducto:u.precioProducto,cantidad:u.cantidad,cantidadProducto:u.cantidadProducto})),d=_.currentUser;try{await Ne(J(M,"sales"),{fechaVenta:b,totalVenta:f,tipoPago:v,idUsuario:d.uid,productos:r});const u=Se(M);n.forEach(k=>{const F=K(M,"productos",k.id);u.update(F,{cantidadProducto:k.cantidadProducto-k.cantidad})}),await u.commit(),x([]),alert("Venta registrada con éxito")}catch(u){o("Error al registrar la venta"),console.error("Error al registrar la venta:",u)}},N=l=>`${l.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}`;return m?e.jsx("div",{children:e.jsx("h1",{children:"Cargando productos..."})}):e.jsxs("div",{children:[e.jsx("div",{className:"nav",children:e.jsx(va,{})}),e.jsx("main",{className:"main1",children:e.jsxs("div",{className:"carrito-label",children:[e.jsx("p",{className:"form-title",children:"Carrito de compras"}),e.jsx("hr",{}),e.jsxs("div",{className:"encabezado",children:[e.jsx("input",{className:"carrito-input",type:"text",placeholder:"Buscar producto por ID...",value:y,onChange:z,onBlur:()=>{if(y.length>0){const l=j.find(b=>String(b.id)===y);l?(R(l),L("")):o("Producto no encontrado.")}}}),e.jsx("input",{className:"carrito-input",type:"number",placeholder:"Cantidad...",value:q,min:"1",onChange:l=>{const b=parseInt(l.target.value);O(b<1?1:b)}})]}),C&&e.jsx("p",{className:"error",children:C}),e.jsx("section",{className:"tabla-ventas",children:e.jsxs("table",{className:"carrito-tabla",children:[e.jsx("thead",{className:"carrito-th",children:e.jsxs("tr",{className:"carrito-tr",children:[e.jsx("th",{className:"carrito-th",children:"Producto"}),e.jsx("th",{className:"carrito-th",children:"Precio"}),e.jsx("th",{className:"carrito-th",children:"Cantidad"}),e.jsx("th",{className:"carrito-th",children:"Total"}),e.jsx("th",{className:"carrito-th",children:"Acciones"})]})}),e.jsx("tbody",{className:"carrito-items",children:n.map(l=>e.jsxs("tr",{className:"carrito-tr",children:[e.jsx("td",{className:"carrito-td",children:e.jsx("p",{className:"txt-carrito",children:l.nombreProducto})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["$",N(l.precioProducto)]})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:[e.jsx("button",{className:"boton-resta",onClick:()=>A(l.idProducto),children:e.jsx(W,{icon:Ce})}),l.cantidad,e.jsx("button",{className:"boton-suma",onClick:()=>I(l.idProducto),children:e.jsx(W,{icon:ye})})]})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["$",N(l.precioProducto*l.cantidad)]})}),e.jsx("td",{className:"carrito-td",children:e.jsx("button",{className:"boton-eliminar",onClick:()=>a(l.idProducto),children:e.jsx(W,{icon:Ee})})})]},l.idProducto))})]})}),e.jsxs("div",{className:"pago",children:[e.jsx("label",{htmlFor:"tipoPago",children:"Tipo de pago:"}),e.jsxs("select",{id:"tipoPago",value:v,onChange:i,className:"carrito-input",children:[e.jsx("option",{value:"efectivo",children:"Efectivo"}),e.jsx("option",{value:"tarjeta",children:"Tarjeta"})]}),v==="efectivo"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"cantidadEntregada",children:"Cantidad entregada:"}),e.jsx("input",{id:"cantidadEntregada",type:"number",value:V,onChange:c,className:"carrito-input"}),e.jsxs("p",{className:"textp",children:["Vuelto: $",N($)]})]})]}),e.jsx("button",{className:"boton-venta",onClick:h,children:e.jsx("span",{children:"Finalizar Venta"})})]})})]})};function Q({children:S,allowedRoles:j}){const{user:P,role:C}=De();return P?j&&!j.includes(C)?e.jsx(fe,{to:"/unauthorized"}):S:e.jsx(fe,{to:"/login"})}function Na(){return e.jsxs(aa,{children:[e.jsx(H,{path:"/",element:e.jsx(fe,{to:"/login"})}),e.jsx(H,{path:"/login",element:e.jsx(da,{})}),e.jsx(H,{path:"/registro",element:e.jsx(ha,{})})," ",e.jsx(H,{path:"/resetPassword",element:e.jsx(ua,{})}),e.jsx(H,{path:"/agregarUsuario",element:e.jsx(Q,{allowedRoles:["admin"],children:e.jsx(ma,{})})}),e.jsx(H,{path:"/agregarProducto",element:e.jsx(Q,{allowedRoles:["admin"],children:e.jsx(xa,{})})}),e.jsx(H,{path:"/dashboard",element:e.jsx(Q,{allowedRoles:["admin"],children:e.jsx(Pa,{})})}),e.jsx(H,{path:"/ventas",element:e.jsx(Q,{allowedRoles:["admin","vendedor"],children:e.jsx(ja,{})})}),e.jsx(H,{path:"/inventario",element:e.jsx(Q,{allowedRoles:["admin"],children:e.jsx(pa,{})})}),e.jsx(H,{path:"/devolucion",element:e.jsx(Q,{allowedRoles:["admin","vendedor"],children:e.jsx(ga,{})})}),e.jsx(H,{path:"/historial",element:e.jsx(Q,{allowedRoles:["admin"],children:e.jsx(fa,{})})}),e.jsx(H,{path:"/vendedor/ventas",element:e.jsx(Q,{allowedRoles:["vendedor"],children:e.jsx(ba,{})})}),e.jsx(H,{path:"/unauthorized",element:e.jsx("div",{children:"Unauthorized - You do not have permission to view this page."})})]})}We.createRoot(document.getElementById("root")).render(e.jsx(se.StrictMode,{children:e.jsx(Qe,{children:e.jsx(la,{children:e.jsx(Na,{})})})}));
