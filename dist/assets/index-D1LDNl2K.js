import{r,j as e,a as J}from"./react-C19bOYeD.js";import{c as Se}from"./react-dom-B6cAfCEe.js";import{g as pe,s as Ce,a as ge,c as ye}from"./firebase-BUmFUbXN.js";import{u as Ee,v as we,w as De,x as ke,y as Ue,z as q,A as ee,B as Pe,D as X,G as O,H as ae,I as re,J as Ve,K as Ie,M as ie}from"./@firebase-BRBhfzOt.js";import{L as w,B as Ae}from"./react-router-dom-CQfWTQT8.js";import{a as se,d as Te,e as z,f as te}from"./react-router-CWVnewOA.js";import{F,f as fe,a as ve,b as oe,c as ne,d as Ne}from"./@fortawesome-BCjTDQda.js";import{D as be,L as Be,A as Le,a as Me,T as Fe,b as de,P as le,c as ue,d as he,e as G,f as B,g as me,B as xe,h as Re,i as $e,j as ze}from"./@mui-9jLk0reR.js";import{u as Z,w as qe}from"./xlsx-YQvpTstd.js";import{F as Oe}from"./file-saver-B4NxL30t.js";import{f as He}from"./date-fns-CmnyAEmm.js";import"./@babel-CofPut0i.js";import"./scheduler-CzFDRTuY.js";import"./tslib-BGVaTf34.js";import"./safevalues-NrgD-8pg.js";import"./idb-Bn1DMRyg.js";import"./@remix-run-BFLWy9pZ.js";import"./prop-types-BID6yDJc.js";import"./react-is-DcfIKM1A.js";import"./clsx-B-dksMZM.js";import"./@emotion-BDfX-Yts.js";import"./hoist-non-react-statics-DQogQWOa.js";import"./stylis-FDnFs_-n.js";import"./react-transition-group-ZnchF7vC.js";import"./dom-helpers-D0mFdbeO.js";import"./@popperjs-BQBsAJpH.js";(function(){const h=document.createElement("link").relList;if(h&&h.supports&&h.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))p(n);new MutationObserver(n=>{for(const d of n)if(d.type==="childList")for(const m of d.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&p(m)}).observe(document,{childList:!0,subtree:!0});function P(n){const d={};return n.integrity&&(d.integrity=n.integrity),n.referrerPolicy&&(d.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?d.credentials="include":n.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function p(n){if(n.ep)return;n.ep=!0;const d=P(n);fetch(n.href,d)}})();const _e={apiKey:"AIzaSyAP7Af1h_-zBmBfL_A5K2uuJsJDFuOel0c",authDomain:"local-js-d7712.firebaseapp.com",projectId:"local-js-d7712",storageBucket:"local-js-d7712.appspot.com",messagingSenderId:"200538761653",appId:"1:200538761653:web:571a969ac8a572328451fc",measurementId:"G-XXD5WT5TV1"},Y=Ee(_e),_=pe(Y),I=we(Y);De(Y);ke(Y);Ue(Y);const Q=r.createContext();function We({children:g}){const[h,P]=r.useState(null),[p,n]=r.useState(null);r.useEffect(()=>{const b=_.onAuthStateChanged(async C=>{if(C){P(C);const v=q(I,"users",C.uid),f=await ee(v);f.exists()?n(f.data().rolUsuario):n(null)}else P(null),n(null)});return()=>b()},[]);const d=async(b,C)=>{try{const v=await Ce(_,b,C);P(v.user);const f=q(I,"users",v.user.uid),U=await ee(f);U.exists()?n(U.data().rolUsuario):n(null)}catch(v){throw console.error("Error signing in:",v),v}},m=async()=>{try{await ge(_),P(null),n(null)}catch(b){throw console.error("Error signing out:",b),b}};return e.jsx(Q.Provider,{value:{user:h,role:p,signIn:d,signOut:m},children:g})}function ce(){return r.useContext(Q)}function Ke(){const[g,h]=r.useState(""),[P,p]=r.useState(""),[n,d]=r.useState(""),m=se(),{signIn:b,role:C}=ce(),v=async f=>{f.preventDefault(),d("");try{await b(g,P)}catch(U){d("Usuario o contraseña incorrectos"),console.error("Error al iniciar sesión:",U)}};return r.useEffect(()=>{C&&(C==="admin"?m("/ventas"):C==="vendedor"?m("/vendedor/ventas"):d("Rol de usuario no reconocido"))},[C,m]),e.jsx("div",{children:e.jsx("div",{className:"login-box",children:e.jsxs("form",{className:"form",onSubmit:v,children:[e.jsxs("p",{className:"form-title",children:["Los Tios ",e.jsx("br",{}),"Iniciar Sesión"]}),e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"email",placeholder:"Email",value:g,onChange:f=>h(f.target.value),required:!0})}),e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"password",placeholder:"Contraseña",value:P,onChange:f=>p(f.target.value),required:!0})}),n&&e.jsx("p",{className:"signup-link",children:n}),e.jsx("button",{type:"submit",className:"submit",children:"Ingresar"}),e.jsxs("p",{className:"signup-link",children:["No tienes una cuenta? ",e.jsx("br",{}),e.jsx(w,{to:"/agregarUsuario",children:"Regístrate aquí"})]})]})})})}const W=()=>{const g=se(),[h,P]=J.useState(!1),p=async()=>{const m=pe();try{await ge(m),localStorage.removeItem("token"),g("/")}catch(b){console.error("Error al cerrar sesión:",b)}},n=()=>{P(!h)},d=()=>{P(!1)};return J.useEffect(()=>{const m=()=>{window.innerWidth>=800&&d()};return window.addEventListener("resize",m),()=>{window.removeEventListener("resize",m)}},[]),e.jsxs("nav",{className:"navbar",children:[e.jsxs("ul",{className:`sidebar ${h?"visible":""}`,children:[e.jsx("li",{onClick:d,children:e.jsx(w,{className:"menu",to:"#",children:e.jsx(F,{icon:fe})})}),e.jsx("li",{children:e.jsx(w,{className:"link",to:"/ventas",children:"Venta"})}),e.jsx("li",{children:e.jsx(w,{className:"link",to:"/agregarProducto",children:"Agregar Producto"})}),e.jsx("li",{children:e.jsx(w,{className:"link",to:"/agregarUsuario",children:"Agregar Usuario"})}),e.jsx("li",{children:e.jsx(w,{className:"link",to:"/inventario",children:"Inventario"})}),e.jsx("li",{children:e.jsx(w,{className:"link",to:"/devolucion",children:"Devolución"})}),e.jsx("li",{children:e.jsx(w,{className:"link",to:"/historial",children:"Historial"})}),e.jsx("li",{children:e.jsx(w,{className:"link",onClick:p,children:"Cerrar Sesión"})})]}),e.jsxs("ul",{children:[e.jsx("li",{className:"Mobile",children:e.jsx(w,{className:"link",to:"/ventas",children:"Venta"})}),e.jsx("li",{className:"Mobile",children:e.jsx(w,{className:"link",to:"/agregarProducto",children:"Agregar Producto"})}),e.jsx("li",{className:"Mobile",children:e.jsx(w,{className:"link",to:"/agregarUsuario",children:"Agregar Usuario"})}),e.jsx("li",{className:"Mobile",children:e.jsx(w,{className:"link",to:"/inventario",children:"Inventario"})}),e.jsx("li",{className:"Mobile",children:e.jsx(w,{className:"link",to:"/devolucion",children:"Devolución"})}),e.jsx("li",{className:"Mobile",children:e.jsx(w,{className:"link",to:"/historial",children:"Historial"})}),e.jsx("li",{className:"Mobile",children:e.jsx(w,{className:"link",onClick:p,children:"Cerrar Sesión"})}),e.jsx("li",{onClick:n,children:e.jsx(w,{className:"menu",to:"#",children:e.jsx(F,{icon:ve})})})]})]})},Je=()=>{const[g,h]=r.useState(""),[P,p]=r.useState(""),[n,d]=r.useState(""),[m,b]=r.useState("vendedor"),[C,v]=r.useState(""),[f,U]=r.useState(""),S=async k=>{k.preventDefault(),console.log("Nombre de Usuario:",g),console.log("Email:",P),console.log("Contraseña:",n),console.log("Rol:",m);try{const E=(await ye(_,P,n)).user;console.log("Usuario creado:",E),await Pe(q(I,"users",E.uid),{nombreUsuario:g,emailUsuario:P,rolUsuario:m}),U("Usuario registrado exitosamente"),h(""),p(""),d(""),b("vendedor")}catch(A){console.error("Error al registrar el usuario:",A),A.code==="auth/email-already-in-use"?v("El correo electrónico ya está en uso. Por favor, use otro."):A.code==="permission-denied"?v("Permiso denegado. Verifica las reglas de seguridad."):v("Error al registrar el usuario")}};return e.jsxs("div",{children:[e.jsx("div",{className:"nav",children:e.jsx(W,{})}),e.jsxs("div",{className:"login-box",children:[e.jsx("p",{className:"form-title",children:"Registrar Usuario"}),e.jsxs("form",{className:"form",onSubmit:S,children:[e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"text",placeholder:"Nombre de Usuario",value:g,onChange:k=>h(k.target.value),required:!0})}),e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"email",placeholder:"Email",value:P,onChange:k=>p(k.target.value),required:!0})}),e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"password",placeholder:"Contraseña",value:n,onChange:k=>d(k.target.value),required:!0})}),e.jsx("div",{className:"input-container",children:e.jsxs("select",{value:m,onChange:k=>b(k.target.value),required:!0,children:[e.jsx("option",{value:"vendedor",children:"Vendedor"}),e.jsx("option",{value:"admin",children:"Administrador"})]})}),C&&e.jsx("p",{className:"signup-link",children:C}),f&&e.jsx("p",{className:"signup-link",children:f}),e.jsx("button",{className:"submit",type:"submit",children:"Registrar Usuario"})]})]})]})},Xe=()=>{const[g,h]=r.useState(""),[P,p]=r.useState(""),[n,d]=r.useState(""),[m,b]=r.useState(""),[C,v]=r.useState(""),[f,U]=r.useState(""),[S,k]=r.useState(""),[A,E]=r.useState(""),T=async()=>{try{const N=q(I,"productos",g);return(await ee(N)).exists()}catch(N){return console.error("Error checking product existence:",N),k("Error al verificar la existencia del producto"),!1}},V=async N=>{if(N.preventDefault(),await T()){k("El producto ya está registrado");return}try{const M=q(I,"productos",g);await Pe(M,{idProducto:g,nombreProducto:P,precioProducto:n,categoriaProducto:m,marcaProducto:C,cantidadProducto:f}),E("Producto registrado exitosamente"),h(""),p(""),d(""),b(""),v(""),U(""),k("")}catch(M){k("Hubo un error al registrar el producto"),console.error("Error al registrar el producto:",M)}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"nav",children:e.jsx(W,{})}),e.jsx("div",{children:e.jsxs("div",{className:"productos-box",children:[e.jsx("p",{className:"form-title",children:"Ingresar Producto"}),e.jsxs("form",{className:"form-producto",onSubmit:V,children:[e.jsxs("div",{className:"detalle",children:[e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Código Producto"}),e.jsx("input",{type:"text",placeholder:"Id Producto",value:g,onChange:N=>h(N.target.value),required:!0})]}),e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Nombre producto"}),e.jsx("input",{type:"text",placeholder:"Nombre Producto",value:P,onChange:N=>p(N.target.value),required:!0})]}),e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Precio Producto"}),e.jsx("input",{type:"text",placeholder:"Precio Producto",value:n,onChange:N=>d(N.target.value),required:!0})]}),e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Categoria Producto"}),e.jsx("input",{type:"text",placeholder:"Categoria Producto",value:m,onChange:N=>b(N.target.value),required:!0})]}),e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Marca Producto"}),e.jsx("input",{type:"text",placeholder:"Marca Producto",value:C,onChange:N=>v(N.target.value),required:!0})]}),e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Cantidad Producto"}),e.jsx("input",{type:"text",placeholder:"Cantidad Producto",value:f,onChange:N=>U(N.target.value),required:!0})]})]}),S&&e.jsx("p",{className:"form-title",children:S}),A&&e.jsx("p",{className:"form-title",children:A}),e.jsx("button",{className:"submit",type:"submit",children:"Agregar Producto"})]})]})})]})},Ye=()=>{const{currentUser:g}=r.useContext(Q),[h,P]=r.useState([]),[p,n]=r.useState(""),[d,m]=r.useState([]),[b,C]=r.useState(!0),[v,f]=r.useState("efectivo"),[U,S]=r.useState(0),[k,A]=r.useState(0),[E,T]=r.useState(""),[V,N]=r.useState(1);r.useEffect(()=>{(async()=>{try{const o=(await X(O(I,"productos"))).docs.map(j=>({id:j.id,...j.data()}));P(o)}catch(s){n("Error al obtener los productos"),console.error("Error al obtener los productos:",s)}finally{C(!1)}})()},[g]),r.useEffect(()=>{if(E.length>0){const a=h.find(s=>String(s.id)===E);a?(M(a,V),T(""),N(1)):(n("Producto no encontrado."),setTimeout(()=>{n(""),T(""),N(1)},3e3))}},[E,h,V]);const $=a=>{T(a.target.value)},M=(a,s)=>{m(o=>{const j=o.find(u=>u.id===a.id);return j?j.cantidad+s<=a.cantidadProducto?o.map(u=>u.id===a.id?{...u,cantidad:u.cantidad+s}:u):(alert("Stock insuficiente"),o):a.cantidadProducto>=s?[...o,{...a,cantidad:s}]:(alert("Stock insuficiente"),o)})},R=a=>{m(s=>{var u;const o=s.find(l=>l.id===a),j=(u=h.find(l=>l.id===a))==null?void 0:u.cantidadProducto;return o&&j>o.cantidad?s.map(l=>l.id===a?{...l,cantidad:l.cantidad+1}:l):(alert("Stock insuficiente"),s)})},x=a=>{m(s=>s.map(o=>o.id===a?{...o,cantidad:Math.max(1,o.cantidad-1)}:o))},t=a=>{m(s=>s.filter(o=>o.id!==a))},i=a=>{f(a.target.value),a.target.value==="efectivo"&&(S(0),A(0))},c=a=>{const s=parseFloat(a.target.value);S(s);const o=d.reduce((j,u)=>j+u.precioProducto*u.cantidad,0);A(s-o)},D=async a=>{a.preventDefault();const s=new Date,o=d.reduce((l,L)=>l+L.precioProducto*L.cantidad,0),j=d.map(l=>({idProducto:l.id,nombreProducto:l.nombreProducto,marcaProducto:l.marcaProducto,categoriaProducto:l.categoriaProducto,precioProducto:l.precioProducto,cantidad:l.cantidad,cantidadProducto:l.cantidadProducto})),u=_.currentUser;try{await ae(O(I,"sales"),{fechaVenta:s,totalVenta:o,tipoPago:v,idUsuario:u.uid,productos:j});const l=re(I);d.forEach(L=>{const K=q(I,"productos",L.id);l.update(K,{cantidadProducto:L.cantidadProducto-L.cantidad})}),await l.commit(),m([]),alert("Venta registrada con éxito")}catch(l){n("Error al registrar la venta"),console.error("Error al registrar la venta:",l)}},y=a=>`${a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}`;return b?e.jsxs("div",{children:[e.jsx(W,{}),e.jsx("h1",{children:"Cargando productos..."})]}):e.jsxs("div",{children:[e.jsx("div",{className:"nav",children:e.jsx(W,{})}),e.jsx("main",{className:"main1",children:e.jsxs("div",{className:"carrito-label",children:[e.jsx("p",{className:"form-title",children:"Carrito de compras"}),e.jsx("hr",{}),e.jsxs("div",{className:"encabezado",children:[e.jsx("input",{className:"carrito-input",type:"text",placeholder:"Buscar producto por ID...",value:E,onChange:$,onBlur:()=>{if(E.length>0){const a=h.find(s=>String(s.id)===E);a?(M(a),T("")):n("Producto no encontrado.")}}}),e.jsx("input",{className:"carrito-input",type:"number",placeholder:"Cantidad...",value:V,min:"1",onChange:a=>{const s=parseInt(a.target.value);N(s<1?1:s)}})]}),p&&e.jsx("p",{className:"error",children:p}),e.jsx("section",{className:"tabla-ventas",children:e.jsxs("table",{className:"carrito-tabla",children:[e.jsx("thead",{className:"carrito-th",children:e.jsxs("tr",{className:"carrito-tr",children:[e.jsx("th",{className:"carrito-th",children:"Producto"}),e.jsx("th",{className:"carrito-th",children:"Precio"}),e.jsx("th",{className:"carrito-th",children:"Cantidad"}),e.jsx("th",{className:"carrito-th",children:"Total"}),e.jsx("th",{className:"carrito-th",children:"Acciones"})]})}),e.jsx("tbody",{className:"carrito-items",children:d.map(a=>e.jsxs("tr",{className:"carrito-tr",children:[e.jsx("td",{className:"carrito-td",children:e.jsx("p",{className:"txt-carrito",children:a.nombreProducto})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["$",y(a.precioProducto)]})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:[e.jsx("button",{className:"boton-resta",onClick:()=>x(a.idProducto),children:e.jsx(F,{icon:oe})}),a.cantidad,e.jsx("button",{className:"boton-suma",onClick:()=>R(a.idProducto),children:e.jsx(F,{icon:ne})})]})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["$",y(a.precioProducto*a.cantidad)]})}),e.jsx("td",{className:"carrito-td",children:e.jsx("button",{className:"boton-eliminar",onClick:()=>t(a.idProducto),children:e.jsx(F,{icon:Ne})})})]},a.idProducto))})]})}),e.jsxs("div",{className:"pago",children:[e.jsx("label",{htmlFor:"tipoPago",children:"Tipo de pago:"}),e.jsxs("select",{id:"tipoPago",value:v,onChange:i,className:"carrito-input",children:[e.jsx("option",{value:"efectivo",children:"Efectivo"}),e.jsx("option",{value:"tarjeta",children:"Tarjeta"})]}),v==="efectivo"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"cantidadEntregada",children:"Cantidad entregada:"}),e.jsx("input",{id:"cantidadEntregada",type:"number",value:U,onChange:c,className:"carrito-input"}),e.jsxs("p",{className:"textp",children:["Vuelto: $",y(k)]})]})]}),e.jsx("button",{className:"boton-venta",onClick:D,children:e.jsx("span",{children:"Finalizar Venta"})})]})})]})},Ge=()=>{const[g,h]=r.useState([]),[P,p]=r.useState(""),[n,d]=r.useState([]),[m,b]=r.useState(!0),[C,v]=r.useState(!1),[f,U]=r.useState(null),[S,k]=r.useState({idProducto:"",nombreProducto:"",precioProducto:"",categoriaProducto:"",marcaProducto:"",cantidadProducto:""});r.useEffect(()=>{(async()=>{try{const i=(await X(O(I,"productos"))).docs.map(c=>({idProducto:c.id,...c.data()}));h(i),d(i)}catch{p("Error al cargar los productos. Intente más tarde.")}finally{b(!1)}})()},[]);const A=x=>{const t=x.target.value.toLowerCase();if(t==="")d(g);else{const i=g.filter(c=>{const D=String(c.idProducto).toLowerCase(),y=String(c.nombreProducto).toLowerCase(),a=String(c.precioProducto).toLowerCase(),s=String(c.categoriaProducto).toLowerCase(),o=String(c.marcaProducto).toLowerCase(),j=String(c.cantidadProducto).toLowerCase();return D.includes(t)||y.includes(t)||a.includes(t)||s.includes(t)||o.includes(t)||j.includes(t)});d(i)}},E=x=>`${x.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}`,T=x=>{U(x),k({idProducto:x.idProducto,nombreProducto:x.nombreProducto,precioProducto:x.precioProducto,categoriaProducto:x.categoriaProducto,marcaProducto:x.marcaProducto,cantidadProducto:x.cantidadProducto}),v(!0)},V=x=>{const{name:t,value:i}=x.target;k({...S,[t]:i})},N=()=>{v(!1),U(null)},$=async x=>{x.preventDefault();try{const t=q(I,"productos",S.idProducto);await Ve(t,{nombreProducto:S.nombreProducto,precioProducto:Number(S.precioProducto),categoriaProducto:S.categoriaProducto,marcaProducto:S.marcaProducto,cantidadProducto:Number(S.cantidadProducto)}),h(i=>i.map(c=>c.idProducto===f.idProducto?{...c,...S}:c)),d(i=>i.map(c=>c.idProducto===f.idProducto?{...c,...S}:c)),N()}catch(t){console.error("Error al actualizar el producto:",t)}},M=n.reduce((x,t)=>x+t.cantidadProducto,0),R=n.reduce((x,t)=>x+t.precioProducto*t.cantidadProducto,0);return m?e.jsx("p",{children:"Cargando productos..."}):P?e.jsx("p",{children:P}):e.jsxs("div",{children:[e.jsx("div",{className:"nav",children:e.jsx(W,{})}),e.jsxs("div",{className:"body-tabla",children:[e.jsxs("main",{className:"table",children:[e.jsxs("section",{className:"table-header",children:[e.jsxs("p",{className:"form-title",children:["Total del Inventario: $",E(R)]}),e.jsxs("p",{className:"form-title",children:["Total de productos: ",M]}),e.jsx("input",{className:"buscar",type:"text",placeholder:"Buscar producto",onChange:A})]}),e.jsx("section",{className:"table-body",children:e.jsxs("table",{className:"tabla-inventario",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Codigo"}),e.jsx("th",{children:"Nombre"}),e.jsx("th",{children:"Precio"}),e.jsx("th",{children:"Categoria"}),e.jsx("th",{children:"Marca"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:n.length>0?n.map(x=>e.jsxs("tr",{children:[e.jsx("td",{children:x.idProducto}),e.jsx("td",{children:x.nombreProducto}),e.jsx("td",{children:E(x.precioProducto)}),e.jsx("td",{children:x.categoriaProducto}),e.jsx("td",{children:x.marcaProducto}),e.jsx("td",{children:e.jsx("p",{className:x.cantidadProducto<=5?"cantidad-baja":x.cantidadProducto<=15?"cantidad-media":"cantidad-alta",children:x.cantidadProducto})}),e.jsx("td",{children:e.jsx("button",{className:"btn-editar",onClick:()=>T(x),children:"Editar"})})]},x.idProducto)):e.jsx("tr",{children:e.jsx("td",{colSpan:"7",children:"No hay productos disponibles"})})})]})})]}),e.jsx(be,{open:C,onClose:N,children:f&&e.jsxs("div",{className:"formulario-editar",children:[e.jsx("p",{className:"form-title",children:"Editar Producto "}),e.jsxs("form",{onSubmit:$,children:[e.jsxs("label",{children:["Nombre:",e.jsx("input",{type:"text",name:"nombreProducto",value:S.nombreProducto,onChange:V})]}),e.jsxs("label",{children:["Precio:",e.jsx("input",{type:"number",name:"precioProducto",value:S.precioProducto,onChange:V})]}),e.jsxs("label",{children:["Categoria:",e.jsx("input",{type:"text",name:"categoriaProducto",value:S.categoriaProducto,onChange:V})]}),e.jsxs("label",{children:["Marca:",e.jsx("input",{type:"text",name:"marcaProducto",value:S.marcaProducto,onChange:V})]}),e.jsxs("label",{children:["Cantidad:",e.jsx("input",{type:"number",name:"cantidadProducto",value:S.cantidadProducto,onChange:V})]}),e.jsx("button",{type:"submit",children:"Actualizar Producto"}),e.jsx("button",{type:"button",onClick:N,children:"Cancelar"})]})]})})]})]})},Qe=()=>{const[g,h]=r.useState([]),[P,p]=r.useState(""),[n,d]=r.useState([]),[m,b]=r.useState(!0);r.useState("efectivo");const[C,v]=r.useState(""),[f,U]=r.useState(1),[S,k]=r.useState(!1),[A,E]=r.useState(!1);r.useEffect(()=>{let t=!0;return(async()=>{try{const c=O(I,"productos"),y=(await X(c)).docs.map(a=>({id:a.id,...a.data()}));t&&h(y)}catch(c){p("Error al obtener los productos"),console.error("Error al obtener los productos:",c)}finally{t&&b(!1)}})(),()=>{t=!1}},[]),r.useEffect(()=>{if(C.length>0){const t=g.find(i=>String(i.idProducto)===C);t?(S?N(t,f):V(t,f),v(""),U(1)):(p("Producto no encontrado."),setTimeout(()=>{p(""),v(""),U(1)},3e3))}},[C,g,f,S]);const T=t=>{v(t.target.value)},V=(t,i)=>{d(c=>c.find(y=>y.idProducto===t.idProducto)?c.map(y=>y.idProducto===t.idProducto?{...y,cantidad:y.cantidad+i}:y):[...c,{...t,cantidad:i}])},N=(t,i)=>{d(c=>c.find(y=>y.idProducto===t.idProducto)?c.map(y=>y.idProducto===t.idProducto?{...y,cantidad:y.cantidad+i}:y):[...c,{...t,cantidad:i}])},$=t=>{d(i=>i.map(c=>c.idProducto===t?{...c,cantidad:c.cantidad+1}:c))},M=t=>{d(i=>i.map(c=>c.idProducto===t?{...c,cantidad:Math.max(1,c.cantidad-1)}:c))},R=async t=>{t.preventDefault(),E(!0);const i=new Date,c=_.currentUser;try{const D=n.reduce((o,j)=>o+j.precioProducto*j.cantidad,0),y=n.map(o=>({idProducto:o.idProducto,nombreProducto:o.nombreProducto,marcaProducto:o.marcaProducto,categoriaProducto:o.categoriaProducto,precioProducto:o.precioProducto,cantidad:o.cantidad})),a=c?c.uid:"";await ae(O(I,"sales"),{fechaVenta:i,totalVenta:-D,idUsuario:a,productos:y});const s=re(I);n.forEach(o=>{const j=q(I,"productos",o.idProducto),u=o.cantidadProducto+o.cantidad;s.update(j,{cantidadProducto:u})}),await s.commit(),d([]),v(""),U(1),E(!1),alert("Operación realizada con éxito")}catch(D){p("Error al registrar la operación"),console.error("Error al registrar la operación:",D),E(!1)}},x=t=>`${t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}`;return m?e.jsxs("div",{children:[e.jsx(W,{}),e.jsx("h1",{children:"Cargando productos..."})]}):e.jsxs("div",{children:[e.jsx(W,{}),e.jsx("main",{className:"main1",children:e.jsxs("div",{className:"carrito-label",children:[e.jsx("p",{className:"form-title",children:"Devolución"}),e.jsx("hr",{}),e.jsxs("div",{className:"encabezado",children:[e.jsx("input",{className:"carrito-input",type:"text",placeholder:"Buscar producto por ID...",value:C,onChange:T,onBlur:()=>{if(C.length>0){const t=g.find(i=>String(i.idProducto)===C);t?(S?N(t,f):V(t,f),v("")):p("Producto no encontrado.")}}}),e.jsx("input",{className:"carrito-input",type:"number",placeholder:"Cantidad...",value:f,min:"1",onChange:t=>{const i=parseInt(t.target.value,10);U(i<1?1:i)}})]}),e.jsxs("table",{className:"carrito-tabla",children:[e.jsx("thead",{className:"carrito-th",children:e.jsxs("tr",{className:"carrito-tr",children:[e.jsx("th",{className:"carrito-th",children:"Producto"}),e.jsx("th",{className:"carrito-th",children:"Precio"}),e.jsx("th",{className:"carrito-th",children:"Cantidad"}),e.jsx("th",{className:"carrito-th",children:"Total"})]})}),e.jsx("tbody",{className:"carrito-items",children:n.map(t=>e.jsxs("tr",{className:"carrito-tr",children:[e.jsx("td",{className:"carrito-td",children:e.jsx("p",{className:"txt-carrito",children:t.nombreProducto})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["-$",x(t.precioProducto)]})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:[e.jsx("button",{className:"boton-resta",onClick:()=>M(t.idProducto),children:e.jsx(F,{icon:oe})}),e.jsx("span",{className:"spanCarrito",children:t.cantidad}),e.jsx("button",{className:"boton-suma",onClick:()=>$(t.idProducto),children:e.jsx(F,{icon:ne})})]})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["-$",x(t.precioProducto*t.cantidad)]})})]},t.idProducto))})]}),e.jsx("div",{className:"venta-label",children:e.jsx("div",{className:"totalcarro",children:e.jsxs("p",{className:"textp",children:["Total a Devolver: -$",x(n.reduce((t,i)=>t+i.cantidad*i.precioProducto,0))]})})}),e.jsx("div",{className:"bottom-container",children:e.jsx("button",{className:"boton-venta",onClick:R,disabled:n.length===0,children:e.jsx("span",{children:"Devolución"})})})]})})]})},je=g=>{const h=new Date(g.toDate());return He(h,"dd/MM/yyyy")},Ze=()=>{const[g,h]=r.useState([]),[P,p]=r.useState(""),[n,d]=r.useState(!0),[m,b]=r.useState(!1),[C,v]=r.useState([]),[f,U]=r.useState(new Date),[S,k]=r.useState("todos");r.useEffect(()=>{(async()=>{d(!0),p("");try{const i=O(I,"sales"),c=new Date(f);c.setHours(0,0,0,0);const D=new Date(c);D.setDate(D.getDate()+1);const y=Ie(i,ie("createdAt",">=",c),ie("createdAt","<",D)),a=await X(y);if(a.empty){p("No hay ventas para la fecha seleccionada."),h([]);return}const s=a.docs.map(j=>j.data());console.log("salesData",s);const o=s.reduce((j,u)=>{var L,K;const l=u.idVenta;return j[l]||(j[l]={idVenta:l,fechaVenta:u.createdAt,idUsers:((L=u.Sale.User)==null?void 0:L.idUsuario)||"N/A",tipoPago:u.Sale.tipoPago||"N/A",User:{nombre:((K=u.Sale.User)==null?void 0:K.nombreUsuario)||"N/A"},Products:[],totalVenta:0}),u.Product&&(j[l].Products.push({idProducto:u.Product.idProducto,nombre:u.Product.nombreProducto,cantidad:u.cantidad,precio:u.Product.precioProducto||0}),j[l].totalVenta+=u.cantidad*(u.Product.precioProducto||0)),j},{});h(Object.values(o))}catch(i){p("Error al obtener las ventas."),console.error("Error al obtener las ventas:",i)}finally{d(!1)}})()},[f]);const A=t=>{switch(t){case"efectivo":return"Efectivo";case"tarjeta":return"Tarjeta";default:return t}},E=t=>{v(t),b(!0)},T=()=>{b(!1)},V=t=>`${t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}`,N=()=>{const t=Z.book_new();g.forEach((D,y)=>{var s;const a=[];a.push(["Id Venta","Fecha","Nombre Usuario","Id Producto","Nombre Producto","Cantidad","Precio","Total Venta"]),a.push([D.idVenta,je(D.fechaVenta),((s=D.User)==null?void 0:s.nombre)||"N/A","","","",""]),D.Products.forEach(o=>{a.push(["","","",o.idProducto,o.nombre,o.cantidad,o.precio,""])}),Z.book_append_sheet(t,Z.aoa_to_sheet(a),`Venta_${y+1}`)});const i=qe(t,{bookType:"xlsx",type:"array"}),c=new Blob([i],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});Oe.saveAs(c,"historial_ventas.xlsx")},R=((t,i)=>i==="todos"?t:t.filter(c=>c.tipoPago===i))(((t,i)=>t.filter(c=>{const D=new Date(c.fechaVenta.toDate());return D.getFullYear()===i.getFullYear()&&D.getMonth()===i.getMonth()&&D.getDate()===i.getDate()}))(g,f),S),x=R.reduce((t,i)=>t+i.totalVenta,0);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"nav",children:e.jsx(NavbarAdmin,{})}),e.jsx("div",{className:"body-tabla",children:e.jsxs("main",{className:"table",children:[e.jsxs("section",{className:"table-header",children:[e.jsxs("p",{className:"form-title",children:["Total del día: $",V(x)]}),e.jsx(Be,{dateAdapter:Le,children:e.jsx(Me,{className:"fecha",label:"Selecciona una fecha",value:f,onChange:t=>U(t),renderInput:t=>e.jsx(Fe,{...t,style:{marginBottom:"16px"}})})}),e.jsxs("select",{className:"seleccionar-pago",name:"tipoPago",id:"tipoPago",value:S,onChange:t=>k(t.target.value),children:[e.jsx("option",{value:"todos",children:"Tipo de pago"}),e.jsx("option",{value:"efectivo",children:"Efectivo"}),e.jsx("option",{value:"tarjeta",children:"Tarjeta"})]}),e.jsx("button",{className:"btn-editar",onClick:N,children:"Exportar a Excel"})]}),n?e.jsx("p",{children:"Cargando..."}):P?e.jsx("p",{className:"error-message",children:P}):R.length===0?e.jsx("p",{children:"No hay ventas registradas en esta fecha"}):e.jsx(e.Fragment,{children:e.jsx("section",{className:"table-body",children:e.jsx(de,{component:le,children:e.jsxs(ue,{children:[e.jsx(he,{children:e.jsxs(G,{children:[e.jsx(B,{children:"ID Venta"}),e.jsx(B,{children:"Fecha"}),e.jsx(B,{children:"Nombre Usuario"}),e.jsx(B,{children:"Tipo de Pago"}),e.jsx(B,{children:"Detalles"})]})}),e.jsx(me,{children:R.map(t=>{var i;return e.jsxs(G,{children:[e.jsx(B,{children:t.idVenta}),e.jsx(B,{children:je(t.fechaVenta)}),e.jsx(B,{children:((i=t.User)==null?void 0:i.nombre)||"N/A"}),e.jsx(B,{children:A(t.tipoPago)}),e.jsx(B,{children:e.jsx(xe,{onClick:()=>E(t.Products),children:"Ver detalles"})})]},t.idVenta)})})]})})})})]})}),e.jsxs(be,{open:m,onClose:T,children:[e.jsx(Re,{children:"Detalles de Venta"}),e.jsx($e,{children:e.jsx(de,{component:le,children:e.jsxs(ue,{children:[e.jsx(he,{children:e.jsxs(G,{children:[e.jsx(B,{children:"ID Producto"}),e.jsx(B,{children:"Nombre Producto"}),e.jsx(B,{children:"Cantidad"}),e.jsx(B,{children:"Precio"})]})}),e.jsx(me,{children:C.map(t=>e.jsxs(G,{children:[e.jsx(B,{children:t.idProducto}),e.jsx(B,{children:t.nombre}),e.jsx(B,{children:t.cantidad}),e.jsxs(B,{children:["$",V(t.precio)]})]},t.idProducto))})]})})}),e.jsx(ze,{children:e.jsx(xe,{onClick:T,children:"Cerrar"})})]})]})},et=()=>{const g=se(),[h,P]=J.useState(!1),{signOut:p}=ce(),n=async()=>{try{await p(),g("/")}catch(b){console.error("Error al cerrar sesión:",b)}},d=()=>{P(!h)},m=()=>{P(!1)};return J.useEffect(()=>{const b=()=>{window.innerWidth>=800&&m()};return window.addEventListener("resize",b),()=>{window.removeEventListener("resize",b)}},[]),e.jsxs("nav",{className:"navbar",children:[e.jsxs("ul",{className:`sidebar ${h?"visible":""}`,children:[e.jsx("li",{onClick:m,children:e.jsx(w,{className:"menu",to:"#",children:e.jsx(F,{icon:fe})})}),e.jsx("li",{children:e.jsx(w,{className:"link",to:"/vendedor/ventas",children:"Venta"})}),e.jsx("li",{children:e.jsx(w,{className:"link",to:"/vendedor/inventario",children:"Inventario"})}),e.jsx("li",{children:e.jsx(w,{className:"link",to:"/vendedor/devolucion",children:"Devolución"})}),e.jsx("li",{children:e.jsx(w,{className:"link",onClick:n,children:"Cerrar Sesion"})})]}),e.jsxs("ul",{children:[e.jsx("li",{className:"Mobile",children:e.jsx(w,{className:"link",to:"/vendedor/inventario",children:"Inventario"})}),e.jsx("li",{className:"Mobile",children:e.jsx(w,{className:"link",to:"/vendedor/ventas",children:"Venta"})}),e.jsx("li",{className:"Mobile",children:e.jsx(w,{className:"link",to:"/vendedor/devolucion",children:"Devolución"})}),e.jsx("li",{className:"Mobile",children:e.jsx(w,{className:"link",onClick:n,children:"Cerrar Sesion"})}),e.jsx("li",{onClick:d,children:e.jsx(w,{className:"menu",to:"#",children:e.jsx(F,{icon:ve})})})]})]})},tt=()=>{const{currentUser:g}=r.useContext(Q),[h,P]=r.useState([]),[p,n]=r.useState(""),[d,m]=r.useState([]),[b,C]=r.useState(!0),[v,f]=r.useState("efectivo"),[U,S]=r.useState(0),[k,A]=r.useState(0),[E,T]=r.useState(""),[V,N]=r.useState(1);r.useEffect(()=>{(async()=>{try{const o=(await X(O(I,"productos"))).docs.map(j=>({id:j.id,...j.data()}));P(o)}catch(s){n("Error al obtener los productos"),console.error("Error al obtener los productos:",s)}finally{C(!1)}})()},[g]),r.useEffect(()=>{if(E.length>0){const a=h.find(s=>String(s.id)===E);a?(M(a,V),T(""),N(1)):(n("Producto no encontrado."),setTimeout(()=>{n(""),T(""),N(1)},3e3))}},[E,h,V]);const $=a=>{T(a.target.value)},M=(a,s)=>{m(o=>{const j=o.find(u=>u.id===a.id);return j?j.cantidad+s<=a.cantidadProducto?o.map(u=>u.id===a.id?{...u,cantidad:u.cantidad+s}:u):(alert("Stock insuficiente"),o):a.cantidadProducto>=s?[...o,{...a,cantidad:s}]:(alert("Stock insuficiente"),o)})},R=a=>{m(s=>{var u;const o=s.find(l=>l.id===a),j=(u=h.find(l=>l.id===a))==null?void 0:u.cantidadProducto;return o&&j>o.cantidad?s.map(l=>l.id===a?{...l,cantidad:l.cantidad+1}:l):(alert("Stock insuficiente"),s)})},x=a=>{m(s=>s.map(o=>o.id===a?{...o,cantidad:Math.max(1,o.cantidad-1)}:o))},t=a=>{m(s=>s.filter(o=>o.id!==a))},i=a=>{f(a.target.value),a.target.value==="efectivo"&&(S(0),A(0))},c=a=>{const s=parseFloat(a.target.value);S(s);const o=d.reduce((j,u)=>j+u.precioProducto*u.cantidad,0);A(s-o)},D=async a=>{a.preventDefault();const s=new Date,o=d.reduce((l,L)=>l+L.precioProducto*L.cantidad,0),j=d.map(l=>({idProducto:l.id,nombreProducto:l.nombreProducto,marcaProducto:l.marcaProducto,categoriaProducto:l.categoriaProducto,precioProducto:l.precioProducto,cantidad:l.cantidad,cantidadProducto:l.cantidadProducto})),u=_.currentUser;try{await ae(O(I,"sales"),{fechaVenta:s,totalVenta:o,tipoPago:v,idUsuario:u.uid,productos:j});const l=re(I);d.forEach(L=>{const K=q(I,"productos",L.id);l.update(K,{cantidadProducto:L.cantidadProducto-L.cantidad})}),await l.commit(),m([]),alert("Venta registrada con éxito")}catch(l){n("Error al registrar la venta"),console.error("Error al registrar la venta:",l)}},y=a=>`${a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}`;return b?e.jsx("div",{children:e.jsx("h1",{children:"Cargando productos..."})}):e.jsxs("div",{children:[e.jsx("div",{className:"nav",children:e.jsx(et,{})}),e.jsx("main",{className:"main1",children:e.jsxs("div",{className:"carrito-label",children:[e.jsx("p",{className:"form-title",children:"Carrito de compras"}),e.jsx("hr",{}),e.jsxs("div",{className:"encabezado",children:[e.jsx("input",{className:"carrito-input",type:"text",placeholder:"Buscar producto por ID...",value:E,onChange:$,onBlur:()=>{if(E.length>0){const a=h.find(s=>String(s.id)===E);a?(M(a),T("")):n("Producto no encontrado.")}}}),e.jsx("input",{className:"carrito-input",type:"number",placeholder:"Cantidad...",value:V,min:"1",onChange:a=>{const s=parseInt(a.target.value);N(s<1?1:s)}})]}),p&&e.jsx("p",{className:"error",children:p}),e.jsx("section",{className:"tabla-ventas",children:e.jsxs("table",{className:"carrito-tabla",children:[e.jsx("thead",{className:"carrito-th",children:e.jsxs("tr",{className:"carrito-tr",children:[e.jsx("th",{className:"carrito-th",children:"Producto"}),e.jsx("th",{className:"carrito-th",children:"Precio"}),e.jsx("th",{className:"carrito-th",children:"Cantidad"}),e.jsx("th",{className:"carrito-th",children:"Total"}),e.jsx("th",{className:"carrito-th",children:"Acciones"})]})}),e.jsx("tbody",{className:"carrito-items",children:d.map(a=>e.jsxs("tr",{className:"carrito-tr",children:[e.jsx("td",{className:"carrito-td",children:e.jsx("p",{className:"txt-carrito",children:a.nombreProducto})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["$",y(a.precioProducto)]})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:[e.jsx("button",{className:"boton-resta",onClick:()=>x(a.idProducto),children:e.jsx(F,{icon:oe})}),a.cantidad,e.jsx("button",{className:"boton-suma",onClick:()=>R(a.idProducto),children:e.jsx(F,{icon:ne})})]})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["$",y(a.precioProducto*a.cantidad)]})}),e.jsx("td",{className:"carrito-td",children:e.jsx("button",{className:"boton-eliminar",onClick:()=>t(a.idProducto),children:e.jsx(F,{icon:Ne})})})]},a.idProducto))})]})}),e.jsxs("div",{className:"pago",children:[e.jsx("label",{htmlFor:"tipoPago",children:"Tipo de pago:"}),e.jsxs("select",{id:"tipoPago",value:v,onChange:i,className:"carrito-input",children:[e.jsx("option",{value:"efectivo",children:"Efectivo"}),e.jsx("option",{value:"tarjeta",children:"Tarjeta"})]}),v==="efectivo"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"cantidadEntregada",children:"Cantidad entregada:"}),e.jsx("input",{id:"cantidadEntregada",type:"number",value:U,onChange:c,className:"carrito-input"}),e.jsxs("p",{className:"textp",children:["Vuelto: $",y(k)]})]})]}),e.jsx("button",{className:"boton-venta",onClick:D,children:e.jsx("span",{children:"Finalizar Venta"})})]})})]})};function H({children:g,allowedRoles:h}){const{user:P,role:p}=ce();return P?h&&!h.includes(p)?e.jsx(te,{to:"/unauthorized"}):g:e.jsx(te,{to:"/login"})}function at(){return e.jsxs(Te,{children:[e.jsx(z,{path:"/",element:e.jsx(te,{to:"/login"})}),e.jsx(z,{path:"/login",element:e.jsx(Ke,{})}),e.jsx(z,{path:"/agregarUsuario",element:e.jsx(H,{allowedRoles:["admin"],children:e.jsx(Je,{})})}),e.jsx(z,{path:"/agregarProducto",element:e.jsx(H,{allowedRoles:["admin"],children:e.jsx(Xe,{})})}),e.jsx(z,{path:"/ventas",element:e.jsx(H,{allowedRoles:["admin","vendedor"],children:e.jsx(Ye,{})})}),e.jsx(z,{path:"/inventario",element:e.jsx(H,{allowedRoles:["admin"],children:e.jsx(Ge,{})})}),e.jsx(z,{path:"/devolucion",element:e.jsx(H,{allowedRoles:["admin","vendedor"],children:e.jsx(Qe,{})})}),e.jsx(z,{path:"/historial",element:e.jsx(H,{allowedRoles:["admin"],children:e.jsx(Ze,{})})}),e.jsx(z,{path:"/vendedor/ventas",element:e.jsx(H,{allowedRoles:["vendedor"],children:e.jsx(tt,{})})}),e.jsx(z,{path:"/unauthorized",element:e.jsx("div",{children:"Unauthorized - You do not have permission to view this page."})})]})}Se.createRoot(document.getElementById("root")).render(e.jsx(J.StrictMode,{children:e.jsx(Ae,{children:e.jsx(We,{children:e.jsx(at,{})})})}));
