import{r as t,j as e,a as oe}from"./react-MB1aJdB0.js";import{c as We}from"./react-dom-babtui9j.js";import{g as Ie,s as He,a as Be,b as Ke,c as Me}from"./firebase-CB8Mk9P8.js";import{u as Je,v as Xe,w as Ze,x as _e,y as Ye,z as K,A as ge,B as be,D as Z,G as J,H as Ne,I as Se,J as $e,K as Fe}from"./@firebase-D0UA0DlC.js";import{L as T,B as Qe}from"./react-router-dom-BP5qz8hL.js";import{a as ne,b as ea,d as aa,e as H,f as fe}from"./react-router-BDFDsiw1.js";import{F as W,f as Le,a as Ae,b as Ce,c as ye,d as Ee,e as ta}from"./@fortawesome-Bn1EZEDH.js";import{D as ce,L as Re,A as qe,a as ze,T as Pe,F as ke,I as Ve,S as Ue,M as ae,B as X,b as ra,P as sa,c as ue,d as he,e as te,f as U,g as me,h as xe,i as je,j as pe}from"./@mui-D6ajMDpQ.js";import{f as ve,t as oa,m as na}from"./date-fns-5tFtsWfW.js";import{P as ia,B as Te}from"./react-chartjs-2-BMTf87bo.js";import"./chart.js-C_W9Dm9B.js";import"./@babel-DdaQcUjw.js";import"./scheduler-CzFDRTuY.js";import"./tslib-BGVaTf34.js";import"./safevalues-NrgD-8pg.js";import"./idb-Bn1DMRyg.js";import"./@remix-run-BFLWy9pZ.js";import"./prop-types-D-iIXjl8.js";import"./react-is-DcfIKM1A.js";import"./clsx-B-dksMZM.js";import"./@emotion-D2LlJvDI.js";import"./hoist-non-react-statics-DQogQWOa.js";import"./stylis-FDnFs_-n.js";import"./react-transition-group-DD9RWrmj.js";import"./dom-helpers-D0mFdbeO.js";import"./@popperjs-BQBsAJpH.js";import"./@kurkle-BZxJdD1U.js";(function(){const p=document.createElement("link").relList;if(p&&p.supports&&p.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))S(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const x of n.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&S(x)}).observe(document,{childList:!0,subtree:!0});function P(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function S(o){if(o.ep)return;o.ep=!0;const n=P(o);fetch(o.href,n)}})();const ca={apiKey:"AIzaSyAP7Af1h_-zBmBfL_A5K2uuJsJDFuOel0c",authDomain:"local-js-d7712.firebaseapp.com",databaseURL:"https://local-js-d7712-default-rtdb.firebaseio.com",projectId:"local-js-d7712",storageBucket:"local-js-d7712.appspot.com",messagingSenderId:"200538761653",appId:"1:200538761653:web:571a969ac8a572328451fc",measurementId:"G-XXD5WT5TV1"},ie=Je(ca),_=Ie(ie),M=Xe(ie);Ze(ie);_e(ie);Ye(ie);const le=t.createContext();function la({children:N}){const[p,P]=t.useState(null),[S,o]=t.useState(null);t.useEffect(()=>{const h=_.onAuthStateChanged(async g=>{if(g){P(g);const v=K(M,"users",g.uid),f=await ge(v);f.exists()?o(f.data().rolUsuario):o(null)}else P(null),o(null)});return()=>h()},[]);const n=async(h,g)=>{try{const v=await He(_,h,g);P(v.user);const f=K(M,"users",v.user.uid),V=await ge(f);V.exists()?o(V.data().rolUsuario):o(null)}catch(v){throw console.error("Error signing in:",v),v}},x=async()=>{try{await Be(_),P(null),o(null)}catch(h){throw console.error("Error signing out:",h),h}};return e.jsx(le.Provider,{value:{user:p,role:S,signIn:n,signOut:x},children:N})}function De(){return t.useContext(le)}function da(){const[N,p]=t.useState(""),[P,S]=t.useState(""),[o,n]=t.useState(""),x=ne(),{signIn:h,role:g}=De(),v=async f=>{f.preventDefault(),n("");try{await h(N,P)}catch(V){n("Usuario o contraseña incorrectos"),console.error("Error al iniciar sesión:",V)}};return t.useEffect(()=>{g&&(g==="admin"?x("/ventas"):g==="vendedor"?x("/vendedor/ventas"):n("Rol de usuario no reconocido"))},[g,x]),e.jsx("div",{children:e.jsx("div",{className:"login-box",children:e.jsxs("form",{className:"form",onSubmit:v,children:[e.jsxs("p",{className:"form-title",children:["Los Tios ",e.jsx("br",{}),"Iniciar Sesión"]}),e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"email",placeholder:"Email",value:N,onChange:f=>p(f.target.value),required:!0})}),e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"password",placeholder:"Contraseña",value:P,onChange:f=>S(f.target.value),required:!0})}),o&&e.jsx("p",{className:"signup-link",children:o}),e.jsx("button",{type:"submit",className:"submit",children:"Ingresar"}),e.jsx("p",{className:"signup-link",children:e.jsx(T,{to:"/resetPassword",className:"resetPassword",children:"Olvidé mi Contraseña"})})]})})})}const ua=()=>{const[N,p]=t.useState(""),[P,S]=t.useState(!1),[o,n]=t.useState(null),x=ne(),h=()=>{Ke(_,N).then(()=>{S(!0),setTimeout(()=>{x("/")},6e3)}).catch(g=>{n("No se pudo enviar el correo electrónico de restablecimiento de contraseña.")})};return e.jsxs("div",{className:"login-box",children:[e.jsxs("p",{className:"form-title",children:["Recuperar",e.jsx("br",{}),"Contraseña"]}),P?e.jsx("p",{children:"Se ha enviado un correo electrónico con instrucciones para restablecer tu contraseña."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"email",placeholder:"Correo Electrónico",value:N,onChange:g=>p(g.target.value),required:!0})}),e.jsx("button",{onClick:h,variant:"outlined",className:"submit",children:"Enviar"})]}),e.jsx("p",{className:"signup-link",children:e.jsx(T,{to:"/login",className:"resetPassword",children:"Iniciar Sesion"})})]})},ha=()=>{const[N,p]=t.useState(""),[P,S]=t.useState(""),[o,n]=t.useState(""),[x,h]=t.useState("vendedor"),[g,v]=t.useState(""),[f,V]=t.useState(""),y=ne(),$=async w=>{w.preventDefault();try{if(o.length<6){v("La contraseña debe tener al menos 6 caracteres.");return}const L=(await Me(_,P,o)).user;await be(K(M,"users",L.uid),{nombreUsuario:N,emailUsuario:P,rolUsuario:x}),V("Usuario registrado exitosamente"),p(""),S(""),n(""),h("vendedor"),y("/dashboard")}catch(C){console.error("Error al registrar el usuario:",C),C.code==="auth/email-already-in-use"?v("El correo electrónico ya está en uso. Por favor, use otro."):C.code==="permission-denied"?v("Permiso denegado. Verifica las reglas de seguridad."):v("Error al registrar el usuario")}};return e.jsx("div",{children:e.jsxs("div",{className:"login-box",children:[e.jsx("p",{className:"form-title",children:"Registrar Usuario"}),e.jsxs("form",{className:"form",onSubmit:$,children:[e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"text",placeholder:"Nombre de Usuario",value:N,onChange:w=>p(w.target.value),required:!0})}),e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"email",placeholder:"Email",value:P,onChange:w=>S(w.target.value),required:!0})}),e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"password",placeholder:"Contraseña",value:o,onChange:w=>n(w.target.value),required:!0})}),e.jsx("div",{className:"input-container",children:e.jsxs("select",{value:x,onChange:w=>h(w.target.value),required:!0,children:[e.jsx("option",{value:"vendedor",children:"Vendedor"}),e.jsx("option",{value:"admin",children:"Administrador"})]})}),g&&e.jsx("p",{className:"error-message",children:g}),f&&e.jsx("p",{className:"success-message",children:f}),e.jsx("button",{className:"submit",type:"submit",children:"Registrar Usuario"})]})]})})},Y=()=>{const N=ne(),p=ea(),[P,S]=oe.useState(!1),o=async()=>{const g=Ie();try{await Be(g),localStorage.removeItem("token"),N("/")}catch(v){console.error("Error al cerrar sesión:",v)}},n=()=>{S(!P)},x=()=>{S(!1)};oe.useEffect(()=>{const g=()=>{window.innerWidth>=800&&x()};return window.addEventListener("resize",g),()=>{window.removeEventListener("resize",g)}},[]);const h=g=>p.pathname===g?"active":"";return e.jsxs("nav",{className:"navbar",children:[e.jsxs("ul",{className:`sidebar ${P?"visible":""}`,children:[e.jsx("li",{onClick:x,children:e.jsx(T,{className:"menu",to:"#",children:e.jsx(W,{icon:Le})})}),e.jsx("li",{children:e.jsx(T,{className:`link ${h("/ventas")}`,to:"/ventas",children:"Venta"})}),e.jsx("li",{children:e.jsx(T,{className:`link ${h("/agregarProducto")}`,to:"/agregarProducto",children:"Agregar Producto"})}),e.jsx("li",{children:e.jsx(T,{className:`link ${h("/agregarUsuario")}`,to:"/agregarUsuario",children:"Agregar Usuario"})}),e.jsx("li",{children:e.jsx(T,{className:`link ${h("/inventario")}`,to:"/inventario",children:"Inventario"})}),e.jsx("li",{children:e.jsx(T,{className:`link ${h("/devolucion")}`,to:"/devolucion",children:"Devolución"})}),e.jsx("li",{children:e.jsx(T,{className:`link ${h("/dashboard")}`,to:"/dashboard",children:"Dashboard"})}),e.jsx("li",{children:e.jsx(T,{className:`link ${h("/historial")}`,to:"/historial",children:"Historial"})}),e.jsx("li",{children:e.jsx(T,{className:"link",onClick:o,children:"Cerrar Sesión"})})]}),e.jsxs("ul",{children:[e.jsx("li",{className:"Mobile",children:e.jsx(T,{className:`link ${h("/dashboard")}`,to:"/dashboard",children:"Dashboard"})}),e.jsx("li",{className:"Mobile",children:e.jsx(T,{className:`link ${h("/agregarProducto")}`,to:"/agregarProducto",children:"Agregar Producto"})}),e.jsx("li",{className:"Mobile",children:e.jsx(T,{className:`link ${h("/agregarUsuario")}`,to:"/agregarUsuario",children:"Agregar Usuario"})}),e.jsx("li",{className:"Mobile",children:e.jsx(T,{className:`link ${h("/devolucion")}`,to:"/devolucion",children:"Devolución"})}),e.jsx("li",{className:"Mobile",children:e.jsx(T,{className:`link ${h("/ventas")}`,to:"/ventas",children:"Venta"})}),e.jsx("li",{className:"Mobile",children:e.jsx(T,{className:`link ${h("/inventario")}`,to:"/inventario",children:"Inventario"})}),e.jsx("li",{className:"Mobile",children:e.jsx(T,{className:`link ${h("/historial")}`,to:"/historial",children:"Historial"})}),e.jsx("li",{className:"Mobile",children:e.jsx(T,{className:"link",onClick:o,children:"Cerrar Sesión"})}),e.jsx("li",{onClick:n,children:e.jsx(T,{className:"menu",to:"#",children:e.jsx(W,{icon:Ae})})})]})]})},ma=()=>{const[N,p]=t.useState(""),[P,S]=t.useState(""),[o,n]=t.useState(""),[x,h]=t.useState("vendedor"),[g,v]=t.useState(""),[f,V]=t.useState(""),y=async $=>{$.preventDefault(),console.log("Nombre de Usuario:",N),console.log("Email:",P),console.log("Contraseña:",o),console.log("Rol:",x);try{const C=(await Me(_,P,o)).user;console.log("Usuario creado:",C),await be(K(M,"users",C.uid),{nombreUsuario:N,emailUsuario:P,rolUsuario:x}),V("Usuario registrado exitosamente"),p(""),S(""),n(""),h("vendedor")}catch(w){console.error("Error al registrar el usuario:",w),w.code==="auth/email-already-in-use"?v("El correo electrónico ya está en uso. Por favor, use otro."):w.code==="permission-denied"?v("Permiso denegado. Verifica las reglas de seguridad."):v("Error al registrar el usuario")}};return e.jsxs("div",{children:[e.jsx("div",{className:"nav",children:e.jsx(Y,{})}),e.jsxs("div",{className:"login-box",children:[e.jsx("p",{className:"form-title",children:"Registrar Usuario"}),e.jsxs("form",{className:"form",onSubmit:y,children:[e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"text",placeholder:"Nombre de Usuario",value:N,onChange:$=>p($.target.value),required:!0})}),e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"email",placeholder:"Email",value:P,onChange:$=>S($.target.value),required:!0})}),e.jsx("div",{className:"input-container",children:e.jsx("input",{type:"password",placeholder:"Contraseña",value:o,onChange:$=>n($.target.value),required:!0})}),e.jsx("div",{className:"input-container",children:e.jsxs("select",{value:x,onChange:$=>h($.target.value),required:!0,children:[e.jsx("option",{value:"vendedor",children:"Vendedor"}),e.jsx("option",{value:"admin",children:"Administrador"})]})}),g&&e.jsx("p",{className:"signup-link",children:g}),f&&e.jsx("p",{className:"signup-link",children:f}),e.jsx("button",{className:"submit",type:"submit",children:"Registrar Usuario"})]})]})]})},xa=()=>{const[N,p]=t.useState(""),[P,S]=t.useState(""),[o,n]=t.useState(""),[x,h]=t.useState(""),[g,v]=t.useState(""),[f,V]=t.useState(""),[y,$]=t.useState(""),[w,C]=t.useState(""),[L,z]=t.useState(""),O=async()=>{try{const I=K(M,"productos",N);return(await ge(I)).exists()}catch(I){return console.error("Error checking product existence:",I),C("Error al verificar la existencia del producto"),!1}},G=async I=>{if(I.preventDefault(),isNaN(o)||isNaN(x)||isNaN(y)){C("Todos los campos de precio y cantidad deben ser números válidos.");return}const R=Number(o),a=Number(x),i=Number(y);if(R<=0||a<0||i<=0){C("Precio Producto y Cantidad Producto deben ser números positivos. Precio Original puede ser 0 o positivo.");return}if(await O()){C("El producto ya está registrado");return}try{const u=K(M,"productos",N);await be(u,{idProducto:N,nombreProducto:P,precioProducto:R,precioOriginal:a,categoriaProducto:g,marcaProducto:f,cantidadProducto:i}),z("Producto registrado exitosamente"),p(""),S(""),n(""),h(""),v(""),V(""),$(""),C("")}catch(u){C("Hubo un error al registrar el producto"),console.error("Error al registrar el producto:",u)}},q=I=>R=>{const a=R.target.value;/^\d*$/.test(a)&&I(a)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"nav",children:e.jsx(Y,{})}),e.jsx("div",{children:e.jsxs("div",{className:"productos-box",children:[e.jsx("p",{className:"form-title",children:"Ingresar Producto"}),e.jsxs("form",{className:"form-producto",onSubmit:G,children:[e.jsxs("div",{className:"detalle",children:[e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Código Producto"}),e.jsx("input",{type:"text",placeholder:"Id Producto",value:N,onChange:I=>p(I.target.value),required:!0})]}),e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Nombre producto"}),e.jsx("input",{type:"text",placeholder:"Nombre Producto",value:P,onChange:I=>S(I.target.value),required:!0})]}),e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Precio Producto"}),e.jsx("input",{type:"number",placeholder:"Precio Producto",value:o,onChange:q(n),min:"0",step:"1",required:!0})]}),e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Precio Original"}),e.jsx("input",{type:"number",placeholder:"Precio Original",value:x,onChange:q(h),min:"0",step:"1"})]}),e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Categoria Producto"}),e.jsx("input",{type:"text",placeholder:"Categoria Producto",value:g,onChange:I=>v(I.target.value)})]}),e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Marca Producto"}),e.jsx("input",{type:"text",placeholder:"Marca Producto",value:f,onChange:I=>V(I.target.value)})]}),e.jsxs("div",{className:"input-producto",children:[e.jsx("p",{children:"Cantidad Producto"}),e.jsx("input",{type:"number",placeholder:"Cantidad Producto",value:y,onChange:q($),min:"1",step:"1",required:!0})]})]}),w&&e.jsx("p",{className:"form-title",children:w}),L&&e.jsx("p",{className:"form-title",children:L}),e.jsx("button",{className:"submit",type:"submit",children:"Agregar Producto"})]})]})})]})},ja=()=>{const{currentUser:N}=t.useContext(le),[p,P]=t.useState([]),[S,o]=t.useState(""),[n,x]=t.useState([]),[h,g]=t.useState(!0),[v,f]=t.useState("efectivo"),[V,y]=t.useState(0),[$,w]=t.useState(0),[C,L]=t.useState(""),[z,O]=t.useState(1),[G,q]=t.useState(!1);t.useEffect(()=>{(async()=>{try{const D=(await Z(J(M,"productos"))).docs.map(k=>({id:k.id,...k.data()}));P(D)}catch(d){o("Error al obtener los productos"),console.error("Error al obtener los productos:",d)}finally{g(!1)}})()},[N]),t.useEffect(()=>{if(C.length>0){const r=p.find(d=>String(d.id)===C);r?(R(r,z),L(""),O(1)):(o("Producto no encontrado."),setTimeout(()=>{o(""),L(""),O(1)},3e3))}},[C,p,z]);const I=r=>{L(r.target.value)},R=(r,d)=>{x(D=>{const k=D.find(s=>s.id===r.id);return k?k.cantidad+d<=r.cantidadProducto?D.map(s=>s.id===r.id?{...s,cantidad:s.cantidad+d}:s):(alert("Stock insuficiente"),D):r.cantidadProducto>=d?[...D,{...r,cantidad:d,precioOriginal:r.precioOriginal,stockDisponible:r.cantidadProducto}]:(alert("Stock insuficiente"),D)})},a=r=>{x(d=>{var s;const D=d.find(m=>m.id===r),k=(s=p.find(m=>m.id===r))==null?void 0:s.cantidadProducto;return D&&k>D.cantidad?d.map(m=>m.id===r?{...m,cantidad:m.cantidad+1}:m):D&&k===0?(alert("El stock del producto es 0"),d):(alert("Stock insuficiente"),d)})},i=r=>{x(d=>d.map(D=>D.id===r?{...D,cantidad:Math.max(1,D.cantidad-1)}:D))},c=r=>{x(d=>d.filter(D=>D.id!==r))},u=r=>{f(r.target.value),r.target.value==="efectivo"&&(y(0),w(0))},E=r=>{const d=parseFloat(r.target.value);y(d);const D=n.reduce((k,s)=>k+s.precioProducto*s.cantidad,0);w(d-D)},l=async r=>{if(r.preventDefault(),n.length===0){alert("No se puede registrar una venta con un carrito vacío.");return}q(!0);const d=new Date,D=n.reduce((m,A)=>m+A.precioProducto*A.cantidad,0),k=n.map(m=>({idProducto:m.id,nombreProducto:m.nombreProducto,marcaProducto:m.marcaProducto,categoriaProducto:m.categoriaProducto,precioProducto:m.precioProducto??0,precioOriginal:m.precioOriginal??0,cantidad:m.cantidad,cantidadProducto:m.cantidadProducto})),s=_.currentUser;try{await Ne(J(M,"sales"),{fechaVenta:d,totalVenta:D,totalGanancia:B,tipoPago:v,idUsuario:s.uid,productos:k});const m=Se(M);n.forEach(A=>{const re=K(M,"productos",A.id);m.update(re,{cantidadProducto:A.cantidadProducto-A.cantidad})}),await m.commit(),x([]),alert("Venta registrada con éxito")}catch(m){o("Error al registrar la venta"),console.error("Error al registrar la venta:",m)}finally{q(!1)}},j=r=>r==null?"0":`${r.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}`,b=n.reduce((r,d)=>r+d.cantidad,0),F=n.reduce((r,d)=>r+d.precioProducto*d.cantidad,0),B=n.reduce((r,d)=>{const D=d.precioProducto??0,k=d.precioOriginal??0,s=k===0?0:(D-k)*d.cantidad;return r+s},0);return h?e.jsxs("div",{children:[e.jsx(Y,{}),e.jsx("h1",{children:"Cargando productos..."})]}):e.jsxs("div",{children:[e.jsx("div",{className:"nav",children:e.jsx(Y,{})}),e.jsx("main",{className:"main1",children:e.jsxs("div",{className:"layout",children:[e.jsx("div",{className:"columna-izquierda",children:e.jsxs("div",{className:"carrito-label",children:[e.jsx("p",{className:"form-title",children:"Carrito de compras"}),e.jsxs("div",{className:"encabezado",children:[e.jsx("input",{className:"carrito-input",type:"text",placeholder:"Buscar producto por ID...",value:C,onChange:I,onBlur:()=>{if(C.length>0){const r=p.find(d=>String(d.id)===C);r?(R(r),L("")):o("Producto no encontrado.")}}}),e.jsx("input",{className:"carrito-input",type:"number",placeholder:"Cantidad...",value:z,min:"1",onChange:r=>{const d=parseInt(r.target.value);O(d<1?1:d)}})]}),e.jsx("label",{className:"textp",htmlFor:"tipoPago",children:"Tipo de pago:"}),e.jsxs("select",{id:"tipoPago",value:v,onChange:u,className:"carrito-input",children:[e.jsx("option",{value:"efectivo",children:"Efectivo"}),e.jsx("option",{value:"tarjeta",children:"Tarjeta"})]}),S&&e.jsx("p",{className:"error",children:S}),e.jsxs("div",{className:"pago",children:[e.jsxs("p",{className:"textp",children:["Total productos: ",b]}),e.jsx("br",{}),e.jsxs("p",{className:"textp",children:["Total ganancia: $",j(B)]})," ",e.jsx("br",{}),e.jsxs("p",{className:"textp",children:["Total monto: $",j(F)]}),v==="efectivo"&&e.jsxs("div",{children:[e.jsx("label",{className:"textp",htmlFor:"cantidadEntregada",children:"Cantidad entregada:"}),e.jsx("input",{id:"cantidadEntregada",type:"number",value:V,onChange:E,className:"carrito-input"}),e.jsxs("p",{className:"textp",children:["Vuelto: $",j($)]})]})]}),e.jsx("button",{className:"boton-venta",onClick:l,disabled:G,children:e.jsx("span",{children:G?"Procesando...":"Finalizar Venta"})})]})}),e.jsx("div",{className:"columna-derecha",children:e.jsx("section",{className:"tabla-ventas",children:e.jsxs("table",{className:"carrito-tabla",children:[e.jsx("thead",{className:"carrito-th",children:e.jsxs("tr",{className:"carrito-tr",children:[e.jsx("th",{className:"carrito-th",children:"Producto"}),e.jsx("th",{className:"carrito-th",children:"Precio"}),e.jsx("th",{className:"carrito-th",children:"Precio Original"})," ",e.jsx("th",{className:"carrito-th",children:"Cantidad"}),e.jsx("th",{className:"carrito-th",children:"Stock"}),e.jsx("th",{className:"carrito-th",children:"Total"}),e.jsx("th",{className:"carrito-th",children:"Acciones"})]})}),e.jsx("tbody",{className:"carrito-items",children:n.map(r=>e.jsxs("tr",{className:"carrito-tr",children:[e.jsx("td",{className:"carrito-td",children:e.jsx("p",{className:"txt-carrito",children:r.nombreProducto})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["$",j(r.precioProducto)]})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["$",j(r.precioOriginal)]})})," ",e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:[e.jsx("button",{className:"boton-resta",onClick:()=>i(r.id),children:e.jsx(W,{icon:Ce})}),r.cantidad,e.jsx("button",{className:"boton-suma",onClick:()=>a(r.id),children:e.jsx(W,{icon:ye})})]})}),e.jsx("td",{children:e.jsx("p",{className:(r.stockDisponible||0)<=5?"cantidad-baja":(r.stockDisponible||0)<=15?"cantidad-media":"cantidad-alta",children:r.stockDisponible||0})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["$",j(r.precioProducto*r.cantidad)]})}),e.jsx("td",{className:"carrito-td",children:e.jsx("button",{className:"boton-eliminar",onClick:()=>c(r.id),children:e.jsx(W,{icon:Ee})})})]},r.id))})]})})})]})})]})},pa=()=>{const[N,p]=t.useState([]),[P,S]=t.useState(""),[o,n]=t.useState([]),[x,h]=t.useState(!0),[g,v]=t.useState(!1),[f,V]=t.useState(null),[y,$]=t.useState({idProducto:"",nombreProducto:"",precioProducto:"",precioOriginal:"",categoriaProducto:"",marcaProducto:"",cantidadProducto:""});t.useEffect(()=>{(async()=>{try{const c=(await Z(J(M,"productos"))).docs.map(u=>({idProducto:u.id,...u.data()}));p(c),n(c)}catch{S("Error al cargar los productos. Intente más tarde.")}finally{h(!1)}})()},[]);const w=a=>{const i=a.target.value.toLowerCase();if(i==="")n(N);else{const c=N.filter(u=>{const E=String(u.idProducto).toLowerCase(),l=String(u.nombreProducto).toLowerCase(),j=String(u.precioProducto).toLowerCase(),b=String(u.categoriaProducto).toLowerCase(),F=String(u.marcaProducto).toLowerCase(),B=String(u.cantidadProducto).toLowerCase();return E.includes(i)||l.includes(i)||j.includes(i)||b.includes(i)||F.includes(i)||B.includes(i)});n(c)}},C=a=>`${(isNaN(a)?0:Number(a)).toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}`,L=a=>{V(a),$({idProducto:a.idProducto,nombreProducto:a.nombreProducto,precioProducto:a.precioProducto||0,precioOriginal:a.precioOriginal||0,categoriaProducto:a.categoriaProducto,marcaProducto:a.marcaProducto,cantidadProducto:a.cantidadProducto||0}),v(!0)},z=async a=>{if(window.confirm("¿Estás seguro de que deseas eliminar este producto?"))try{const i=K(M,"productos",a.idProducto);await $e(i),p(c=>c.filter(u=>u.idProducto!==a.idProducto)),n(c=>c.filter(u=>u.idProducto!==a.idProducto)),alert("Producto eliminado exitosamente")}catch(i){console.error("Error al eliminar el producto:",i),alert("Error al eliminar el producto. Intente de nuevo.")}},O=a=>{const{name:i,value:c}=a.target;$({...y,[i]:c})},G=()=>{v(!1),V(null)},q=async a=>{a.preventDefault();try{const i=K(M,"productos",y.idProducto);await Fe(i,{nombreProducto:y.nombreProducto,precioProducto:Number(y.precioProducto)||0,precioOriginal:Number(y.precioOriginal)||0,categoriaProducto:y.categoriaProducto,marcaProducto:y.marcaProducto,cantidadProducto:Number(y.cantidadProducto)||0}),p(c=>c.map(u=>u.idProducto===f.idProducto?{...u,...y}:u)),n(c=>c.map(u=>u.idProducto===f.idProducto?{...u,...y}:u)),G()}catch(i){console.error("Error al actualizar el producto:",i)}};o.reduce((a,i)=>a+(i.cantidadProducto||0),0);const I=o.reduce((a,i)=>a+(i.precioProducto||0)*(i.cantidadProducto||0),0),R=o.reduce((a,i)=>{const c=isNaN(i.precioOriginal)?0:Number(i.precioOriginal),u=isNaN(i.cantidadProducto)?0:Number(i.cantidadProducto);return a+c*u},0);return x?e.jsx("p",{children:"Cargando productos..."}):P?e.jsx("p",{children:P}):e.jsxs("div",{children:[e.jsx("div",{className:"nav",children:e.jsx(Y,{})}),e.jsxs("div",{className:"body-tabla",children:[e.jsxs("main",{className:"table",children:[e.jsxs("section",{className:"table-header",children:[e.jsxs("p",{className:"form-title",children:["Total del Inventario: $",C(I)]}),e.jsxs("p",{className:"form-title",children:["Total Original: $",C(R)]}),e.jsxs("div",{className:"container-input",children:[e.jsx("input",{type:"text",placeholder:"Buscar producto",name:"text",className:"input",onChange:w}),e.jsx("svg",{fill:"#000000",width:"20px",height:"20px",viewBox:"0 0 1920 1920",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M790.588 1468.235c-373.722 0-677.647-303.924-677.647-677.647 0-373.722 303.925-677.647 677.647-677.647 373.723 0 677.647 303.925 677.647 677.647 0 373.723-303.924 677.647-677.647 677.647Zm596.781-160.715c120.396-138.692 193.807-319.285 193.807-516.932C1581.176 354.748 1226.428 0 790.588 0S0 354.748 0 790.588s354.748 790.588 790.588 790.588c197.647 0 378.24-73.411 516.932-193.807l516.028 516.142 79.963-79.963-516.142-516.028Z",fillRule:"evenodd"})})]})]}),e.jsx("section",{className:"table-body",children:e.jsxs("table",{className:"tabla-inventario",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Codigo"}),e.jsx("th",{children:"Nombre"}),e.jsx("th",{children:"Precio"}),e.jsx("th",{children:"Precio Original"}),e.jsx("th",{children:"Ganancias"}),e.jsx("th",{children:"Categoria"}),e.jsx("th",{children:"Marca"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:o.length>0?o.map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:a.idProducto}),e.jsx("td",{children:a.nombreProducto}),e.jsx("td",{children:C(a.precioProducto||0)}),e.jsx("td",{children:C(a.precioOriginal||0)}),e.jsx("td",{children:C((a.precioProducto||0)-(a.precioOriginal||0))}),e.jsx("td",{children:a.categoriaProducto}),e.jsx("td",{children:a.marcaProducto}),e.jsx("td",{children:e.jsx("p",{className:(a.cantidadProducto||0)<=5?"cantidad-baja":(a.cantidadProducto||0)<=15?"cantidad-media":"cantidad-alta",children:a.cantidadProducto||0})}),e.jsxs("td",{className:"td-editar",children:[e.jsx("button",{className:"btn-editar",onClick:()=>L(a),children:e.jsx(W,{icon:ta})}),e.jsx("button",{className:"delete",onClick:()=>z(a),children:e.jsx(W,{icon:Ee})})]})]},a.idProducto)):e.jsx("tr",{children:e.jsx("td",{colSpan:"9",children:"No hay productos disponibles"})})})]})})]}),e.jsx(ce,{open:g,onClose:G,children:f&&e.jsxs("div",{className:"formulario-editar",children:[e.jsx("p",{className:"form-title",children:"Editar Producto "}),e.jsxs("form",{onSubmit:q,children:[e.jsxs("label",{children:["Nombre:",e.jsx("input",{type:"text",name:"nombreProducto",value:y.nombreProducto,onChange:O})]}),e.jsxs("label",{children:["Precio:",e.jsx("input",{type:"number",name:"precioProducto",value:y.precioProducto,onChange:O})]}),e.jsxs("label",{children:["Precio Original:",e.jsx("input",{type:"number",name:"precioOriginal",value:y.precioOriginal,onChange:O})]}),e.jsxs("label",{children:["Categoria:",e.jsx("input",{type:"text",name:"categoriaProducto",value:y.categoriaProducto,onChange:O})]}),e.jsxs("label",{children:["Marca:",e.jsx("input",{type:"text",name:"marcaProducto",value:y.marcaProducto,onChange:O})]}),e.jsxs("label",{children:["Cantidad:",e.jsx("input",{type:"number",name:"cantidadProducto",value:y.cantidadProducto,onChange:O})]}),e.jsx("button",{type:"submit",children:"Actualizar Producto"}),e.jsx("button",{type:"button",onClick:G,children:"Cancelar"})]})]})})]})]})},ga=()=>{const[N,p]=t.useState([]),[P,S]=t.useState(""),[o,n]=t.useState([]),[x,h]=t.useState(!0);t.useState("efectivo");const[g,v]=t.useState(""),[f,V]=t.useState(1),[y,$]=t.useState(!1),[w,C]=t.useState(!1);t.useEffect(()=>{let a=!0;return(async()=>{try{const c=J(M,"productos"),E=(await Z(c)).docs.map(l=>({id:l.id,...l.data()}));a&&p(E)}catch(c){S("Error al obtener los productos"),console.error("Error al obtener los productos:",c)}finally{a&&h(!1)}})(),()=>{a=!1}},[]),t.useEffect(()=>{if(g.length>0){const a=N.find(i=>String(i.idProducto)===g);a?(y?O(a,f):z(a,f),v(""),V(1)):(S("Producto no encontrado."),setTimeout(()=>{S(""),v(""),V(1)},3e3))}},[g,N,f,y]);const L=a=>{v(a.target.value)},z=(a,i)=>{n(c=>c.find(E=>E.idProducto===a.idProducto)?c.map(E=>E.idProducto===a.idProducto?{...E,cantidad:E.cantidad+i}:E):[...c,{...a,cantidad:i}])},O=(a,i)=>{n(c=>c.find(E=>E.idProducto===a.idProducto)?c.map(E=>E.idProducto===a.idProducto?{...E,cantidad:E.cantidad+i}:E):[...c,{...a,cantidad:i}])},G=a=>{n(i=>i.map(c=>c.idProducto===a?{...c,cantidad:c.cantidad+1}:c))},q=a=>{n(i=>i.map(c=>c.idProducto===a?{...c,cantidad:Math.max(1,c.cantidad-1)}:c))},I=async a=>{a.preventDefault(),C(!0);const i=new Date,c=_.currentUser;try{const u=o.reduce((b,F)=>b+F.precioProducto*F.cantidad,0),E=o.map(b=>({idProducto:b.idProducto,nombreProducto:b.nombreProducto,marcaProducto:b.marcaProducto,categoriaProducto:b.categoriaProducto,precioProducto:b.precioProducto,cantidad:b.cantidad})),l=c?c.uid:"";await Ne(J(M,"sales"),{fechaVenta:i,totalVenta:-u,idUsuario:l,productos:E,tipoPago:"devolucion"});const j=Se(M);o.forEach(b=>{const F=K(M,"productos",b.idProducto),B=b.cantidadProducto+b.cantidad;j.update(F,{cantidadProducto:B})}),await j.commit(),n([]),v(""),V(1),C(!1),alert("Operación realizada con éxito")}catch(u){S("Error al registrar la operación"),console.error("Error al registrar la operación:",u),C(!1)}},R=a=>`${a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}`;return x?e.jsxs("div",{children:[e.jsx(Y,{}),e.jsx("h1",{children:"Cargando productos..."})]}):e.jsxs("div",{children:[e.jsx(Y,{}),e.jsx("main",{className:"main1",children:e.jsxs("div",{className:"carrito-label-devolucion",children:[e.jsx("p",{className:"form-title",children:"Devolución"}),e.jsx("hr",{}),e.jsxs("div",{className:"encabezado",children:[e.jsx("input",{className:"carrito-input",type:"text",placeholder:"Buscar producto por ID...",value:g,onChange:L,onBlur:()=>{if(g.length>0){const a=N.find(i=>String(i.idProducto)===g);a?(y?O(a,f):z(a,f),v("")):S("Producto no encontrado.")}}}),e.jsx("input",{className:"carrito-input",type:"number",placeholder:"Cantidad...",value:f,min:"1",onChange:a=>{const i=parseInt(a.target.value,10);V(i<1?1:i)}})]}),e.jsxs("table",{className:"carrito-tabla",children:[e.jsx("thead",{className:"carrito-th",children:e.jsxs("tr",{className:"carrito-tr",children:[e.jsx("th",{className:"carrito-th",children:"Producto"}),e.jsx("th",{className:"carrito-th",children:"Precio"}),e.jsx("th",{className:"carrito-th",children:"Cantidad"}),e.jsx("th",{className:"carrito-th",children:"Total"})]})}),e.jsx("tbody",{className:"carrito-items",children:o.map(a=>e.jsxs("tr",{className:"carrito-tr",children:[e.jsx("td",{className:"carrito-td",children:e.jsx("p",{className:"txt-carrito",children:a.nombreProducto})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["-$",R(a.precioProducto)]})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:[e.jsx("button",{className:"boton-resta",onClick:()=>q(a.idProducto),children:e.jsx(W,{icon:Ce})}),e.jsx("span",{className:"spanCarrito",children:a.cantidad}),e.jsx("button",{className:"boton-suma",onClick:()=>G(a.idProducto),children:e.jsx(W,{icon:ye})})]})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["-$",R(a.precioProducto*a.cantidad)]})})]},a.idProducto))})]}),e.jsx("div",{className:"venta-label",children:e.jsx("div",{className:"totalcarro",children:e.jsxs("p",{className:"textp",children:["Total a Devolver: -$",R(o.reduce((a,i)=>a+i.cantidad*i.precioProducto,0))]})})}),e.jsx("div",{className:"bottom-container",children:e.jsx("button",{className:"boton-venta",onClick:I,disabled:o.length===0,children:e.jsx("span",{children:"Devolución"})})})]})})]})},Oe=N=>ve(N,"dd/MM/yyyy"),fa=()=>{const[N,p]=t.useState([]),[P,S]=t.useState(""),[o,n]=t.useState(!0),[x,h]=t.useState(!1),[g,v]=t.useState(!1),[f,V]=t.useState(null),[y,$]=t.useState(null),[w,C]=t.useState("todos"),[L,z]=t.useState(new Date),[O,G]=t.useState(null),[q,I]=t.useState(!1);t.useEffect(()=>{(async()=>{try{const m=J(M,"sales"),A=J(M,"users"),[re,Ge]=await Promise.all([Z(m),Z(A)]),de={};Ge.forEach(ee=>{de[ee.id]=ee.data().nombreUsuario}),console.log("Users data:",de);const we=re.docs.map(ee=>{const se=ee.data();return{idVenta:ee.id,...se,nombreUsuario:de[se.idUsuario]||"N/A",fechaVenta:se.fechaVenta.toDate()}});we.sort((ee,se)=>se.fechaVenta-ee.fechaVenta),p(we),n(!1)}catch(m){console.error("Error fetching data:",m),S("Ocurrió un error al cargar el historial de ventas"),n(!1)}})()},[]);const R=s=>{V(s),h(!0)},a=()=>{h(!1),V(null)},i=s=>{$(s),v(!0)},c=()=>{v(!1),$(null)},u=s=>{G(s),I(!0)},E=()=>{I(!1),G(null)},l=s=>{const{name:m,value:A}=s.target;V(re=>({...re,[m]:A}))},j=s=>{z(s)},b=async()=>{try{const s=K(M,"sales",f.idVenta);await Fe(s,{idUsuario:f.idUsuario,tipoPago:f.tipoPago,totalVenta:parseFloat(f.totalVenta)}),p(m=>m.map(A=>A.idVenta===f.idVenta?f:A)),a()}catch(s){console.error("Error updating sale:",s)}},F=async()=>{try{const s=K(M,"sales",O.idVenta);await $e(s),p(m=>m.filter(A=>A.idVenta!==O.idVenta)),E()}catch(s){console.error("Error deleting sale:",s)}},d=((s,m)=>m==="todos"?s:s.filter(A=>A.tipoPago===m))(((s,m)=>m?s.filter(A=>ve(A.fechaVenta,"dd/MM/yyyy")===ve(m,"dd/MM/yyyy")):s)(N,L),w),D=s=>{switch(s){case"efectivo":return"Efectivo";case"tarjeta":return"Tarjeta";case"devolucion":return"Devolución";default:return s}},k=s=>isNaN(s)?"0":`${s.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}`;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"nav",children:e.jsx(Y,{})}),e.jsx("div",{className:"body-tabla",children:e.jsxs("main",{className:"table",children:[e.jsxs("section",{className:"table-header",children:[e.jsxs("p",{className:"form-title",children:["Total del día: $",k(d.reduce((s,m)=>s+(parseFloat(m.totalVenta)||0),0))]}),e.jsxs("p",{className:"form-title",children:["Total de Ganancia: $",k(d.reduce((s,m)=>s+(parseFloat(m.totalGanancia)||0),0))]}),e.jsx(Re,{dateAdapter:qe,children:e.jsx(ze,{className:"fecha",label:"Selecciona una fecha",value:L,onChange:s=>j(s),renderInput:s=>e.jsx(Pe,{...s,style:{marginBottom:"16px"}})})}),e.jsxs(ke,{className:"seleccionar-pago",children:[e.jsx(Ve,{id:"tipoPago-label",children:"Tipo de Pago"}),e.jsxs(Ue,{labelId:"tipoPago-label",id:"tipoPago",value:w,onChange:s=>C(s.target.value),children:[e.jsx(ae,{value:"todos",children:"Todos"}),e.jsx(ae,{value:"efectivo",children:"Efectivo"}),e.jsx(ae,{value:"tarjeta",children:"Tarjeta"}),e.jsx(ae,{value:"devolucion",children:"Devolución"})]})]}),e.jsx(X,{className:"btn-editar",onClick:()=>console.log("Exportar a Excel"),children:"Exportar a Excel"})]}),o?e.jsx("p",{children:"Cargando..."}):P?e.jsx("p",{className:"error-message",children:P}):d.length===0?e.jsx("p",{children:"No hay ventas registradas"}):e.jsx(ra,{component:sa,children:e.jsxs(ue,{children:[e.jsx(he,{children:e.jsxs(te,{children:[e.jsx(U,{children:"ID Venta"}),e.jsx(U,{children:"Fecha"}),e.jsx(U,{children:"Nombre Usuario"}),e.jsx(U,{children:"Tipo Pago"}),e.jsx(U,{children:"Total Venta"}),e.jsx(U,{children:"Total Ganancia"}),e.jsx(U,{children:"Acciones"})]})}),e.jsx(me,{children:d.map(s=>e.jsxs(te,{children:[e.jsx(U,{children:s.idVenta}),e.jsx(U,{children:Oe(s.fechaVenta)}),e.jsx(U,{children:s.nombreUsuario}),e.jsx(U,{children:D(s.tipoPago)}),e.jsxs(U,{children:["$",k(parseFloat(s.totalVenta)||0)]}),e.jsxs(U,{children:["$",k(parseFloat(s.totalGanancia)||0)]}),e.jsxs(U,{children:[e.jsx(X,{variant:"outlined",onClick:()=>i(s),children:"Detalle"}),e.jsx(X,{variant:"outlined",onClick:()=>R(s),children:"Editar"}),e.jsx(X,{variant:"outlined",onClick:()=>u(s),children:"Eliminar"})]})]},s.idVenta))})]})})]})}),x&&e.jsxs(ce,{open:x,onClose:a,children:[e.jsx(xe,{children:"Editar Venta"}),e.jsx(je,{children:f&&e.jsxs("div",{children:[e.jsxs(ke,{fullWidth:!0,margin:"normal",children:[e.jsx(Ve,{id:"tipoPago-label",children:"Tipo de Pago"}),e.jsxs(Ue,{labelId:"tipoPago-label",id:"tipoPago",name:"tipoPago",value:f.tipoPago,onChange:l,children:[e.jsx(ae,{value:"efectivo",children:"Efectivo"}),e.jsx(ae,{value:"tarjeta",children:"Tarjeta"}),e.jsx(ae,{value:"devolucion",children:"Devolución"})]})]}),e.jsx(Pe,{label:"Total Venta",name:"totalVenta",value:f.totalVenta,onChange:l,fullWidth:!0,margin:"normal"})]})}),e.jsxs(pe,{children:[e.jsx(X,{onClick:a,children:"Cancelar"}),e.jsx(X,{onClick:b,color:"primary",children:"Guardar"})]})]}),g&&e.jsxs(ce,{open:g,onClose:c,children:[e.jsx(xe,{children:"Detalle de Venta"}),e.jsx(je,{children:y&&e.jsxs(ue,{children:[e.jsx(he,{children:e.jsxs(te,{children:[e.jsx(U,{children:"ID Producto"}),e.jsx(U,{children:"Nombre Producto"}),e.jsx(U,{children:"Cantidad"}),e.jsx(U,{children:"Precio"})]})}),e.jsx(me,{children:y.productos.map(s=>e.jsxs(te,{children:[e.jsx(U,{children:s.idProducto}),e.jsx(U,{children:s.nombreProducto}),e.jsx(U,{children:s.cantidad}),e.jsxs(U,{children:["$",k(s.precio)]})]},s.idProducto))})]})}),e.jsx(pe,{children:e.jsx(X,{onClick:c,children:"Cerrar"})})]}),q&&e.jsxs(ce,{open:q,onClose:E,children:[e.jsx(xe,{children:"Eliminar Venta"}),e.jsx(je,{children:O&&e.jsxs(ue,{children:[e.jsx(he,{children:e.jsxs(te,{children:[e.jsx(U,{children:"ID Venta:"}),e.jsx(U,{children:"Fecha:"}),e.jsx(U,{children:"Tipo de Pago:"}),e.jsx(U,{children:"Total Venta:"})]})}),e.jsx(me,{children:e.jsxs(te,{children:[e.jsx(U,{children:O.idVenta}),e.jsx(U,{children:Oe(O.fechaVenta)}),e.jsx(U,{children:D(O.tipoPago)}),e.jsxs(U,{children:["$",k(parseFloat(O.totalVenta)||0)]})]})})]})}),e.jsxs(pe,{children:[e.jsx(X,{onClick:E,children:"Cancelar"}),e.jsx(X,{onClick:F,color:"error",children:"Eliminar"})]})]})]})},Pa=()=>{const[N,p]=t.useState([]),[P,S]=t.useState({}),[o,n]=t.useState({}),[x,h]=t.useState({}),[g,v]=t.useState(0),[f,V]=t.useState(!0),[y,$]=t.useState(null),[w,C]=t.useState(new Date),[L,z]=t.useState("todos"),O=(c,u)=>u==="todos"?c:c.filter(E=>E.tipoPago===u),G=(c,u)=>{if(!u)return c;const E=oa(new Date(u)),l=na(new Date(u));return c.filter(j=>j.fecha>=E&&j.fecha<=l)},q=(c,u)=>{const E={},l={},j={};let b=0;c.forEach(F=>{const{tipoPago:B,totalVenta:r,nombreUsuario:d,productos:D}=F;E[B]=(E[B]||0)+1,l[d]=(l[d]||0)+r,D.forEach(k=>{const{idProducto:s,cantidad:m}=k,A=u[s]||s;j[A]=(j[A]||0)+m}),b+=r}),S(E),n(l),h(j),v(b)};t.useEffect(()=>{(async()=>{try{const u=J(M,"sales"),E=J(M,"users"),l=J(M,"products"),[j,b,F]=await Promise.all([Z(u),Z(E),Z(l)]),B={};b.forEach(k=>{B[k.id]=k.data().nombreUsuario});const r={};F.forEach(k=>{r[k.id]=k.data().nombreProducto});const d=j.docs.map(k=>{const s=k.data();let m;return s.fecha&&s.fecha.toDate?m=s.fecha.toDate():s.fecha&&s.fecha.toDate===void 0?m=new Date(s.fecha):m=new Date,{idVenta:k.id,...s,nombreUsuario:B[s.idUsuario]||"N/A",fecha:m}}),D=O(G(d,w),L);q(D,r),p(D),V(!1)}catch(u){console.error("Error fetching data:",u),$("Ocurrió un error al cargar el historial de ventas"),V(!1)}})()},[w,L]);const I={labels:Object.keys(P),datasets:[{label:"Ventas por Tipo de Pago",data:Object.values(P),backgroundColor:["rgba(75, 192, 192, 0.6)","rgba(153, 102, 255, 0.6)","rgba(255, 159, 64, 0.6)"]}]},R={labels:Object.keys(o),datasets:[{label:"Ventas por Usuario",data:Object.values(o),backgroundColor:["rgba(255, 99, 132, 0.6)","rgba(54, 162, 235, 0.6)","rgba(255, 206, 86, 0.6)","rgba(75, 192, 192, 0.6)","rgba(153, 102, 255, 0.6)","rgba(255, 159, 64, 0.6)"]}]},a={labels:Object.keys(x),datasets:[{label:"Ventas por Producto",data:Object.values(x),backgroundColor:["rgba(54, 162, 235, 0.6)","rgba(255, 99, 132, 0.6)","rgba(75, 192, 192, 0.6)","rgba(255, 206, 86, 0.6)","rgba(153, 102, 255, 0.6)","rgba(255, 159, 64, 0.6)"]}]},i=c=>new Intl.NumberFormat("es-ES").format(c);return f?e.jsx("p",{children:"Loading..."}):y?e.jsxs("p",{children:["Error: ",y]}):e.jsxs("div",{children:[e.jsx("div",{className:"nav",children:e.jsx(Y,{})}),e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"date-filter",children:[e.jsx("h3",{children:"Filtrar por Fecha"}),e.jsx(Re,{dateAdapter:qe,children:e.jsx(ze,{value:w,onChange:c=>C(c),renderInput:c=>e.jsx(Pe,{...c,style:{marginBottom:"16px"}})})})]}),e.jsx("div",{className:"metrics",children:e.jsxs("h2",{children:["Total Ventas: $",i(g.toFixed(0))]})}),e.jsxs("div",{className:"charts-container",children:[e.jsxs("div",{className:"pie-chart",children:[e.jsx("h3",{children:"Ventas por Tipo de Pago"}),e.jsx(ia,{data:I})]}),e.jsxs("div",{className:"bar-charts",children:[e.jsxs("div",{className:"chart",children:[e.jsx("h3",{children:"Ventas por Usuario"}),e.jsx(Te,{data:R})]}),e.jsxs("div",{className:"chart",children:[e.jsx("h3",{children:"Ventas por Producto"}),e.jsx(Te,{data:a})]})]})]})]})]})},va=()=>{const N=ne(),[p,P]=oe.useState(!1),{signOut:S}=De(),o=async()=>{try{await S(),N("/")}catch(h){console.error("Error al cerrar sesión:",h)}},n=()=>{P(!p)},x=()=>{P(!1)};return oe.useEffect(()=>{const h=()=>{window.innerWidth>=800&&x()};return window.addEventListener("resize",h),()=>{window.removeEventListener("resize",h)}},[]),e.jsxs("nav",{className:"navbar",children:[e.jsxs("ul",{className:`sidebar ${p?"visible":""}`,children:[e.jsx("li",{onClick:x,children:e.jsx(T,{className:"menu",to:"#",children:e.jsx(W,{icon:Le})})}),e.jsx("li",{children:e.jsx(T,{className:"link",to:"/vendedor/ventas",children:"Venta"})}),e.jsx("li",{children:e.jsx(T,{className:"link",to:"/vendedor/inventario",children:"Inventario"})}),e.jsx("li",{children:e.jsx(T,{className:"link",to:"/vendedor/devolucion",children:"Devolución"})}),e.jsx("li",{children:e.jsx(T,{className:"link",onClick:o,children:"Cerrar Sesion"})})]}),e.jsxs("ul",{children:[e.jsx("li",{className:"Mobile",children:e.jsx(T,{className:"link",to:"/vendedor/inventario",children:"Inventario"})}),e.jsx("li",{className:"Mobile",children:e.jsx(T,{className:"link",to:"/vendedor/ventas",children:"Venta"})}),e.jsx("li",{className:"Mobile",children:e.jsx(T,{className:"link",to:"/vendedor/devolucion",children:"Devolución"})}),e.jsx("li",{className:"Mobile",children:e.jsx(T,{className:"link",onClick:o,children:"Cerrar Sesion"})}),e.jsx("li",{onClick:n,children:e.jsx(T,{className:"menu",to:"#",children:e.jsx(W,{icon:Ae})})})]})]})},ba=()=>{const{currentUser:N}=t.useContext(le),[p,P]=t.useState([]),[S,o]=t.useState(""),[n,x]=t.useState([]),[h,g]=t.useState(!0),[v,f]=t.useState("efectivo"),[V,y]=t.useState(0),[$,w]=t.useState(0),[C,L]=t.useState(""),[z,O]=t.useState(1);t.useEffect(()=>{(async()=>{try{const b=(await Z(J(M,"productos"))).docs.map(F=>({id:F.id,...F.data()}));P(b)}catch(j){o("Error al obtener los productos"),console.error("Error al obtener los productos:",j)}finally{g(!1)}})()},[N]),t.useEffect(()=>{if(C.length>0){const l=p.find(j=>String(j.id)===C);l?(q(l,z),L(""),O(1)):(o("Producto no encontrado."),setTimeout(()=>{o(""),L(""),O(1)},3e3))}},[C,p,z]);const G=l=>{L(l.target.value)},q=(l,j)=>{x(b=>{const F=b.find(B=>B.id===l.id);return F?F.cantidad+j<=l.cantidadProducto?b.map(B=>B.id===l.id?{...B,cantidad:B.cantidad+j}:B):(alert("Stock insuficiente"),b):l.cantidadProducto>=j?[...b,{...l,cantidad:j}]:(alert("Stock insuficiente"),b)})},I=l=>{x(j=>{var B;const b=j.find(r=>r.id===l),F=(B=p.find(r=>r.id===l))==null?void 0:B.cantidadProducto;return b&&F>b.cantidad?j.map(r=>r.id===l?{...r,cantidad:r.cantidad+1}:r):(alert("Stock insuficiente"),j)})},R=l=>{x(j=>j.map(b=>b.id===l?{...b,cantidad:Math.max(1,b.cantidad-1)}:b))},a=l=>{x(j=>j.filter(b=>b.id!==l))},i=l=>{f(l.target.value),l.target.value==="efectivo"&&(y(0),w(0))},c=l=>{const j=parseFloat(l.target.value);y(j);const b=n.reduce((F,B)=>F+B.precioProducto*B.cantidad,0);w(j-b)},u=async l=>{l.preventDefault();const j=new Date,b=n.reduce((r,d)=>r+d.precioProducto*d.cantidad,0),F=n.map(r=>({idProducto:r.id,nombreProducto:r.nombreProducto,marcaProducto:r.marcaProducto,categoriaProducto:r.categoriaProducto,precioProducto:r.precioProducto,cantidad:r.cantidad,cantidadProducto:r.cantidadProducto})),B=_.currentUser;try{await Ne(J(M,"sales"),{fechaVenta:j,totalVenta:b,tipoPago:v,idUsuario:B.uid,productos:F});const r=Se(M);n.forEach(d=>{const D=K(M,"productos",d.id);r.update(D,{cantidadProducto:d.cantidadProducto-d.cantidad})}),await r.commit(),x([]),alert("Venta registrada con éxito")}catch(r){o("Error al registrar la venta"),console.error("Error al registrar la venta:",r)}},E=l=>`${l.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}`;return h?e.jsx("div",{children:e.jsx("h1",{children:"Cargando productos..."})}):e.jsxs("div",{children:[e.jsx("div",{className:"nav",children:e.jsx(va,{})}),e.jsx("main",{className:"main1",children:e.jsxs("div",{className:"carrito-label",children:[e.jsx("p",{className:"form-title",children:"Carrito de compras"}),e.jsx("hr",{}),e.jsxs("div",{className:"encabezado",children:[e.jsx("input",{className:"carrito-input",type:"text",placeholder:"Buscar producto por ID...",value:C,onChange:G,onBlur:()=>{if(C.length>0){const l=p.find(j=>String(j.id)===C);l?(q(l),L("")):o("Producto no encontrado.")}}}),e.jsx("input",{className:"carrito-input",type:"number",placeholder:"Cantidad...",value:z,min:"1",onChange:l=>{const j=parseInt(l.target.value);O(j<1?1:j)}})]}),S&&e.jsx("p",{className:"error",children:S}),e.jsx("section",{className:"tabla-ventas",children:e.jsxs("table",{className:"carrito-tabla",children:[e.jsx("thead",{className:"carrito-th",children:e.jsxs("tr",{className:"carrito-tr",children:[e.jsx("th",{className:"carrito-th",children:"Producto"}),e.jsx("th",{className:"carrito-th",children:"Precio"}),e.jsx("th",{className:"carrito-th",children:"Cantidad"}),e.jsx("th",{className:"carrito-th",children:"Total"}),e.jsx("th",{className:"carrito-th",children:"Acciones"})]})}),e.jsx("tbody",{className:"carrito-items",children:n.map(l=>e.jsxs("tr",{className:"carrito-tr",children:[e.jsx("td",{className:"carrito-td",children:e.jsx("p",{className:"txt-carrito",children:l.nombreProducto})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["$",E(l.precioProducto)]})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:[e.jsx("button",{className:"boton-resta",onClick:()=>R(l.idProducto),children:e.jsx(W,{icon:Ce})}),l.cantidad,e.jsx("button",{className:"boton-suma",onClick:()=>I(l.idProducto),children:e.jsx(W,{icon:ye})})]})}),e.jsx("td",{className:"carrito-td",children:e.jsxs("p",{className:"txt-carrito",children:["$",E(l.precioProducto*l.cantidad)]})}),e.jsx("td",{className:"carrito-td",children:e.jsx("button",{className:"boton-eliminar",onClick:()=>a(l.idProducto),children:e.jsx(W,{icon:Ee})})})]},l.idProducto))})]})}),e.jsxs("div",{className:"pago",children:[e.jsx("label",{htmlFor:"tipoPago",children:"Tipo de pago:"}),e.jsxs("select",{id:"tipoPago",value:v,onChange:i,className:"carrito-input",children:[e.jsx("option",{value:"efectivo",children:"Efectivo"}),e.jsx("option",{value:"tarjeta",children:"Tarjeta"})]}),v==="efectivo"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"cantidadEntregada",children:"Cantidad entregada:"}),e.jsx("input",{id:"cantidadEntregada",type:"number",value:V,onChange:c,className:"carrito-input"}),e.jsxs("p",{className:"textp",children:["Vuelto: $",E($)]})]})]}),e.jsx("button",{className:"boton-venta",onClick:u,children:e.jsx("span",{children:"Finalizar Venta"})})]})})]})};function Q({children:N,allowedRoles:p}){const{user:P,role:S}=De();return P?p&&!p.includes(S)?e.jsx(fe,{to:"/unauthorized"}):N:e.jsx(fe,{to:"/login"})}function Na(){return e.jsxs(aa,{children:[e.jsx(H,{path:"/",element:e.jsx(fe,{to:"/login"})}),e.jsx(H,{path:"/login",element:e.jsx(da,{})}),e.jsx(H,{path:"/registro",element:e.jsx(ha,{})})," ",e.jsx(H,{path:"/resetPassword",element:e.jsx(ua,{})}),e.jsx(H,{path:"/agregarUsuario",element:e.jsx(Q,{allowedRoles:["admin"],children:e.jsx(ma,{})})}),e.jsx(H,{path:"/agregarProducto",element:e.jsx(Q,{allowedRoles:["admin"],children:e.jsx(xa,{})})}),e.jsx(H,{path:"/dashboard",element:e.jsx(Q,{allowedRoles:["admin"],children:e.jsx(Pa,{})})}),e.jsx(H,{path:"/ventas",element:e.jsx(Q,{allowedRoles:["admin","vendedor"],children:e.jsx(ja,{})})}),e.jsx(H,{path:"/inventario",element:e.jsx(Q,{allowedRoles:["admin"],children:e.jsx(pa,{})})}),e.jsx(H,{path:"/devolucion",element:e.jsx(Q,{allowedRoles:["admin","vendedor"],children:e.jsx(ga,{})})}),e.jsx(H,{path:"/historial",element:e.jsx(Q,{allowedRoles:["admin"],children:e.jsx(fa,{})})}),e.jsx(H,{path:"/vendedor/ventas",element:e.jsx(Q,{allowedRoles:["vendedor"],children:e.jsx(ba,{})})}),e.jsx(H,{path:"/unauthorized",element:e.jsx("div",{children:"Unauthorized - You do not have permission to view this page."})})]})}We.createRoot(document.getElementById("root")).render(e.jsx(oe.StrictMode,{children:e.jsx(Qe,{children:e.jsx(la,{children:e.jsx(Na,{})})})}));
